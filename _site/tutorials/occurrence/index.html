<!DOCTYPE html>
<html lang="en-GB">
	<head>
    	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Manipulation and visualisation of spatial and population data</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->
<link rel="stylesheet" href="/css/main.css"/>
<link rel="stylesheet" href="/css/owlcarousel/owl.carousel.css">
<link rel="stylesheet" href="/css/owlcarousel/owl.theme.default.css">

<!-- JS -->
<script src="https://use.fontawesome.com/4dd22df1f8.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/scripts/accordion.js"></script>
<script src="/scripts/jquery.counterup.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.5/waypoints.min.js"></script>
<script src="/scripts/ticker.js"></script>

	</head>
	<body>
    	<header class="header">
	<div class="navigation-bar">
		<div id="navigation-container">
			
				<a class="logo" href="/">
  <img src="/assets/img/logos/logo_stack.svg" alt="Coding Club logo">
</a>

			
			<nav>
				<label for="hamburger">☰</label>
				<input type="checkbox" id="hamburger">
				<ul>
					
						
					<li class="item item-nav">
						<a href="/">Home</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/tutorials.html">Tutorials</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/course.html">Course</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/team.html">Team</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/involve.html">Get involved</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/links.html">Links</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/contact.html">Contact</a>
					</li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>

			<div class="block">
	<center>
		<img src="/img/tutheaderoccur.png" alt="Img">
	</center>
</div>

<h3 id="tutorial-aims">Tutorial Aims:</h3>

<h4 id="-1-download-format-and-manipulate-biodiversity-data-"><a href="#download"> 1. Download, format and manipulate biodiversity data </a></h4>

<h4 id="-2-clean-species-occurrence-data-"><a href="#clean"> 2. Clean species occurrence data </a></h4>

<h4 id="-3-visualise--customise-species-occurrence-and-population-trends-"><a href="#datavis"> 3. Visualise &amp; customise species occurrence and population trends </a></h4>

<p></p>

<h4 id="all-the-files-you-need-to-complete-this-tutorial-can-be-downloaded-from-this-repository-click-on-clonedownloaddownload-zip-and-unzip-the-folder-or-clone-the-repository-to-your-own-github-account">All the files you need to complete this tutorial can be downloaded from <a href="https://github.com/ourcodingclub/CC-occurrence" target="_blank" rel="noopener noreferrer">this repository</a>. Click on <code class="language-plaintext highlighter-rouge">Clone/Download/Download ZIP</code> and unzip the folder, or clone the repository to your own GitHub account.</h4>

<p><b>In this tutorial, we will focus on how to efficiently format, manipulate and visualise large species occurrence and population trend datasets. We will use the <code class="language-plaintext highlighter-rouge">tidyr</code> and <code class="language-plaintext highlighter-rouge">dplyr</code> packages to clean up dataframes and calculate new variables. Then, we will do a further clean up of species occurrence data using the <code class="language-plaintext highlighter-rouge">CleanCoordinates</code> function from the <code class="language-plaintext highlighter-rouge">CoordinateCleaner</code> package. Species occurrence records often include thousands, if not millions of latitude and longitude points, but are they all valid points? Sometimes the latitude and longitude values are reversed, there are unwanted zeros, or terrestrial species are seen out at sea and marine species very inland! The <code class="language-plaintext highlighter-rouge">CoordinateCleaner</code> package, developed by Alexander Zizka, flags potentially erroneous coordinates so that you can decide whether or not to include them in your analysis (<a href="https://github.com/azizka/CoordinateCleaner" target="_blank" rel="noopener noreferrer">more info here</a>). Finally, we will use the <code class="language-plaintext highlighter-rouge">ggplot2</code> package to make simple maps of occurrence records, visualise a few trends in time and then we will arrange all of our graphs together using the <code class="language-plaintext highlighter-rouge">gridExtra</code> package.</b></p>

<center><img src="/img/beluga_panel.png" alt="Img" style="width: 1000px;"></center>

<p><a name="download"></a></p>

<h3 id="1-download-format-and-manipulate-biodiversity-data">1. Download, format and manipulate biodiversity data</h3>

<p>We will be working with occurrence data for the beluga whale from the <a href="http://www.gbif.org/" target="_blank" rel="noopener noreferrer">Global Biodiversity Information Facility</a> and population data for the same species from the <a href="http://www.livingplanetindex.org/home/index" target="_blank" rel="noopener noreferrer">Living Planet Database</a>, both of which are publicly available datasets.</p>

<h4 id="set-your-working-directory">Set your working directory.</h4>

<p>It helps to keep all your data, scripts, image outputs etc. in a single folder. This minimises the chance of losing any part of your analysis and makes it easier to move the analysis on your computer without breaking filepaths. Note that filepaths are defined differently on Mac/Linux and Windows machines. On a Mac/Linux machine, user files are found in the ‘home’ directory (<code class="language-plaintext highlighter-rouge">~</code>), whereas on a Windows machine, files can be placed in multiple ‘drives’ (e.g. <code class="language-plaintext highlighter-rouge">D:</code>). Also note that on a Windows machine, if you copy and paste a filepath from Windows Explorer into RStudio, it will appear with backslashes (<code class="language-plaintext highlighter-rouge">\ </code>), but R requires all filepaths to be written using forward-slashes (<code class="language-plaintext highlighter-rouge">/</code>) so you will have to change those manually.</p>

<p><strong>Set your working directory to the folder you downloaded from Github earlier. It should be called <code class="language-plaintext highlighter-rouge">CC-occurrence-master</code> or however you renamed it when unzipping. See below for some examples for both Windows and Mac/Linux:</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set the working directory on Windows</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="s2">"D:/Work/coding_club/CC-occurrence-master"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Set the working directory on Mac/Linux</span><span class="w">
</span><span class="n">setwd</span><span class="p">(</span><span class="s2">"~/Work/coding_club/CC-occurrence-master"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><b>Make a new script file using <code class="language-plaintext highlighter-rouge">File/ New File/ R Script</code> and we are all set to start exploring where beluga whales have been recorded and how their populations have changed in the last few decades.</b></p>

<h4 id="organise-your-script-into-sections">Organise your script into sections</h4>

<p>As with any piece of writing, when writing an R script it really helps to have a clear structure. A script is a <code class="language-plaintext highlighter-rouge">.R</code> file that contains your code. You could directly type code into the R console, but that way you have no record of it and you won’t be able to reuse it later. To make a new <code class="language-plaintext highlighter-rouge">.R</code> file, open RStudio and go to <code class="language-plaintext highlighter-rouge">File/New file/R script</code>. For more information on the general RStudio layout, you can check out our <a href="https://ourcodingclub.github.io/2016/11/13/intro-to-r.html" target="_blank" rel="noopener noreferrer">Intro to RStudio tutorial</a>. A clearly structured script allows both the writer and the reader to easily navigate through the code to find the desired section.</p>

<p>The best way to split your script into sections is to use comments. You can define a comment by adding <code class="language-plaintext highlighter-rouge">#</code> to the start of any line and typing text after it, e.g. <code class="language-plaintext highlighter-rouge"># Load data</code>. Then, underneath that comment, you would write the code for importing your data in <code class="language-plaintext highlighter-rouge">R</code>. RStudio has a great feature allowing you to turn your sections into an outline, similar to that which you can find in <code class="language-plaintext highlighter-rouge">Microsoft Word</code>. To add a comment to the outline, type four <code class="language-plaintext highlighter-rouge">-</code> after your comment text, e.g. <code class="language-plaintext highlighter-rouge"># Load data ----</code>. To view your outline, click on the button shown below. You can then click on an outline item and jump straight to it - no more scrolling!</p>

<center> <img src="/img/outline.png" alt="Img" style="width: 800px;"> </center>

<p><strong>NOTE: If you don’t see the outline icon, you most likely do not have the newest version of RStudio. If you want to get this feature, you can <a href="https://www.rstudio.com/products/rstudio/download/" target="_blank" rel="noopener noreferrer">download</a> the newest version of RStudio.</strong></p>

<h4 id="write-an-informative-header">Write an informative header</h4>

<p><b>Whatever your coding adventure, it will be way smoother if you record what you are doing and why you are doing it, so that  your collaborators and future you can come back to the script and not be puzzled by the thousands of line of code. It’s good practice to start a script with information on who you are, what the code is for and when you are writing it. We have some comments throughout the code in the tutorial. Feel free to add more comments to your script using a hashtag <code class="language-plaintext highlighter-rouge">#</code> before a line of text.</b></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Marine mammal distribution and population change</span><span class="w">
</span><span class="c1"># Data formatting, manipulation and visualisation</span><span class="w">

</span><span class="c1"># Conference workshop</span><span class="w">
</span><span class="c1"># Your name</span><span class="w">
</span><span class="c1"># Date</span><span class="w">
</span></code></pre></div></div>

<p><b>Next, load (<code class="language-plaintext highlighter-rouge">library()</code>) the packages needed for this tutorial. If you don’t have some of them installed, you can install them using <code class="language-plaintext highlighter-rouge">ìnstall.packages("package-name")</code>.</b></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Packages ----</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">mapdata</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgbif</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">CoordinateCleaner</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">png</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h4 id="make-your-own-ggplot2-theme">Make your own <code class="language-plaintext highlighter-rouge">ggplot2</code> theme</h4>

<p>If you’ve ever tried to perfect your <code class="language-plaintext highlighter-rouge">ggplot2</code> graphs, you might have noticed that the lines starting with <code class="language-plaintext highlighter-rouge">theme()</code> quickly pile up: you adjust the font size of the axes and the labels, the position of the title, the background colour of the plot, you remove the grid lines in the background, etc. And then you have to do the same for the next plot, which really increases the amount of code you use. Here is a simple solution: create a customised theme that combines all the <code class="language-plaintext highlighter-rouge">theme()</code> elements you want and apply it to your graphs to make things easier and increase consistency. You can include as many elements in your theme as you want, as long as they don’t contradict one another, and then when you apply your theme to a graph, only the relevant elements will be considered - e.g. for our graphs we won’t need to use <code class="language-plaintext highlighter-rouge">legend.position</code>, but it’s fine to keep it in the theme in case any future graphs we apply it to do have the need for legends.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Personalised ggplot2 theme</span><span class="w">
</span><span class="n">theme_marine</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(){</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">),</span><span class="w">
          </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w">
          </span><span class="n">axis.line.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">),</span><span class="w">
          </span><span class="n">axis.line.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_line</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"black"</span><span class="p">),</span><span class="w">
          </span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">panel.grid.minor.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">panel.grid.minor.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">panel.grid.major.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
          </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">),</span><span class="w">
          </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
          </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">),</span><span class="w">
          </span><span class="n">legend.key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">legend.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w">
                                           </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"transparent"</span><span class="p">,</span><span class="w">
                                           </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"blank"</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h4 id="load-species-occurrence-and-population-trend-data">Load species occurrence and population trend data</h4>

<p><strong>The data are in an <code class="language-plaintext highlighter-rouge">.RData</code> format, as those are quicker to use, since <code class="language-plaintext highlighter-rouge">.Rdata</code> files are more compressed. Of course, a drawback is that <code class="language-plaintext highlighter-rouge">.RData</code> files can only be used within R, whereas <code class="language-plaintext highlighter-rouge">.csv</code> files are more transferable.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load data ----</span><span class="w">

</span><span class="c1"># Download species occurrence records from the Global Biodiversity Information Facility</span><span class="w">
</span><span class="c1"># beluga &lt;- occ_search(scientificName = "Delphinapterus leucas", limit = 20000,</span><span class="w">
</span><span class="c1">#                      hasCoordinate = TRUE, return = "data")</span><span class="w">

</span><span class="c1"># Downloading takes a while so unless you have time to wait, you can use the file we downloaded in advance</span><span class="w">

</span><span class="n">load</span><span class="p">(</span><span class="s2">"beluga.RData"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Load population change data for marine species from the Living Planet Database</span><span class="w">
</span><span class="n">load</span><span class="p">(</span><span class="s2">"marine.RData"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h4 id="data-formatting">Data formatting</h4>

<p>The <code class="language-plaintext highlighter-rouge">beluga</code> object contains hundreds of columns with information about the GBIF records. To make our analysis quicker, we can select just the ones we need using the <code class="language-plaintext highlighter-rouge">select</code> function from the <code class="language-plaintext highlighter-rouge">dplyr</code> package, which picks out just the columns we asked for. Note that you can also use <code class="language-plaintext highlighter-rouge">select</code> to remove columns from a data frame by adding a <code class="language-plaintext highlighter-rouge">-</code> before a column name, e.g. <code class="language-plaintext highlighter-rouge">-region</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Data formatting &amp; manipulation ----</span><span class="w">
</span><span class="c1"># Simplify occurrence data frame</span><span class="w">
</span><span class="n">beluga</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">beluga</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">individualCount</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><b>We specified that we want the <code class="language-plaintext highlighter-rouge">select</code> function from exactly the <code class="language-plaintext highlighter-rouge">dplyr</code> package and not any other package we have loaded using <code class="language-plaintext highlighter-rouge">dplyr::select</code>. Otherwise, you might get this error:</b></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Error in (function (classes, fdef, mtable)  :</span><span class="w">
</span><span class="c1">#            unable to find an inherited method for function select for signature "grouped_df"</span><span class="w">
</span></code></pre></div></div>

<h4 id="format-and-manipulate-population-change-dataset">Format and manipulate population change dataset</h4>

<p><strong>Next, we will follow a few consecutive steps to format the population change data, exclude <code class="language-plaintext highlighter-rouge">NA</code> values and prepare the abundance data for analysis. Each step follows logically from the one before and we don’t need to store intermediate objects along the way - we just need the final object. For this purpose, we can use pipes.</strong></p>

<p><strong>Pipes (<code class="language-plaintext highlighter-rouge">%&gt;%</code>) are a way of streamlining data manipulation. Imagine all of your data coming in one end of the pipe, while they are in there, they are manipulated, summarised, etc., then the output (e.g. your new data frame or summary statistics) comes out the other end of the pipe. At each step of the pipe processing, the pipe takes the output of the previous step and applies the function you’ve chosen. For more information on data manipulation using pipes, you can check out our <a href="https://ourcodingclub.github.io/2017/01/16/piping.html" target="_blank" rel="noopener noreferrer">data formatting and manipulation tutorial</a>.</strong></p>

<p><strong>The population change data are in a wide format: each row contains a population that has been monitored over time and towards the right of the data frame, there are a lot of columns with population estimates for each year. To make this data “tidy” (one column per variable) we can use <code class="language-plaintext highlighter-rouge">gather()</code> to transform the data so there is a new column containing all the years for each population and an adjacent column containing all the population estimates for those years. Now if you wanted to compare between groups, treatments, species, etc, R would be able to split the dataframe correctly, as each grouping factor has its own column.</strong></p>

<p>We will take our original dataset <code class="language-plaintext highlighter-rouge">marine</code>, filter to include just the beluga populations and create a new column called <code class="language-plaintext highlighter-rouge">year</code>, fill it with column names from columns numbers 26 to 70 (<code class="language-plaintext highlighter-rouge">26:70</code>) and then use the data from these columns to make another column called <code class="language-plaintext highlighter-rouge">abundance</code>.</p>

<p>We should also scale the population data, because, since the data come from many species, the units and magnitude of the data are very different. Imagine tiny fish whose abundance is in the millions and large carnivores whose abundance is much smaller. By scaling the data, we are also normalising it so that later on we can use linear models with a normal distribution to quantify overall experienced population change.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Take a look at the population change data</span><span class="w">
</span><span class="n">View</span><span class="p">(</span><span class="n">marine</span><span class="p">)</span><span class="w">

</span><span class="c1"># Format population change data</span><span class="w">
</span><span class="n">beluga.pop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">marine</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">species</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Delphinapterus leucas"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Select only beluga populations</span><span class="w">
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"abundance"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="o">:</span><span class="m">70</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Turn data frame from wide to long format</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">abundance</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Remove empty rows</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">   </span><span class="c1"># Group rows so that each group is one population</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">scalepop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">abundance</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">abundance</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">abundance</span><span class="p">)</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">abundance</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Scale abundance from 0 to 1</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># Only include populations monitored at least 5 times</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">  </span><span class="c1"># Remove the grouping</span><span class="w">
</span></code></pre></div></div>

<p>Because column names are coded in as characters, when we turned the column names (<code class="language-plaintext highlighter-rouge">1970</code>, <code class="language-plaintext highlighter-rouge">1971</code>, <code class="language-plaintext highlighter-rouge">1972</code>, etc.) into rows, R automatically put an <code class="language-plaintext highlighter-rouge">X</code> in front of the numbers to force them to remain characters. We don’t want that, so to turn <code class="language-plaintext highlighter-rouge">year</code> into a numeric variable, you can use the <code class="language-plaintext highlighter-rouge">parse_number</code> function from the <code class="language-plaintext highlighter-rouge">readr</code> package.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Explore data frame</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">beluga.pop</span><span class="p">)</span><span class="w">
</span><span class="c1"># Year is a character variable because the years used to be column names</span><span class="w">
</span><span class="c1"># We have to remove the "X" in front of all years to make year numeric</span><span class="w">

</span><span class="c1"># Get rid of the X in front of years</span><span class="w">
</span><span class="n">beluga.pop</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">beluga.pop</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h4 id="quantify-population-change">Quantify population change</h4>

<p><strong>We will fit simple linear models (abundance over time for each population, <code class="language-plaintext highlighter-rouge">abundance ~ year</code>) to get a measure of the overall change experienced by each population for the period it was monitored. We will extract the slope, i.e. the estimate for the <code class="language-plaintext highlighter-rouge">year</code> term for each population. We can do this in a pipe as well, which makes for an efficient analysis. Here, we are analysing five populations, but you can also do it for thousands. With the <code class="language-plaintext highlighter-rouge">broom</code> package, we can extract model coefficients using one single line: <code class="language-plaintext highlighter-rouge">tidy(model_name)</code>.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate population change using linear models</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">beluga.pop</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w"> </span><span class="n">Decimal.Latitude</span><span class="p">,</span><span class="w"> </span><span class="n">Decimal.Longitude</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Group data so that we fit one model per population</span><span class="w">
  </span><span class="c1"># id is the identifier for each population</span><span class="w">
  </span><span class="n">do</span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">scalepop</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Fit a linear model</span><span class="w">
  </span><span class="n">tidy</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="w">  </span><span class="c1"># extract model coefficients using tidy() from the broom package</span><span class="w">

</span><span class="n">View</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="p">)</span><span class="w">

</span><span class="c1"># For analysis and plotting, we often need the intercept and slopes to be columns, not rows</span><span class="w">
</span><span class="c1"># Format data frame with model outputs</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">beluga.slopes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w"> </span><span class="n">Decimal.Latitude</span><span class="p">,</span><span class="w"> 
                </span><span class="n">Decimal.Longitude</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  
                </span><span class="c1"># Select the columns we need</span><span class="w">
  </span><span class="n">spread</span><span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># spread() is the opposite of gather()</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><a name="clean"></a></p>

<h3 id="2-clean-species-occurrence-data">2. Clean species occurrence data</h3>

<p>We have over a thousand GBIF occurrence records of belugas. Using the <code class="language-plaintext highlighter-rouge">CleanCoordinates</code> function from the <code class="language-plaintext highlighter-rouge">CoordinateCleaner</code> package, developed by Alexander Zizka, we can perform different tests of validity to flag potentially wrong coordinates (<a href="https://github.com/azizka/CoordinateCleaner" target="_blank" rel="noopener noreferrer">more info here</a>). For example, we are currently working with a marine species, the beluga whale, so we don’t expect to see those on land. Nevertheless, people sometimes see whales from land, i.e. when they are whalewatching from the coastline and when they take a GPS reading. That occurrence would technically be on land, since it’s for the land-based observer, not the whale swimming by. Additionally, some of the records might be from zoos, which can explain species appearing to occur outside of their usual ranges.</p>

<p>Before we perform the coordinate tests, we can make a quick map to get an idea of the spatial spread of the beluga GBIF records. With <code class="language-plaintext highlighter-rouge">ggplot2</code> and the <code class="language-plaintext highlighter-rouge">ggthemes</code> packages (the theme_map() function comes from <code class="language-plaintext highlighter-rouge">ggthemes</code>), you can make quick and easy maps. To choose colours for your map, you can use the <code class="language-plaintext highlighter-rouge">Rcolourpicker</code> addin, which offers a really easy way to get the colour codes for whatever colours you want right within <code class="language-plaintext highlighter-rouge">RStudio</code>.</p>

<h4 id="picking-colours-using-the-rcolourpicker-addin">Picking colours using the <code class="language-plaintext highlighter-rouge">Rcolourpicker</code> addin</h4>

<p>Setting custom colours for your graphs can set them apart from all the rest (we all know what the default <code class="language-plaintext highlighter-rouge">ggplot2</code> colours look like!), make them prettier and most importantly, give your work a consistent and logical colour scheme. Finding the codes, e.g. <code class="language-plaintext highlighter-rouge">colour="#8B5A00"</code>, for your chosen colours, however, can be a bit tedious. Though one can always use Paint / Photoshop / google colour codes, there is a way to do this within RStudio thanks to the addin <code class="language-plaintext highlighter-rouge">colourpicker</code>. RStudio addins are installed the same way as packages and you can access them by clicking on <code class="language-plaintext highlighter-rouge">Addins</code> in your RStudio menu. To install <code class="language-plaintext highlighter-rouge">colourpicker</code>, run the following code:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"colourpicker"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To find out what the code for a colour you like is, click on <code class="language-plaintext highlighter-rouge">Addins/Colour picker</code>.</p>

<center><img src="/img/colourpicker.png" alt="Img" style="width: 800px;"></center>

<p>When you click on <code class="language-plaintext highlighter-rouge">All R colours</code> you will see lots of different colours you can choose from. A good colour scheme makes your graph stand out, but of course, don’t go crazy with the colours. When you click on <code class="language-plaintext highlighter-rouge">1</code>, and then on a certain colour, you fill up <code class="language-plaintext highlighter-rouge">1</code> with that colour. The same goes for <code class="language-plaintext highlighter-rouge">2</code>, <code class="language-plaintext highlighter-rouge">3</code> - you can add mode colours with the <code class="language-plaintext highlighter-rouge">+</code> or delete them by clicking the bin. Once you’ve made your pick, click <code class="language-plaintext highlighter-rouge">Done</code>. You will see a line of code <code class="language-plaintext highlighter-rouge">c("#8B5A00", "#CD8500")</code> appear. In this case, we just need the colour code so we can copy that and delete the rest.</p>

<center><img src="/img/colourpicker2.png" alt="Img" style="width: 800px;"></center>

<p><strong>Now that we have our colours, we can make a map. A map is really like any other graph. In our <code class="language-plaintext highlighter-rouge">ggplot()</code> code, we have to specify a dataframe and then say what should be plotted on the x axis and on the y axis: in our case, the longitude and latitude of each occurrence record.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Data visualisation ----</span><span class="w">

</span><span class="c1"># Sample colour scheme c("gray40", "aquamarine3", "tan1")</span><span class="w">

</span><span class="c1"># ** Map of GBIF occurrences ----</span><span class="w">
</span><span class="p">(</span><span class="n">beluga.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">borders</span><span class="p">(</span><span class="s2">"worldHires"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	 </span><span class="c1"># get a high resolution map of the world</span><span class="w">
   </span><span class="n">theme_map</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
   </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">))</span><span class="w">  </span><span class="c1"># alpha controls the transparency, 1 is fully transparent</span><span class="w">
   
</span></code></pre></div></div>

<p>Note that putting your entire ggplot code in brackets () creates the graph and then shows it in the plot viewer. If you don’t have the brackets, you’ve only created the object, but haven’t visualised it. You would then have to call the object such that it will be displayed by just typing <code class="language-plaintext highlighter-rouge">beluga.map</code> after you’ve created the “beluga.map” object.</p>

<p><strong><code class="language-plaintext highlighter-rouge">ggplot2</code> works with aesthetics. That is the <code class="language-plaintext highlighter-rouge">aes</code> argument which “maps” your variables to the <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> axises.</strong></p>

<p><strong>When you want to change the colour, fill, shape or size of your points, bars or lines to vary depending on a certain variable, you have to include that argument <em>inside the <code class="language-plaintext highlighter-rouge">aes()</code> code</em>, e.g. <code class="language-plaintext highlighter-rouge">geom_point(alpha = 0.5, size = 2, aes(colour = individualCount)</code> will change the colour of the points based on the <code class="language-plaintext highlighter-rouge">individualCount</code> variable, which is a continuous variable showing how many individuals were recorded.</strong></p>

<p><strong>When you want to specify particular colours, shapes or sizes, those are included <em>outside of the <code class="language-plaintext highlighter-rouge">aes()</code> code</em>, e.g. <code class="language-plaintext highlighter-rouge">geom_point(alpha = 0.5, size = 2, colour = "aquamarine3")</code>.</strong></p>

<p><strong>Later on, if you are interested in learning how to use the <code class="language-plaintext highlighter-rouge">ggplot2</code> package to make many different types of graphs, you can check out <a href="https://ourcodingclub.github.io/2017/01/29/datavis.html" target="_blank" rel="noopener noreferrer">our tutorial introducing <code class="language-plaintext highlighter-rouge">ggplot2</code></a> and <a href="https://ourcodingclub.github.io/2017/03/29/data-vis-2.html" target="_blank" rel="noopener noreferrer">our tutorial on further customisation and data visualisation</a>.</strong></p>

<center> <img src="/img/beluga_map.png" alt="Img" style="width: 800px;"> </center>
<center>Figure 1. Map of all GBIF occurrences for the beluga whale.</center>

<p><strong>Do you spot any beluga whales where there shouldn’t be any? We can check what the <code class="language-plaintext highlighter-rouge">CleanCoordinates</code> function flags as potentially wrong records. The function performs a series of tests, e.g. are there any zeros among the longitude and latitude values, and then returns a summary dataframe of whether each occurrence record failed or passed each test (i.e. <code class="language-plaintext highlighter-rouge">FALSE</code> vs <code class="language-plaintext highlighter-rouge">TRUE</code>).</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ** Clean coordinate data ----</span><span class="w">
</span><span class="c1"># There are some obvious outliers</span><span class="w">
</span><span class="c1"># We should check the coordinates for all occurrences</span><span class="w">

</span><span class="c1"># Load an object with a buffered coastline to asses if points are on land or at sea</span><span class="w">
</span><span class="n">load</span><span class="p">(</span><span class="s2">"buffland_1deg.rda"</span><span class="p">)</span><span class="w">
</span><span class="c1"># E.g. if we would like to keep the terrestrial records that perhaps refer to</span><span class="w">
</span><span class="c1"># people spotting belugas from the coast</span><span class="w">

</span><span class="c1"># Test coordinates using clean_coordinates() from the CoordinateCleaner package</span><span class="w">
</span><span class="n">beluga.coord.test</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">clean_coordinates</span><span class="p">(</span><span class="n">beluga</span><span class="p">,</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"decimalLongitude"</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"decimalLatitude"</span><span class="p">,</span><span class="w">
                                       </span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"outliers"</span><span class="p">,</span><span class="w"> </span><span class="s2">"seas"</span><span class="p">,</span><span class="w"> </span><span class="s2">"zeros"</span><span class="p">),</span><span class="w"> 
                                       </span><span class="n">outliers_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"distance"</span><span class="p">,</span><span class="w"> </span><span class="n">outliers_td</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5000</span><span class="p">,</span><span class="w"> 
                                       </span><span class="n">seas_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffland</span><span class="p">)</span><span class="w">
</span><span class="c1"># species = "" refers to the name of the column which has the species name</span><span class="w">
</span><span class="c1"># By default, outliers are occurrences further than 1000km from any other occurrence</span><span class="w">
</span><span class="c1"># We can change that using outliers.td() with a value of our choice</span><span class="w">
</span><span class="c1"># We'll also test if occurrences are on land or at sea and if there are any zeros for lat and long</span><span class="w">

</span><span class="c1"># No need to worry about the warning message, just lets you know about one of the default tests</span><span class="w">
</span></code></pre></div></div>

<p><strong>Check out the result.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">View</span><span class="p">(</span><span class="n">beluga.coord.test</span><span class="p">)</span><span class="w">

</span><span class="c1"># Some the occurrences are on land, probably referring to the spot</span><span class="w">
</span><span class="c1"># on the coast from where someone saw the belugas or to a non-existing false record</span><span class="w">

</span><span class="c1"># Extract just occurrence classified as TRUE in the summary</span><span class="w">
</span><span class="c1"># using value = "clean"</span><span class="w">
</span><span class="n">beluga.clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">clean_coordinates</span><span class="p">(</span><span class="n">beluga</span><span class="p">,</span><span class="w"> </span><span class="n">lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"decimalLongitude"</span><span class="p">,</span><span class="w"> </span><span class="n">lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"decimalLatitude"</span><span class="p">,</span><span class="w">
                                       </span><span class="n">species</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"outliers"</span><span class="p">,</span><span class="w"> </span><span class="s2">"seas"</span><span class="p">,</span><span class="w"> </span><span class="s2">"zeros"</span><span class="p">),</span><span class="w"> 
                                       </span><span class="n">outliers_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"distance"</span><span class="p">,</span><span class="w"> </span><span class="n">outliers_td</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5000</span><span class="p">,</span><span class="w"> 
                                       </span><span class="n">seas_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffland</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"clean"</span><span class="p">)</span><span class="w">
</span><span class="c1"># Check out the result</span><span class="w">
</span><span class="n">View</span><span class="p">(</span><span class="n">beluga.clean</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Now we can update our map by swapping the <code class="language-plaintext highlighter-rouge">beluga</code> object with the <code class="language-plaintext highlighter-rouge">beluga.clean</code> object to see what difference cleaning the coordinate data made. When cleaning coordinate data for your own analyses, you can include further tests, e.g. if you are doing a UK-scale analysis, you can check whether the points are actually in the UK. As usual with research, the decision about what to include or exclude is yours and the <code class="language-plaintext highlighter-rouge">clean_coordinates</code> function offers one way to inform your decision.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make a map of the clean GBIF occurrences</span><span class="w">
</span><span class="p">(</span><span class="n">beluga.map.clean</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga.clean</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">borders</span><span class="p">(</span><span class="s2">"worldHires"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_map</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/beluga_map_clean.png" alt="Img" style="width: 800px;"> </center>
<center>Figure 2. Map of GBIF occurrences for the beluga whale after filtering for records that passed the coordinate validity tests.</center>

<p>Interestingly, some land points still appear. The tests did remove the obvious outliers, like the beluga record near Africa. We can manually exclude points we think are not real if we wish, e.g. the Greenland land point is fairly distinct and easy to remove.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">greenland</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">beluga</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Greenland"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get the unique coordinates as some occurrences are from the same place</span><span class="w">
</span><span class="n">greenland</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="n">greenland</span><span class="p">,</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">distinct</span><span class="p">()</span><span class="w">

</span><span class="n">View</span><span class="p">(</span><span class="n">greenland</span><span class="p">)</span><span class="w">

</span><span class="c1"># The point to exclude is the one in the far east</span><span class="w">
</span><span class="c1"># Longitude -46.00000  Latitude 65.00000</span><span class="w">

</span><span class="c1"># Find out which rows match that criteria using which()</span><span class="w">
</span><span class="n">which</span><span class="p">(</span><span class="n">beluga.clean</span><span class="o">$</span><span class="n">decimalLongitude</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">-46</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">beluga.clean</span><span class="o">$</span><span class="n">decimalLatitude</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">65</span><span class="p">)</span><span class="w">
</span><span class="c1"># rows numbers 1421 1422 1423 1424 1530</span><span class="w">

</span><span class="n">beluga.base</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">beluga.clean</span><span class="p">[</span><span class="o">-</span><span class="nf">c</span><span class="p">(</span><span class="m">1421</span><span class="p">,</span><span class="w"> </span><span class="m">1422</span><span class="p">,</span><span class="w"> </span><span class="m">1423</span><span class="p">,</span><span class="w"> </span><span class="m">1424</span><span class="p">,</span><span class="w"> </span><span class="m">1530</span><span class="p">),]</span><span class="w"> </span><span class="c1"># selects all columns and removes those rows</span><span class="w">

</span><span class="c1"># Alternatively, you can filter those points out in a pipe</span><span class="w">
</span><span class="n">beluga.pipe</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">beluga.clean</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">decimalLongitude</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">-46</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">65</span><span class="p">)</span><span class="w">

</span><span class="c1"># The results are the same, which you can confirm using anti_join() from dplyr</span><span class="w">
</span><span class="n">anti_join</span><span class="p">(</span><span class="n">beluga.base</span><span class="p">,</span><span class="w"> </span><span class="n">beluga.pipe</span><span class="p">)</span><span class="w">  </span><span class="c1"># There are no differences</span><span class="w">
</span></code></pre></div></div>

<p><strong>We could keep going with the occurrence clean up and you could use the identifier for each record (the <code class="language-plaintext highlighter-rouge">key</code> column in the data frame that has a unique value for each record) to go back to the original GBIF data and filter out that record, using e.g. <code class="language-plaintext highlighter-rouge">new.beluga &lt;- filter(beluga.clean, key != "whatever the key number is")</code>. You can also look up the many columns of data from the original GBIF dataframe to get more information on that specific record, e.g. is it from a wild population, how was it collected and by whom. Then you might decide you want to exclude more records.</strong></p>

<p><strong>For now, we will move onto more data visualisation. We will customise our map of beluga occurrence, visualise when the records were collected and how some of the beluga populations have changed through time.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Make a new map and include the locations of the populations part of the Living Planet Database</span><span class="w">
</span><span class="p">(</span><span class="n">beluga.map.LPI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga.base</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">borders</span><span class="p">(</span><span class="s2">"worldHires"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_map</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beluga.slopes</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Longitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Latitude</span><span class="p">),</span><span class="w">  </span><span class="c1"># Add the points from the population change data</span><span class="w">
               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tan1"</span><span class="p">))</span><span class="w">
</span><span class="c1"># You have to specify where the data come from when plotting from more than one dataframe using data = ""</span><span class="w">
</span></code></pre></div></div>

<p><strong>The <code class="language-plaintext highlighter-rouge">ggplot2</code> package offers many different ways you can customise your graphs. We will use some of those here and we will also use an additional package, <code class="language-plaintext highlighter-rouge">ggrepel</code>, which adds nice labels for the points we specified, e.g. from our map, we know where belugas occur (the GBIF records) and some of the places where they have been monitored (the population change points) and we can label the monitoring sites. First, we have to make sure the names are consistent and we don’t want them to be too long so we can rename them using the <code class="language-plaintext highlighter-rouge">recode()</code> function from <code class="language-plaintext highlighter-rouge">dplyr</code>.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Customising map ----</span><span class="w">
</span><span class="c1"># Beautify by adding labels for the three sites and a beluga icon</span><span class="w">

</span><span class="c1"># Check site names</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">)</span><span class="w">

</span><span class="c1"># Make site names consistent</span><span class="w">
</span><span class="c1"># Make sure the original names are the same as shown on your computer - sometimes R will read </span><span class="w">
</span><span class="c1"># in the variables differently i.e. Quebec may be "Qu&lt;ed&gt;&lt;a9&gt;bec" or "Qu\xed\xa9bec"</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w">
                                               </span><span class="s2">"Cook Inlet stock, Alaska"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cook Inlet stock"</span><span class="p">)</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w">
                                               </span><span class="s2">"Eastern Hudson Bay, Quí©bec"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Eastern Hudson Bay"</span><span class="p">)</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w">
                                               </span><span class="s2">"St. Lawrence estuary population"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"St. Lawrence Estuary"</span><span class="p">)</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w">
                                               </span><span class="s2">"St. Lawrence Estuary population"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"St. Lawrence Estuary"</span><span class="p">)</span><span class="w">
</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">,</span><span class="w">
                                               </span><span class="s2">"St. Lawrence estuary, Canada"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"St. Lawrence Estuary"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Check names</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">Location.of.population</span><span class="p">)</span><span class="w">
</span><span class="c1"># Note that even though we have filtered for just the beluga records, the rest of the locations</span><span class="w">
</span><span class="c1"># for the other marine LPI populations feature as object attributes, but not to worry, those don't get analysed</span><span class="w">
</span></code></pre></div></div>

<p><strong>We can use the <code class="language-plaintext highlighter-rouge">annotation_custom</code> function from <code class="language-plaintext highlighter-rouge">ggplot2</code> to add images to our graphs, for example, a beluga icon. Sometimes you have to make the same graphs, but for different places or species groups, so adding icons can help quickly orient the viewer.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load packages for adding images</span><span class="w">
</span><span class="n">packs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"png"</span><span class="p">,</span><span class="s2">"grid"</span><span class="p">)</span><span class="w">
</span><span class="n">lapply</span><span class="p">(</span><span class="n">packs</span><span class="p">,</span><span class="w"> </span><span class="n">require</span><span class="p">,</span><span class="w"> </span><span class="n">character.only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># Load beluga icon</span><span class="w">
</span><span class="n">icon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">readPNG</span><span class="p">(</span><span class="s2">"beluga_icon.png"</span><span class="p">)</span><span class="w">
</span><span class="n">icon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rasterGrob</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span><span class="w"> </span><span class="n">interpolate</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># You can ignore the warning message, it's referring to the colour profile of the image</span><span class="w">
</span><span class="c1"># Doesn't matter for our icon</span><span class="w">
</span></code></pre></div></div>

<p><strong>Now comes what looks like a gigantic chunk of code! We have explained each step in the comments so you can  read through the code before you run it. This doesn’t mean that every time you make a map, your code has to be this long. From the maps above, you can see that 4-5 lines of code make a pretty decent map. Here, we have included a lot of customising options, including how to plot points from different data frames on the same map, how to add labels, icons and change the title so that when it comes to making your own maps, you can pick and choose whichever ones are relevant for your map.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Update map</span><span class="w">
</span><span class="p">(</span><span class="n">beluga.map.final</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga.base</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">borders</span><span class="p">(</span><span class="s2">"worldHires"</span><span class="p">,</span><span class="w"> </span><span class="n">ylim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_map</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_label_repel</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beluga.slopes</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,],</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Longitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Latitude</span><span class="p">,</span><span class="w">
                                                     </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Location.of.population</span><span class="p">),</span><span class="w">
                     </span><span class="n">box.padding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">nudge_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w">
                     </span><span class="n">nudge_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,]</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">13273</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">-4</span><span class="p">),</span><span class="w">
                     </span><span class="n">min.segment.length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">inherit.aes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="c1"># Adding labels, here is what is happening step by step for the labels</span><span class="w">

		</span><span class="c1"># We are specifying the dataframe for the labels - one site has three monitored populations</span><span class="w">
		</span><span class="c1"># but we only want to label it once so we are subsetting using data = beluga.slopes[1:3,]</span><span class="w">
		</span><span class="c1"># to get only the first three rows and all columns</span><span class="w">

		</span><span class="c1">#	We are specifying the size of the labels and nudging the points so that they</span><span class="w">
		</span><span class="c1"># don't hide data points, along the x axis we are nudging by one and along the</span><span class="w">
		</span><span class="c1"># y axis, we have an ifelse statement.</span><span class="w">

		</span><span class="c1"># Ifelse statements are great! All this means is that if the population id is 13273,</span><span class="w">
		</span><span class="c1"># that label will be nudged upwards by four, if it's not, i.e. "else", it will</span><span class="w">
		</span><span class="c1"># be nudged downwards by four. This way the labels can be nudged in different directions							 </span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beluga.slopes</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Longitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Latitude</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.6</span><span class="p">),</span><span class="w">
               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tan1"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beluga.slopes</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Longitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decimal.Latitude</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.3</span><span class="p">),</span><span class="w">
               </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tan1"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"tan1"</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="c1"># Adding the points for population change</span><span class="w">
		</span><span class="c1"># We can recreate the shape of a dropped pin by overlaying a circle and a triangle</span><span class="w">
    </span><span class="n">annotation_custom</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span><span class="w"> </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-210</span><span class="p">,</span><span class="w"> </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-120</span><span class="p">,</span><span class="w"> </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">35</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Adding the icon</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"a. Beluga GBIF occurrences"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Adding a title</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">)))</span><span class="w">  </span><span class="c1"># Setting the size for the title</span><span class="w">
</span></code></pre></div></div>

<p><strong>We can use <code class="language-plaintext highlighter-rouge">ggsave()</code> to save the map. By default, the width and height are measured in inches.`</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Save the plot, it will get saved in your working directory</span><span class="w">
</span><span class="c1"># You can use getwd() to find out where your working directory was</span><span class="w">
</span><span class="n">getwd</span><span class="p">()</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="n">beluga.map.final</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"beluga_map_final.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/beluga_map_final.png" alt="Img" style="width: 800px;"> </center>
<center>Figure 3. Map of beluga occurrence and monitoring sites</center>

<p><strong>Next, we will have a go at two other kinds of graphs, a line graph and a few scatterplots with linear model fits. We can use our custom <code class="language-plaintext highlighter-rouge">ggplot2</code> theme, <code class="language-plaintext highlighter-rouge">theme_marine</code>, so that all of our graphs have consistent formatting and we don’t need to repeat the same code, e.g. to make the font a certain size, many times.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Number of occurrence records through time</span><span class="w">
</span><span class="n">yearly.obs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">beluga.clean</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">tally</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">occurrences</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">yearly.obs</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_area</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Fill the area below the line graph with colour</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Number of occurrences\n"</span><span class="p">,</span><span class="w">  </span><span class="c1"># x = NULL means no x axis label</span><span class="w">
         </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"b. GBIF occurrences\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_marine</span><span class="p">())</span><span class="w">  </span><span class="c1"># Use our customised theme, saves many lines of code!</span><span class="w">
</span></code></pre></div></div>

<p><strong>For our final set of graphs, we will plot beluga abundance through time and a linear model fit of population change for each beluga population, part of the <a href="http://www.livingplanetindex.org/home/index" target="_blank" rel="noopener noreferrer">Living Planet Database</a>.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ** Population trends ----</span><span class="w">
</span><span class="c1"># Visualising the population trends of five beluga populations</span><span class="w">

</span><span class="c1"># Create an object for the Hudson Bay population</span><span class="w">
</span><span class="n">beluga1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">beluga.pop</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"13273"</span><span class="p">)</span><span class="w">  

</span><span class="c1"># Get the slope of population change to print on the graph if you wish</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">year</span><span class="p">[</span><span class="n">beluga.slopes</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"13273"</span><span class="p">])</span><span class="w">

</span><span class="p">(</span><span class="n">hudson.bay</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga1</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="c1"># shape 21 chooses a point with a black outline filled with aquamarine</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="c1"># Adds a linear model fit, alpha controls the transparency of the confidence intervals</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Individuals\n"</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"c. Eastern Hudson Bay\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="c1"># annotate("text", x = 2002, y = 6000, label = "Slope = -0.02", size = 7) +</span><span class="w">
    </span><span class="c1"># if you want to add text, uncomment the line above</span><span class="w">
    </span><span class="n">theme_marine</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p><strong>Now, we can modify the code a bit to make a graph for the Cook Inlet stock population.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">beluga2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">beluga.pop</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"2191"</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">cook.inlet</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"d. Cook Inlet stock\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_marine</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p><strong>The last site, St. Lawrence estuary, has been monitored by three different studies in different time periods.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create an object containing the three populations in the St. Lawrence estuary</span><span class="w">
</span><span class="c1"># using the "|" operator</span><span class="w">
</span><span class="n">beluga3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">beluga.pop</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"1950"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"4557"</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"4558"</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">st.lawrence.est</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">beluga3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">id</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_shape_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="m">24</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"aquamarine3"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"e. St. Lawrence estuary\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_marine</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">guides</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>You might have noticed that the process is a bit repetitive. We are performing the same action, but for different species. It’s not that big of a deal for three populations, but imagine we had a thousand!  If that were the case, we could have used a loop that goes through each population and makes a graph, or we could have used a pipe, where we group by population id and then make the graphs and finally we could have used the <code class="language-plaintext highlighter-rouge">lapply()</code> function which applies a function, in our case making a graph, to e.g. each population. There are many options and if you would like to learn more on how to automate your analysis and data visualisation when doing the same thing for many places or species, you can check out <a href="https://ourcodingclub.github.io/2017/03/20/seecc.html" target="_blank" rel="noopener noreferrer">our tutorial comparing loops, pipes and <code class="language-plaintext highlighter-rouge">lapply()</code></a> and <a href="https://ourcodingclub.github.io/2017/02/08/funandloops.html" target="_blank" rel="noopener noreferrer">our tutorial on using functions and loops</a>.</p>

<h4 id="arrange-all-graphs-in-a-panel-with-the-gridextra-package">Arrange all graphs in a panel with the <code class="language-plaintext highlighter-rouge">gridExtra</code> package</h4>

<p>The <code class="language-plaintext highlighter-rouge">grid.arrange</code> function from the <code class="language-plaintext highlighter-rouge">gridExtra</code> package creates panels of different graphs. You can check out our <a href="https://ourcodingclub.github.io/2017/01/29/datavis.html#panel" target="_blank" rel="noopener noreferrer">data visualisation tutorial</a> to find out more about <code class="language-plaintext highlighter-rouge">grid.arrange</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create panel of all graphs</span><span class="w">
</span><span class="n">row1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">beluga.map.final</span><span class="p">,</span><span class="w"> </span><span class="n">occurrences</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">widths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1.96</span><span class="p">,</span><span class="w"> </span><span class="m">1.04</span><span class="p">))</span><span class="w">
</span><span class="c1"># Makes a panel of the map and occurrence plot and specifies the ratio, i.e. we want the map to be wider than the graph</span><span class="w">
</span><span class="n">row2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">hudson.bay</span><span class="p">,</span><span class="w"> </span><span class="n">cook.inlet</span><span class="p">,</span><span class="w"> </span><span class="n">st.lawrence.est</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">widths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1.1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="c1"># Makes a panel of all the population plots and sets the ratio</span><span class="w">
</span><span class="c1"># We are giving the first graph more space because that's the one with the y axis label</span><span class="w">
</span><span class="n">beluga.panel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">row1</span><span class="p">,</span><span class="w"> </span><span class="n">row2</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">heights</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">1.1</span><span class="p">))</span><span class="w">
</span><span class="c1"># Stitching it all together</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/beluga_panel.png" alt="Img" style="width: 1000px;"> </center>
<center>Figure 4. <b>a. Map of beluga occurrence and monitoring sites; b. occurrence records through time and population trends in c. Hudson Bay, d. Cook Inlet stock and e. St. Lawrence estuary.</b> Note that in St. Lawrence estuary, beluga populations were monitored in three separate studies.</center>

<hr>

<hr>

<p><strong>Check out <a href="https://ourcodingclub.github.io/workshop/" target="_blank" rel="noopener noreferrer">this page</a> to learn how you can get involved! We are very happy to have people use our tutorials and adapt them to their needs. We are also very keen to expand the content on the website, so feel free to get in touch if you’d like to write a tutorial!</strong></p>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a>. <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="Img" style="width: 100px;"></a></p>

<h3><a href="https://www.surveymonkey.com/r/JYDDZ8F" target="_blank" rel="noopener noreferrer">  We would love to hear your feedback, please fill out our survey!</a></h3>
<p><br></p>
<h3>  You can contact us with any questions on <a href="mailto:ourcodingclub@gmail.com?Subject=Tutorial%20question" target="_top">ourcodingclub@gmail.com</a>
</h3>
<p><br></p>
<h3>  Related tutorials:</h3>

<ul>
  
  
</ul>
<p><br></p>
<h3>  Subscribe to our mailing list:</h3>
<div class="container">
	<div class="block">
        <!-- subscribe form start -->
		<div class="form-group">
			<form action="https://getsimpleform.com/messages?form_api_token=de1ba2f2f947822946fb6e835437ec78" method="post">
			<div class="form-group">
				<input type="text" class="form-control" name="Email" placeholder="Email" required="">
			</div>
			<div>
                        	<button class="btn btn-default" type="submit">Subscribe</button>
                    	</div>
                	</form>
		</div>
	</div>
</div>

<ul class="social-icons">
	<li>
		<h3>
			<a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer"> Follow our coding adventures on Twitter! <i class="fa fa-twitter"></i></a>
		</h3>
	</li>
</ul>

    	<footer class="footer">
	<hr>
	<div class="footer-container">
    	<ul class="footer-link-list">
        	<li><a href="/tutorials">Tutorials</a></li>
        	<li><a href="/team">About Us</a></li>
        	<li><a href="/contact">Contact us</a></li>
	    	<li><a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer">Follow us on Twitter</a></li>
    	</ul>
    	<div class="footer-text">
			<p>We are happy for people to use and further develop our tutorials - please give credit to Coding Club by linking to <a href="https://ourcodingclub.github.io/" target="_blank" rel="noopener noreferrer">our website</a>. We are also happy to discuss possible collaborations, so get in touch at <b>ourcodingclub@gmail.com</b></p>
    		<p>See our <a href="/terms">Terms of Use</a> and our <a href="/privacy">Data Privacy policy</a>.</p>
			<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a></p>
			<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img class="license" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="CC-by-sa-4.0"></a>
    	</div>
    </div>
</footer>

<!-- JS -->
<script src="/scripts/owl.carousel.js"></script>
<script src="/scripts/owl.carousel-init.js"></script>
<script src="/scripts/reveal.js"></script>


	
	</body>
</html>
