<!DOCTYPE html>
<html lang="en-GB">
	<head>
    	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Intro to functional programming</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->
<link rel="stylesheet" href="/css/main.css"/>
<link rel="stylesheet" href="/css/owlcarousel/owl.carousel.css">
<link rel="stylesheet" href="/css/owlcarousel/owl.theme.default.css">

<!-- JS -->
<script src="https://use.fontawesome.com/4dd22df1f8.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/scripts/accordion.js"></script>
<script src="/scripts/jquery.counterup.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.5/waypoints.min.js"></script>
<script src="/scripts/ticker.js"></script>

	</head>
	<body>
    	<header class="header">
	<div class="navigation-bar">
		<div id="navigation-container">
			
				<a class="logo" href="/">
  <img src="/assets/img/logos/logo_stack.svg" alt="Coding Club logo">
</a>

			
			<nav>
				<label for="hamburger">☰</label>
				<input type="checkbox" id="hamburger">
				<ul>
					
						
					<li class="item item-nav">
						<a href="/">Home</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/tutorials.html">Tutorials</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/course.html">Course</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/team.html">Team</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/involve.html">Get involved</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/links.html">Links</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/contact.html">Contact</a>
					</li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>

			<div class="block">
	<center>
		<img src="/img/tutheader_functions.png" alt="Img">
	</center>
</div>

<h3 id="tutorial-aims">Tutorial aims:</h3>

<h4 id="-1-what-is-functional-programming"><a href="#introduction"> 1. What is functional programming</a></h4>

<h4 id="-2-building-a-simple-function"><a href="#function"> 2. Building a simple function</a></h4>

<h4 id="-3-functions-in-loops"><a href="#loop"> 3. Functions in loops</a></h4>

<h4 id="-4-functions-with-lapply"><a href="#apply"> 4. Functions with <code class="language-plaintext highlighter-rouge">lapply</code></a></h4>

<h4 id="-5-conditional-statements"><a href="#ifelse"> 5. Conditional statements</a></h4>

<h4 id="-6-bonus-write-a-loop-to-plot-multiple-graphs"><a href="#bonus"> 6. BONUS: Write a loop to plot multiple graphs</a></h4>

<p><a name="function"></a></p>

<h3 id="all-the-resources-for-this-tutorial-including-some-useful-extra-reading-can-be-downloaded-from-this-github-repository-clone-and-download-the-repo-as-a-zipfile-then-unzip-it">All the resources for this tutorial, including some useful extra reading can be downloaded from <a href="https://github.com/ourcodingclub/CC-5-fun-and-loop" target="_blank" rel="noopener noreferrer">this Github repository</a>. Clone and download the repo as a zipfile, then unzip it.</h3>

<p>Next, open up a new R Script, preferably in RStudio, where you will write the code for this tutorial. Set the folder you just downloaded as your working directory by running the code below (replacing <code class="language-plaintext highlighter-rouge">PATH_TO_FOLDER</code> with the location of the folder on your computer, e.g. <code class="language-plaintext highlighter-rouge">~/Downloads/CC-5-fun-and-loop</code>):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="s2">"PATH_TO_FOLDER"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="writing-functions">Writing functions</h3>

<p>We’ve learned <a href="https://ourcodingclub.github.io/2016/11/13/intro-to-r.html" target="_blank" rel="noopener noreferrer">how to import our data in RStudio</a>, <a href="https://ourcodingclub.github.io/2017/01/16/piping.html" target="_blank" rel="noopener noreferrer">format and manipulate them</a>, <a href="https://ourcodingclub.github.io/2016/11/24/rmarkdown-1.html" target="_blank" rel="noopener noreferrer">write scripts and Markdown reports</a>, and <a href="https://ourcodingclub.github.io/2017/01/29/datavis.html" target="_blank" rel="noopener noreferrer">how to make beautiful and informative graphs using <code class="language-plaintext highlighter-rouge">ggplot2</code></a>, meaning that you have all the basic tools to perform data simple data analysis using R.</p>

<p>You may find as you work away on your project however, that you want to repeat the same action multiple times. For example, you may want to multiple graphs which differ only in their data input. The temptation is to copy and paste the code multiple times in the script, changing the input dataset each time, but all this copying and pasting increases the chance that you will make a mistake, and it also means that if you want to change some shared element of those copied code chunks, you will have to change each chunk individually.</p>

<p>In this workshop, we introduce the concept of functions and loops in <code class="language-plaintext highlighter-rouge">R</code> as a method to minimise the need to copy and paste code chunks, helping to make your code more efficient and readable and minimise the chance of making mistakes by manually retyping code. This tutorial also expands on how to use functions effectively in your code and gives a more formal introduction to <strong>functional programming</strong> as a coding style.</p>

<p><strong><code class="language-plaintext highlighter-rouge">R</code> is a functional programming language at its heart. When you run a command on some data, e.g. <code class="language-plaintext highlighter-rouge">sum(1, 2)</code>, sum is a function. Basically everything you do in <code class="language-plaintext highlighter-rouge">R</code> involves at least one function. Just as the base <code class="language-plaintext highlighter-rouge">R</code> language and other <code class="language-plaintext highlighter-rouge">R</code> packages contain functions, you can also write your own functions to perform various tasks using the same tools as package developers, and it’s not as hard as it sounds.</strong></p>

<p><a name="function"></a></p>

<h2 id="2-building-a-simple-function">2. Building a simple function</h2>

<p>Open a new <code class="language-plaintext highlighter-rouge">RStudio</code> session and create a new <code class="language-plaintext highlighter-rouge">R</code> script. If you haven’t already done so, download the resources needed for this tutorial from <a href="https://github.com/ourcodingclub/CC-5-fun-and-loop" target="_blank" rel="noopener noreferrer">this Github repository</a>. Clone and download the repo as a zipfile, then unzip it. In your <code class="language-plaintext highlighter-rouge">R</code> script, set the working directory to the repository you just downloaded by running the code below (replacing <code class="language-plaintext highlighter-rouge">PATH_TO_FOLDER</code> with the location of the folder on your computer, e.g. <code class="language-plaintext highlighter-rouge">~/Downloads/CC-5-fun-and-loop</code>):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="s2">"PATH_TO_FOLDER"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Let’s import some data from the downloaded repository that we can use to test the function on:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trees_bicuar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"trees_bicuar.csv"</span><span class="p">)</span><span class="w">
</span><span class="n">trees_mlunguya</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"trees_mlunguya.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The data contains information on tree stems surveyed in four 1 Ha plots at fieldsites around southern Africa. <code class="language-plaintext highlighter-rouge">trees_bicuar</code> contains data for trees in Bicuar National Park in southwest Angola, and <code class="language-plaintext highlighter-rouge">trees_mlunguya</code> contains data for trees in southern Mozambique. Each tree stem &gt;5 cm trunk diameter was measured for tree height and trunk diameter, and identified to species.</p>

<p>Have a look at the contents of <code class="language-plaintext highlighter-rouge">trees_bicuar</code> before we move on:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">trees_bicuar</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">trees_bicuar</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The basic syntax for creating a function looks like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">example.fn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">){</span><span class="w">
    </span><span class="c1"># Perform an action using x and y</span><span class="w">
    </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>The <code class="language-plaintext highlighter-rouge">function()</code> command is used to tell <code class="language-plaintext highlighter-rouge">R</code> that we are creating a function, and we are assigning the function to an object called <code class="language-plaintext highlighter-rouge">example.fn</code>. <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> are “arguments” for the function, i.e. things that the user provides when running the function, then in the curly brackets are the actions performed by the function, using the parameters defined by the user earlier in the function call, and any other objects in the working environment in this case adding <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code> together.</strong></p>

<p>Run the code above to create the function, then test the function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">example.fn</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>You should get an output of <code class="language-plaintext highlighter-rouge">3</code>, because the function <code class="language-plaintext highlighter-rouge">example.fn()</code> was provided with the values of <code class="language-plaintext highlighter-rouge">x = 1</code> and <code class="language-plaintext highlighter-rouge">y = 2</code>, which were then passed to the function, which performed the operation <code class="language-plaintext highlighter-rouge">x + y</code>. Note that the convention is to name a function using <code class="language-plaintext highlighter-rouge">.</code> rather than <code class="language-plaintext highlighter-rouge">_</code> which is normally used to define data objects. This isn’t a rule, but it’s best to stick to the conventions used by other programmers to keep things consistent.</p>

<p><code class="language-plaintext highlighter-rouge">example.fn()</code> is a very simple function, but your functions can be as simple or complex as you need them to be. For example, we can also define a function that calculates the basal area of each stem in m^2 from the diameter, which is in cm. The basal area is the cross-sectional area of the tree trunk if it was cut parallel to the ground.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">basal.area</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
	</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="m">40000</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>This function has one input, <code class="language-plaintext highlighter-rouge">x</code>. <code class="language-plaintext highlighter-rouge">x</code> can be a numeric vector, or a numeric column in a dataframe, basically anything that doesn’t cause an error in the body of the function. The body of the function multiplies <code class="language-plaintext highlighter-rouge">x^2</code> by <code class="language-plaintext highlighter-rouge">pi</code>, then divides by <code class="language-plaintext highlighter-rouge">40,000</code>, giving the basal area as an output.</p>

<p>Test the function by supplying the diameter column from the Bicuar tree stem data (<code class="language-plaintext highlighter-rouge">trees_bicuar$diam</code>) to see what the output is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">basal.area</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Function arguments don’t need to be called <code class="language-plaintext highlighter-rouge">x</code> and <code class="language-plaintext highlighter-rouge">y</code>, they can be any character string, for example, the function below works identically to the one above, only <code class="language-plaintext highlighter-rouge">x</code> is now referred to as <code class="language-plaintext highlighter-rouge">dbh</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">basal.area</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dbh</span><span class="p">){</span><span class="w">
	</span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="p">(</span><span class="n">dbh</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="m">40000</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Additionally, you can add a indeterminate number of extra arguments using the <code class="language-plaintext highlighter-rouge">...</code> operator. Imagine that we want to extend our <code class="language-plaintext highlighter-rouge">basal.area()</code> function so that it can compute the combined basal area of multiple vectors of diameter measurements, e.g. from multiple sites:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">basal.area</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">...</span><span class="p">){</span><span class="w">
    </span><span class="p">(</span><span class="nb">pi</span><span class="o">*</span><span class="nf">c</span><span class="p">(</span><span class="n">...</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="m">40000</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">basal.area</span><span class="p">(</span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">diam</span><span class="p">,</span><span class="w"> </span><span class="n">trees_mlunguya</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Just like a normal function, the output of <code class="language-plaintext highlighter-rouge">basal.area()</code> can be assigned to a new object, for example, as a new column in <code class="language-plaintext highlighter-rouge">trees_bicuar</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">basal.area</span><span class="p">(</span><span class="n">dbh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Writing functions for simple operations like the example above is useful if you want to perform the same operation multiple times throughout a script and don’t want to copy and paste the same code (e.g. <code class="language-plaintext highlighter-rouge">(pi*(dbh)^2)/40000</code>) multiple times, this reduces the chances that you will make a typo when copying and pasting.</strong></p>

<p><a name="loop"></a></p>

<h2 id="3-functions-in-loops">3. Functions in loops</h2>

<p>We’ve seen how to write a function and how they can be used to create concise re-usable operations that can be applied multiple times in a script without having to copy and paste, but where functions really come into their own is when combined with looping procedures. Loops serve to run the same operation on a group of objects, further minimising the replication of code.</p>

<p>Loops come in two main variants in R, <code class="language-plaintext highlighter-rouge">for()</code> loops and <code class="language-plaintext highlighter-rouge">while()</code> loops. In this workshop we will focus on <code class="language-plaintext highlighter-rouge">for()</code> loops, which are generally easier to read than <code class="language-plaintext highlighter-rouge">while()</code> loops, and can be used to perform the same sorts of actions. <code class="language-plaintext highlighter-rouge">while()</code> loops are used mainly when the user wants to perform an action a set number of times, whereas a <code class="language-plaintext highlighter-rouge">for()</code> loop is generally used when the user wants to perform an action on a named set of objects.</p>

<p>A <code class="language-plaintext highlighter-rouge">for()</code> loop iterates through a number of items, most commonly stored as a list, and performs some action equally on each item. It can drastically reduce the amount of copying and pasting.</p>

<p>The basic syntax for creating a <code class="language-plaintext highlighter-rouge">for()</code> loop looks like this:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">list</span><span class="p">){</span><span class="w">
    </span><span class="c1"># PERFORM SOME ACTION</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Imagine you have multiple field sites, each with four 1 Ha plots with the tree stem measurements described earlier. The data for each fieldsite is contained in a different dataframe, e.g. <code class="language-plaintext highlighter-rouge">trees_bicuar</code> and <code class="language-plaintext highlighter-rouge">trees_mlunguya</code>. If we wanted to calculate the basal area for all stems at both sites, we could run:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">basal.area</span><span class="p">(</span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
</span><span class="n">trees_mlunguya</span><span class="o">$</span><span class="n">ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">basal.area</span><span class="p">(</span><span class="n">trees_mlunguya</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The above seems fine for now, but what if we had 100 field sites instead of just two? In that case, you can use a <code class="language-plaintext highlighter-rouge">for()</code> loop. First, we have to create a list of dataframes to perform the loop on. There are many ways of doing this, but the simplest way is:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trees</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s2">"trees_bicuar"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_bicuar</span><span class="p">,</span><span class="w"> </span><span class="s2">"trees_mlunguya"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trees_mlunguya</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><em>This makes a list called <code class="language-plaintext highlighter-rouge">trees</code>, where each element in the list is a dataframe. List items within a list can be accessed using double square brackets, e.g. <code class="language-plaintext highlighter-rouge">trees[[1]]</code> selects the first list item, the dataframe for <code class="language-plaintext highlighter-rouge">trees_bicuar</code>. We can take advantage of this method of list indexing using square brackets when we construct our <code class="language-plaintext highlighter-rouge">for()</code> loop:</em></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">trees</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w">
	</span><span class="n">trees</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">basal.area</span><span class="p">(</span><span class="n">trees</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>The first line sets up the loop, similar to how the <code class="language-plaintext highlighter-rouge">function()</code> definition worked earlier. <code class="language-plaintext highlighter-rouge">1:length(trees)</code> creates a sequence of integers from 1 to the length of the list (<code class="language-plaintext highlighter-rouge">trees</code>), so in this case the sequence will be <code class="language-plaintext highlighter-rouge">1, 2</code> as there are two list items. <code class="language-plaintext highlighter-rouge">i</code> will take each value of <code class="language-plaintext highlighter-rouge">1:length(trees)</code> in turn, then run the actions in the curly brackets once. For example, the first time the loop runs, <code class="language-plaintext highlighter-rouge">i</code> will have a value of <code class="language-plaintext highlighter-rouge">1</code>, and the second time <code class="language-plaintext highlighter-rouge">i</code> will have a value of <code class="language-plaintext highlighter-rouge">2</code>. Once the loop has run for the second time, the loop will end, as there are no further values in <code class="language-plaintext highlighter-rouge">1:length(trees)</code>.</strong></p>

<p>The body of the loop creates a new column in each dataframe in the list, then runs the function <code class="language-plaintext highlighter-rouge">basal.area()</code> using the <code class="language-plaintext highlighter-rouge">diam</code> column from the same dataframe as the input. So, the first time the loop runs, it will create a new column called <code class="language-plaintext highlighter-rouge">ba</code> in the first list item in <code class="language-plaintext highlighter-rouge">trees</code>, <code class="language-plaintext highlighter-rouge">trees[[1]]</code>.</p>

<p>The above example illustrates how loops work, but often, data are not separated into multiple dataframes from the beginning, instead they are often in a single dataframe with a column to group the different datasets.</p>

<p>Returning to the <code class="language-plaintext highlighter-rouge">trees_mlunguya</code> dataset, you can see that there is a column called <code class="language-plaintext highlighter-rouge">year</code>, which denotes when each stem measurement was taken. Imagine we want to perform the basal area calculation on each year in the dataset, then find out whether the mean basal area of stems in the plots has changed over the years. We can do this using a <code class="language-plaintext highlighter-rouge">for()</code> loop.</p>

<p>First, separate <code class="language-plaintext highlighter-rouge">trees_mlunguya</code> into a list of dataframes, each based on the contents of the year column:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trees_mlunguya_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">trees_mlunguya</span><span class="p">,</span><span class="w"> </span><span class="n">trees_mlunguya</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then, run a <code class="language-plaintext highlighter-rouge">for()</code> loop to fill an empty list with the mean basal area of each year:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create an empty list</span><span class="w">
</span><span class="n">mean_ba_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">

</span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">trees_mlunguya_list</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w">
	</span><span class="n">ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">basal.area</span><span class="p">(</span><span class="n">trees_mlunguya_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">diam</span><span class="p">)</span><span class="w">
	</span><span class="n">mean_ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">ba</span><span class="p">)</span><span class="w">
	</span><span class="n">year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">trees_mlunguya_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
	</span><span class="n">dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">mean_ba</span><span class="p">)</span><span class="w">
	</span><span class="n">mean_ba_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dat</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>During each iteration, this loop creates a number of intermediate data objects (<code class="language-plaintext highlighter-rouge">ba</code>, <code class="language-plaintext highlighter-rouge">mean_ba</code>, <code class="language-plaintext highlighter-rouge">year</code>), and eventually returns a dataframe (<code class="language-plaintext highlighter-rouge">dat</code>) with a single row and two columns, one for year and one for mean basal area. Each of these dataframes are then stored as a list item in the new list <code class="language-plaintext highlighter-rouge">mean_ba_list</code>.</p>

<p>Of course, this intermediate calculation could be stored in it’s own custom function:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ba.mean.year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dbh</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="p">){</span><span class="w">
	</span><span class="n">data.frame</span><span class="p">(</span><span class="w">
        </span><span class="n">mean_ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">basal.area</span><span class="p">(</span><span class="n">dbh</span><span class="p">)),</span><span class="w">
        </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">    
</span><span class="p">}</span><span class="w">

</span><span class="n">ba.mean.year</span><span class="p">(</span><span class="n">trees_mlunguya_list</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">diam</span><span class="p">,</span><span class="w"> </span><span class="n">trees_mlunguya_list</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>And this new function can be used in the for loop:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">trees_mlunguya_list</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w">
	</span><span class="n">mean_ba_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ba.mean.year</span><span class="p">(</span><span class="w">
		</span><span class="n">trees_mlunguya_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">diam</span><span class="p">,</span><span class="w">
		</span><span class="n">trees_mlunguya_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Note that this <code class="language-plaintext highlighter-rouge">for()</code> loop now contains a custom function (<code class="language-plaintext highlighter-rouge">ba.mean.year()</code>), which itself contains a custom function (<code class="language-plaintext highlighter-rouge">basal.area()</code>), demonstrating that there is really no limit to the complexity you can create with functional programming tools like loops and function calls. You can even have loops within loops, and loops in functions!</p>

<p><a name="apply"></a></p>

<h2 id="4-functions-with-lapply-family">4. Functions with <code class="language-plaintext highlighter-rouge">lapply()</code> family</h2>

<p><strong><code class="language-plaintext highlighter-rouge">for()</code> loops are very useful for quickly iterating over a list, but because R prefers to store everything as a new object with each loop iteration, loops can become quite slow if they are complex, or running many processes and many iterations. As an alternative <code class="language-plaintext highlighter-rouge">lapply()</code> and the <code class="language-plaintext highlighter-rouge">apply</code> family of functions more broadly can be used as an alternative to loops. <code class="language-plaintext highlighter-rouge">lapply()</code> runs operations on lists of items, similar to the <code class="language-plaintext highlighter-rouge">for()</code> loops above. To replicate the previous <code class="language-plaintext highlighter-rouge">for()</code> loop, where we calculated the mean basal area per year in <code class="language-plaintext highlighter-rouge">trees_mlunguya</code>, you can run:</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lapply</span><span class="p">(</span><span class="n">trees_mlunguya_list</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">ba.mean.year</span><span class="p">(</span><span class="n">dbh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">diam</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">year</span><span class="p">)})</span><span class="w">
</span></code></pre></div></div>

<p>The first argument of <code class="language-plaintext highlighter-rouge">lapply()</code> gives the list object to be iterated over. The second argument defines an unnamed function, where <code class="language-plaintext highlighter-rouge">x</code> will be replaced with each list item as <code class="language-plaintext highlighter-rouge">lapply()</code> iterates over them. The code inside the curly brackets is the unnamed function, which itself contains our custom function <code class="language-plaintext highlighter-rouge">ba.mean.year()</code>.</p>

<p>As well as being slightly faster than the <code class="language-plaintext highlighter-rouge">for()</code> loop, arguably, lapply is also easier to read than a <code class="language-plaintext highlighter-rouge">for()</code> loop.</p>

<p>For another example to illustrate another way <code class="language-plaintext highlighter-rouge">lapply()</code> can be used, imagine we wanted to find the mean height of trees in <code class="language-plaintext highlighter-rouge">trees_bicuar</code> for each taxonomic family.</p>

<p>First, create a list of vectors of height (rather than dataframes) where each list is a different family of species.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bicuar_height_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">family</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then run <code class="language-plaintext highlighter-rouge">lapply()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lapply</span><span class="p">(</span><span class="n">bicuar_height_list</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Notice how we didn’t have to use curly brackets or an anonymous function, instead, we just passed <code class="language-plaintext highlighter-rouge">mean</code> as the second argument of <code class="language-plaintext highlighter-rouge">lapply()</code>. I also supplied an argument to <code class="language-plaintext highlighter-rouge">mean()</code> simply by specifying it afterwards (<code class="language-plaintext highlighter-rouge">na.rm = TRUE</code>).</p>

<p>I could use <code class="language-plaintext highlighter-rouge">sapply()</code> to get a more readable output from this loop. <code class="language-plaintext highlighter-rouge">sapply()</code> simplifies the output of <code class="language-plaintext highlighter-rouge">lapply()</code> to a vector, with elements in the vector named according to the name of the items in the original list:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sapply</span><span class="p">(</span><span class="n">bicuar_height_list</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">sapply()</code> won’t be able to simplify the output of every <code class="language-plaintext highlighter-rouge">lapply()</code> loop, especially if the output is complex, but for this example, where we only have a single named decimal number, sapply works well.</p>

<p><a name="ifelse"></a></p>

<h2 id="5-conditional-statements">5. Conditional statements</h2>

<p>Another useful functional programming technique is to use conditional statements to change how the code is run depending on whether certain conditions are met. This means that you can create more complex functions that can be applied in a wider range of situations.</p>

<p>For example, in the <code class="language-plaintext highlighter-rouge">trees_bicuar</code> data there is a column which refers to the method by which <code class="language-plaintext highlighter-rouge">trees_bicuar$height</code> was measured, called <code class="language-plaintext highlighter-rouge">trees_bicuar$height_method</code>. One set of field assistants measured tree height with a long stick, while the others had access to a laser range finder, affecting the accuracy with which measurements were taken. Measurements taken with a stick were generally about 1 m short of the actual tree height, while measurements with the laser scanner is only certified accurate to +/- 0.1 m. So a simple correction would be to add 1 m to every measurement done with a stick, and round every measurement done with the laser to the nearest 0.1 m.</p>

<p>A common forestry metric to assess growth of a forest plot over time is “Lorey’s Mean Height”. Lorey’s mean height is calculated by multiplying tree height by the basal area of the tree, then dividing the sum of this calculation by the total plot basal area. We can construct a function which measures Lorey’s mean height for each plot, but we want to adjust the height estimates depending on which method was used. For this, we can use an <code class="language-plaintext highlighter-rouge">ifelse()</code> statement.</p>

<p>Basically an <code class="language-plaintext highlighter-rouge">ifelse()</code> statement tests for some logical TRUE/FALSE condition in the data, then performs one of two actions depending on the outcome of the test. E.g. “if the value of x is greater than 2, multiply it by 2, else if not, divide by 2”. The code below constructs a function with an <code class="language-plaintext highlighter-rouge">ifelse()</code> statement to calculate Lorey’s mean height for the Bicuar plots.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">stick.adj.lorey</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="p">,</span><span class="w"> </span><span class="n">ba</span><span class="p">){</span><span class="w">
	</span><span class="n">height_adj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"stick"</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">digits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">

	</span><span class="n">lorey_height</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">height_adj</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ba</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">ba</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

	</span><span class="nf">return</span><span class="p">(</span><span class="n">lorey_height</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Then we can test the function on each plot using <code class="language-plaintext highlighter-rouge">lapply()</code> like we did before:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trees_bicuar_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">trees_bicuar</span><span class="p">,</span><span class="w"> </span><span class="n">trees_bicuar</span><span class="o">$</span><span class="n">plotcode</span><span class="p">)</span><span class="w">

</span><span class="n">lapply</span><span class="p">(</span><span class="n">trees_bicuar_list</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="n">stick.adj.lorey</span><span class="p">(</span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">height_method</span><span class="p">,</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="o">$</span><span class="n">ba</span><span class="p">)})</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">ifelse()</code> statements can also be used in conjunction with logical TRUE/FALSE function arguments to determine whether certain actions are taken. For example, we can write a function that calculates summary statistics on the trunk diameter measurements for a given fieldsite, and we can use TRUE/FALSE arguments to let the user decide whether certain statistics are calculated:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">diam.summ</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">dbh</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">){</span><span class="w">
		</span><span class="n">mean_dbh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
			</span><span class="n">mean</span><span class="p">(</span><span class="n">dbh</span><span class="p">),</span><span class="w"> 
			</span><span class="kc">NA</span><span class="p">)</span><span class="w">
		</span><span class="n">median_dbh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">median</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
			</span><span class="n">median</span><span class="p">(</span><span class="n">dbh</span><span class="p">),</span><span class="w"> 
			</span><span class="kc">NA</span><span class="p">)</span><span class="w">
		</span><span class="n">mean_ba</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="n">ba</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> 
			</span><span class="n">mean</span><span class="p">(</span><span class="n">basal.area</span><span class="p">(</span><span class="n">dbh</span><span class="p">)),</span><span class="w"> 
			</span><span class="kc">NA</span><span class="p">)</span><span class="w">
		
		</span><span class="nf">return</span><span class="p">(</span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">na.omit</span><span class="p">(</span><span class="n">t</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">mean_dbh</span><span class="p">,</span><span class="w"> </span><span class="n">median_dbh</span><span class="p">,</span><span class="w"> </span><span class="n">mean_ba</span><span class="p">)))))</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">diam.summ</span><span class="p">(</span><span class="n">dbh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bicuar_trees</span><span class="o">$</span><span class="n">diam</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Also note that in this function definition the extra arguments have default values, e.g. <code class="language-plaintext highlighter-rouge">mean = TRUE</code>. This means that even if the user doesn’t specify what the value of <code class="language-plaintext highlighter-rouge">mean</code> should be, e.g. <code class="language-plaintext highlighter-rouge">diam.summ(dbh = trees_bicuar$diam, median = TRUE, mean_ba = FALSE)</code>, R will default to the value of <code class="language-plaintext highlighter-rouge">mean = TRUE</code>, thus calculating the mean trunk diameter.</p>

<p><a name="bonus"></a></p>

<h2 id="6-bonus-write-a-loop-to-plot-multiple-graphs">6. BONUS: Write a loop to plot multiple graphs</h2>

<p>This final section for the workshop provides another real world example using simple <code class="language-plaintext highlighter-rouge">for()</code> loops and functions to create multiple graphs of population trends from the <a href="http://www.livingplanetindex.org/" target="_blank" rel="noopener noreferrer">Living Planet Index</a> for a number of vertebrate species from 1970 to 2014. Work through the example to make sure that all the code makes sense, remembering the lessons from earlier in the workshop.</p>

<p>First, import the data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"LPI_data_loops.csv"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>You might remember making this scatter plot in the data visualisation tutorial, let’s go through it again for some <code class="language-plaintext highlighter-rouge">ggplot2</code> practice, and to set the scene for our functions later.</p>

<p>Scatter plot to examine how Griffon vulture populations have changed between 1970 and 2014 in Croatia and Italy:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vulture</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI</span><span class="p">,</span><span class="w"> </span><span class="n">Common.Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Griffon vulture / Eurasian griffon"</span><span class="p">)</span><span class="w">
</span><span class="n">vultureITCR</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">vulture</span><span class="p">,</span><span class="w"> </span><span class="n">Country.list</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Croatia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="n">vulture_scatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">vultureITCR</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Country.list</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                              </span><span class="c1"># Changing point size</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Country.list</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">                </span><span class="c1"># Adding a linear model fit and colour-coding by country</span><span class="w">
    </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#EE7600"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">               </span><span class="c1"># Adding custom colours</span><span class="w">
    </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#EE7600"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">),</span><span class="w">               </span><span class="c1"># Adding custom colours</span><span class="w">
                        </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Croatia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">               </span><span class="c1"># Adding labels for the legend</span><span class="w">
    </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Griffon vulture abundance\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                             
    </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"\nYear"</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
		</span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">       </span><span class="c1"># making the years at a bit of an angle</span><span class="w">
          </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
          </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">),</span><span class="w">             
          </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">),</span><span class="w">             
          </span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">                                </span><span class="c1"># Removing the background grid lines                </span><span class="w">
          </span><span class="n">panel.grid.minor.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">panel.grid.minor.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
          </span><span class="n">panel.grid.major.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">  
          </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">           </span><span class="c1"># Adding a 0.5cm margin around the plot</span><span class="w">
          </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">),</span><span class="w">              </span><span class="c1"># Setting the font for the legend text</span><span class="w">
          </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">                                      </span><span class="c1"># Removing the legend title</span><span class="w">
          </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">)))</span><span class="w">               </span><span class="c1"># Setting the position for the legend - 0 is left/bottom, 1 is top/right</span><span class="w">
</span></code></pre></div></div>

<center><img src="/img/gg_scatter3.png" alt="Img" style="width: 800px;"></center>

<p>Here we are using the <code class="language-plaintext highlighter-rouge">theme_bw()</code> theme but we are making lots of modifications to it. When we need to make lots of graphs, e.g. all the graphs for a given research project, we would ideally like to format them in a consistent way - same font size, same layout of the graph panel. That means that we will be repeating many lines of code, but instead of doing that, we can take all the changes we want to make to the <code class="language-plaintext highlighter-rouge">ggplot2</code> theme and combine them into a function of our own! As a reminder, to start writing a function, you first assign it to an object. Since we are making a personalised theme for <code class="language-plaintext highlighter-rouge">ggplot2</code>, here I’ve called my function <code class="language-plaintext highlighter-rouge">theme.my.own</code>. To tell R that you are writing a function, you use <code class="language-plaintext highlighter-rouge">function()</code> and then the commands that you want your function to include go between the <code class="language-plaintext highlighter-rouge">{}</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">theme.my.own</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(){</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">),</span><span class="w">             
        </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">),</span><span class="w">             
        </span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">                                          
        </span><span class="n">panel.grid.minor.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.minor.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.major.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">  
        </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">),</span><span class="w">          
        </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">                              
        </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Now we can make the same plot, but this time instead of all the code, we can just add <code class="language-plaintext highlighter-rouge">+ theme.my.own()</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">vulture_scatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">vultureITCR</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Country.list</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Country.list</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">                    
    </span><span class="n">theme.my.own</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">                                                    </span><span class="c1"># Adding our new theme!</span><span class="w">
    </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#EE7600"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">               
    </span><span class="n">scale_colour_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#EE7600"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">),</span><span class="w">               
                        </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Croatia"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Italy"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">                 
    </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Griffon vulture abundance\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                             
    </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"\nYear"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Remember that putting your entire ggplot code in brackets <code class="language-plaintext highlighter-rouge">()</code> creates the graph and then shows it in the plot viewer. If you don’t have the brackets, you’ve only created the object, but haven’t visualized it. You would then have to call the object such that it will be displayed by just typing <code class="language-plaintext highlighter-rouge">vulture_scatter</code> after you’ve created the <code class="language-plaintext highlighter-rouge">vulture_scatter</code> object.</p>

<p>Let’s make more plots, again using our customised theme.</p>

<p>Filter the data to include only UK populations.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI.UK</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI</span><span class="p">,</span><span class="w"> </span><span class="n">Country.list</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"United Kingdom"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Pick 4 species and make scatterplots with linear model fits that show how the population has varied through time</span><span class="w">
</span><span class="c1"># Careful with the spelling of the names, it needs to match the names of the species in the LPI.UK dataframe</span><span class="w">

</span><span class="n">house.sparrow</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI.UK</span><span class="p">,</span><span class="w"> </span><span class="n">Common.Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"House sparrow"</span><span class="p">)</span><span class="w">
</span><span class="n">great.tit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI.UK</span><span class="p">,</span><span class="w"> </span><span class="n">Common.Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Great tit"</span><span class="p">)</span><span class="w">
</span><span class="n">corn.bunting</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI.UK</span><span class="p">,</span><span class="w"> </span><span class="n">Common.Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Corn bunting"</span><span class="p">)</span><span class="w">
</span><span class="n">reed.bunting</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI.UK</span><span class="p">,</span><span class="w"> </span><span class="n">Common.Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Reed bunting"</span><span class="p">)</span><span class="w">
</span><span class="n">meadow.pipit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI.UK</span><span class="p">,</span><span class="w"> </span><span class="n">Common.Name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Meadow pipit"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Making the plots:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">house.sparrow_scatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">house.sparrow</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">          
    </span><span class="n">theme.my.own</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Abundance\n"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"House sparrow"</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="n">great.tit_scatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">great.tit</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">          
    </span><span class="n">theme.my.own</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Abundance\n"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Great tit"</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="n">corn.bunting_scatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">corn.bunting</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">          
    </span><span class="n">theme.my.own</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Abundance\n"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Corn bunting"</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="n">meadow.pipit_scatter</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">meadow.pipit</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">          
    </span><span class="n">theme.my.own</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Abundance\n"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Meadow pipit"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Now arrange all 4 plots in a panel using the <code class="language-plaintext highlighter-rouge">gridExtra</code> package and save the file</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">panel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.arrange</span><span class="p">(</span><span class="n">house.sparrow_scatter</span><span class="p">,</span><span class="w"> </span><span class="n">great.tit_scatter</span><span class="p">,</span><span class="w"> </span><span class="n">corn.bunting_scatter</span><span class="p">,</span><span class="w"> </span><span class="n">meadow.pipit_scatter</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">ggsave</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Pop_trend_panel.png"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w"> </span><span class="c1"># to close the image</span><span class="w">
</span></code></pre></div></div>

<center><img src="/img/Pop_trend_panel.png" alt="Img" style="width: 1000px;"></center>

<p>That wasn’t too bad, but you are still repeating lots of code, and here you have only 4 graphs to make - what if you had to make a graph like this for every species in the <code class="language-plaintext highlighter-rouge">LPI.UK</code> dataset? That would mean repeating the same code over 200 times. That will be very time consumming, and it’s very easy to make mistakes when you are monotonously copying and pasting for hours.</p>

<p>You might be noticing a pattern in the above <code class="language-plaintext highlighter-rouge">ggplot()</code> commands - for every species, we want R to make the same type of graph. We can tell R to do exactly that using a loop!</p>

<p>First we need to make a list of species - we will tell R to make a graph for every item in our list:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Sp_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">house.sparrow</span><span class="p">,</span><span class="w"> </span><span class="n">great.tit</span><span class="p">,</span><span class="w"> </span><span class="n">corn.bunting</span><span class="p">,</span><span class="w"> </span><span class="n">meadow.pipit</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Writing the loop:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">Sp_list</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">                                    </span><span class="c1"># For every item along the length of Sp_list we want R to perform the following functions</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">Sp_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="w">                               </span><span class="c1"># Create a dataframe for each species</span><span class="w">
  </span><span class="n">sp.name</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Common.Name</span><span class="p">)</span><span class="w">                             </span><span class="c1"># Create an object that holds the species name, so that we can title each graph</span><span class="w">
  </span><span class="n">plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abundance</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">               </span><span class="c1"># Make the plots and add our customised theme</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#00868B"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">          
    </span><span class="n">theme.my.own</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Abundance\n"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sp.name</span><span class="p">)</span><span class="w">

  </span><span class="n">ggsave</span><span class="p">(</span><span class="n">plot</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">sp.name</span><span class="p">,</span><span class="w"> </span><span class="s2">".pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">''</span><span class="p">),</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">       </span><span class="c1"># save plots as .pdf, you can change it to .png if you prefer that</span><span class="w">

  </span><span class="n">print</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span><span class="w">                                                      </span><span class="c1"># print plots to screen</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>The files will be saved in your working directory - to find out where that is, run the code <code class="language-plaintext highlighter-rouge">getwd()</code>.</p>

<h2 id="tutorial-outcomes">Tutorial outcomes:</h2>

<ul>
  <li>
    <p>You can write a function</p>
  </li>
  <li>
    <p>You can write a <code class="language-plaintext highlighter-rouge">for()</code> loop</p>
  </li>
  <li>
    <p>You understand that loops and functions can be nested to make complex workflows</p>
  </li>
  <li>
    <p>You can use <code class="language-plaintext highlighter-rouge">lapply()</code>/<code class="language-plaintext highlighter-rouge">sapply()</code> with and without anonymous functions to run loops</p>
  </li>
  <li>
    <p>You can use conditional <code class="language-plaintext highlighter-rouge">ifelse()</code> statements to make more complex functions</p>
  </li>
</ul>

<h2 id="further-reading">Further reading</h2>

<p><a href="http://adv-r.had.co.nz/Functional-programming.html" target="_blank" rel="noopener noreferrer">Advanced R by Hadley Whickham - Functional Programming</a></p>

<hr>

<hr>

<p><strong>Check out <a href="https://ourcodingclub.github.io/workshop/" target="_blank" rel="noopener noreferrer">this page</a> to learn how you can get involved! We are very happy to have people use our tutorials and adapt them to their needs. We are also very keen to expand the content on the website, so feel free to get in touch if you’d like to write a tutorial!</strong></p>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a>. <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="Img" style="width: 100px;"></a></p>

<h3><a href="https://www.surveymonkey.co.uk/r/NRKM679" target="_blank" rel="noopener noreferrer">  We would love to hear your feedback, please fill out our survey!</a></h3>
<p><br></p>
<h3>  You can contact us with any questions on <a href="mailto:ourcodingclub@gmail.com?Subject=Tutorial%20question" target="_top">ourcodingclub@gmail.com</a>
</h3>
<p><br></p>
<h3>  Related tutorials:</h3>

<ul>
  
  
</ul>
<p><br></p>
<h3>  Subscribe to our mailing list:</h3>
<div class="container">
	<div class="block">
        <!-- subscribe form start -->
		<div class="form-group">
			<form action="https://getsimpleform.com/messages?form_api_token=de1ba2f2f947822946fb6e835437ec78" method="post">
			<div class="form-group">
				<input type="text" class="form-control" name="Email" placeholder="Email" required="">
			</div>
			<div>
                        	<button class="btn btn-default" type="submit">Subscribe</button>
                    	</div>
                	</form>
		</div>
	</div>
</div>

<ul class="social-icons">
	<li>
		<h3>
			<a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer"> Follow our coding adventures on Twitter! <i class="fa fa-twitter"></i></a>
		</h3>
	</li>
</ul>


    	<footer class="footer">
	<hr>
	<div class="footer-container">
    	<ul class="footer-link-list">
        	<li><a href="/tutorials">Tutorials</a></li>
        	<li><a href="/team">About Us</a></li>
        	<li><a href="/contact">Contact us</a></li>
	    	<li><a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer">Follow us on Twitter</a></li>
    	</ul>
    	<div class="footer-text">
			<p>We are happy for people to use and further develop our tutorials - please give credit to Coding Club by linking to <a href="https://ourcodingclub.github.io/" target="_blank" rel="noopener noreferrer">our website</a>. We are also happy to discuss possible collaborations, so get in touch at <b>ourcodingclub@gmail.com</b></p>
    		<p>See our <a href="/terms">Terms of Use</a> and our <a href="/privacy">Data Privacy policy</a>.</p>
			<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a></p>
			<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img class="license" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="CC-by-sa-4.0"></a>
    	</div>
    </div>
</footer>

<!-- JS -->
<script src="/scripts/owl.carousel.js"></script>
<script src="/scripts/owl.carousel-init.js"></script>
<script src="/scripts/reveal.js"></script>


	
	</body>
</html>
