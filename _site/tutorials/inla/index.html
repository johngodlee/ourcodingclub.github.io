<!DOCTYPE html>
<html lang="en-GB">
	<head>
    	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Intro to modelling using INLA</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->
<link rel="stylesheet" href="/css/main.css"/>
<link rel="stylesheet" href="/css/owlcarousel/owl.carousel.css">
<link rel="stylesheet" href="/css/owlcarousel/owl.theme.default.css">

<!-- JS -->
<script src="https://use.fontawesome.com/4dd22df1f8.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/scripts/accordion.js"></script>
<script src="/scripts/jquery.counterup.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.5/waypoints.min.js"></script>
<script src="/scripts/ticker.js"></script>

	</head>
	<body>
    	<header class="header">
	<div class="navigation-bar">
		<div id="navigation-container">
			
				<a class="logo" href="/">
  <img src="/assets/img/logos/logo_stack.svg" alt="Coding Club logo">
</a>

			
			<nav>
				<label for="hamburger">☰</label>
				<input type="checkbox" id="hamburger">
				<ul>
					
						
					<li class="item item-nav">
						<a href="/">Home</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/tutorials.html">Tutorials</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/course.html">Course</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/team.html">Team</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/involve.html">Get involved</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/links.html">Links</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/contact.html">Contact</a>
					</li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>

			<div class="block">
          <center><img src="/img/tutheader_inla.png" alt="Img"></center>
        </div>

<h3 id="tutorial-aims">Tutorial Aims:</h3>

<h4 id="-1-learn-about-inla-and-why-its-useful-"><a href="#intro"> 1. Learn about <code class="language-plaintext highlighter-rouge">INLA</code> and why it’s useful </a></h4>

<h4 id="-2-perform-model-selection-in-inla-"><a href="#selection"> 2. Perform model selection in <code class="language-plaintext highlighter-rouge">INLA</code> </a></h4>

<h4 id="-3-learn-the-components-of-an-inla-model-"><a href="#inla"> 3. Learn the components of an <code class="language-plaintext highlighter-rouge">INLA</code> model </a></h4>

<h4 id="-4-set-up-a-spatial-analysis-"><a href="#spatial"> 4. Set up a spatial analysis </a></h4>

<h4 id="-5-modify-and-specify-spatial-models-"><a href="#spatial2"> 5. Modify and specify spatial models </a></h4>

<h4 id="-6-learn-about-spatiotemporal-analyses-"><a href="#spatialtemp"> 6. Learn about spatiotemporal analyses </a></h4>

<p><a name="intro"></a></p>
<h3 id="all-the-files-needed-to-complete-this-tutorial-can-be-downloaded-from-this-github-repository-click-on-clone-or-downloaddownload-zip-and-then-unzip-the-files">All the files needed to complete this tutorial can be downloaded from this <a href="https://github.com/ourcodingclub/CC-INLA" target="_blank" rel="noopener noreferrer">GitHub repository</a>. Click on <code class="language-plaintext highlighter-rouge">Clone or Download/Download ZIP</code> and then unzip the files.</h3>

<h2 id="1-learn-about-inla-and-why-its-useful">1. Learn about INLA and why it’s useful</h2>

<p>Welcome to this tutorial on <code class="language-plaintext highlighter-rouge">INLA</code>, written by <a href="https://www.researchgate.net/profile/Gregory_Albery" target="_blank" rel="noopener noreferrer">Greg Albery</a> off of the <a href="http://rumdeer.biology.ed.ac.uk" target="_blank" rel="noopener noreferrer">Pemberton Group</a>, Institute of Evolutionary Biology, University of Edinburgh. I’m currently in the last year of my PhD working on helminth parasites in wild red deer on the Isle of Rum, my email is gfalbery@gmail.com, and my twitter handle is <a href="https://twitter.com/Gfalbery?lang=en-gb" target="_blank" rel="noopener noreferrer">@Gfalbery</a>.</p>

<p><strong>Spatial autocorrelation is a common problem in ecological studies. Googling it, you’ll commonly come across this phrase, Tobler’s first law of geography:</strong></p>
<h3 id="everything-is-related-to-everything-else-but-near-things-are-more-related-than-distant-things">“Everything is related to everything else, but near things are more related than distant things.”</h3>

<p><strong>This is true of objects both in space and in time, and is commonly true of both at once. However, spatial analysis is often hard, computationally intensive, and unintuitive. Adding in a temporal element is even more intimidating. <code class="language-plaintext highlighter-rouge">INLA</code> is a great way to deal with this. <code class="language-plaintext highlighter-rouge">INLA</code> stands for Integrated Nested Laplace Approximation, and we’re about to learn more about what that means!</strong></p>

<p><em>TWO DISCLAIMERS:</em></p>

<ol>
  <li>
    <p>This tutorial will centre around the beginner-level specifics of <code class="language-plaintext highlighter-rouge">INLA</code> models. It will rely on a working knowledge of GLMMs, model selection methods, etc., and won’t include a huge amount of complexities about the inner workings of <code class="language-plaintext highlighter-rouge">INLA</code> itself. I’m not an expert on INLA, but I have a sturdy working knowledge of it, and I’m super enthusiastic about its use. I also believe that a load more systems could do with some more robust spatial and spatiotemporal analyses.</p>
  </li>
  <li>
    <p>Spatial analysis often seems scary. <code class="language-plaintext highlighter-rouge">INLA</code> and I are here to convince you that it should be less scary and more common. I’m a firm believer that spatial analysis can enrich your results and tell you stuff about your study system, rather than threatening the importance and interesting nature of your results.</p>
  </li>
</ol>

<h3 id="recommended-reading-for-later">Recommended reading for later:</h3>
<p>This GitHub repository from a paper about fisheries (quite complicated code but a great exhaustive example): https://github.com/GodinA/cjfas-bycatch-INLA-SPDE
Pawley and McArdle, 2018: https://www.biorxiv.org/content/biorxiv/early/2018/08/06/385526.full.pdf
Zuur et al., 2018: http://www.highstat.com/index.php/beginner-s-guide-to-regression-models-with-spatial-and-temporal-correlation</p>

<h2 id="basics-of-inla">Basics of <code class="language-plaintext highlighter-rouge">INLA</code>
</h2>

<p><code class="language-plaintext highlighter-rouge">INLA</code> is an increasingly popular analysis package in R.</p>

<h4 id="it-uses-the-integrated-nested-laplace-approximation-a-deterministic-bayesian-method">It uses the Integrated Nested Laplace Approximation, a deterministic Bayesian method.</h4>

<p><strong>Bayesian</strong> = uses Bayes’s theorem, contrasted with frequentist. Based on inferring the probability of a set of data given the determined parameters (involves setting a prior!). For more details, you can check out our <a href="https://ourcodingclub.github.io/2018/01/22/mcmcglmm.html" target="_blank" rel="noopener noreferrer">Intro to Bayesian Statistics tutorial</a>.</p>

<p><strong>Deterministic</strong> = comes up with the same results every time, contrasted with probabilistic (e.g. MCMC).</p>

<p><strong><code class="language-plaintext highlighter-rouge">INLA</code> allows a wide range of different functions: GLMM, GAMM, spatial autocorrelation, temporal autocorrelation, and spatiotemporal models. Combining this variety with its (eventual) simplicity and computational effeciency, it is becoming increasingly important in ecology. However, it can be unintuitive when you’re starting out and like learning all new things, takes a big of thinking to get your head around it, but it’s definitely achievable!</strong></p>

<h2 id="tutorial-workflow">Tutorial workflow</h2>

<p>The tutorial will take you through an analysis step by step. This will involve:</p>

<p><strong>- Model selection in <code class="language-plaintext highlighter-rouge">INLA</code>.</strong></p>

<p><strong>- The components of an <code class="language-plaintext highlighter-rouge">INLA</code> model (nuts and bolts).</strong></p>

<p><strong>- Setting up a spatial analysis.</strong></p>

<p><strong>- Modifications and specifications of spatial models.</strong></p>

<p><strong>- Spatiotemporal analyses (dabbing into them).</strong></p>

<p><em>This will include a load of functions I’ve written to easily perform simple tasks using <code class="language-plaintext highlighter-rouge">INLA</code>, which I’m happy to deconstruct for you if needed. If you do use them in an analysis and find them helpful, or if you find a problem with them, please let me know!</em></p>

<p>The general setup of an <code class="language-plaintext highlighter-rouge">INLA</code> spatial analysis is as follows:</p>

<p><strong>- Plot and explore your data.</strong></p>

<p><strong>- Decide on covariates.</strong></p>

<p><strong>- Carry out model selection using <code class="language-plaintext highlighter-rouge">DIC</code> to reduce the number of covariates.</strong></p>

<p><strong>- Run a final non-spatial model.</strong></p>

<p><strong>- Decide on a set of spatial dependence structures.</strong></p>

<h4 id="the-data">The data</h4>
<p>This tutorial is going to use a dataset working on a wild animal, trapped in a Scottish woodland. The experiment used a combination of individual anthelminthic treatment and nutritional supplementation to investigate how they impacted parasite intensity.</p>

<h4 id="the-research-question">The research question</h4>

<p>How do different treatments influence parasite activity and is that influenced by spatial patterns?</p>

<p>The researchers trapped Hosts in four grids, two of which were supplemented with high-quality food. Some individuals were treated with antiparasitic compounds, and others were not. At each capture, phenotypic data such as body condition were taken and Parasites were counted.</p>

<h3 id="import-the-data">Import the data</h3>

<p>Let’s import the data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">require</span><span class="p">(</span><span class="n">ggregplot</span><span class="p">))</span><span class="w"> </span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"gfalbery/ggregplot"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Installing Greg's package for plotting functions!</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">INLA</span><span class="p">);</span><span class="w"> </span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">);</span><span class="w"> </span><span class="n">library</span><span class="p">(</span><span class="n">ggregplot</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">

</span><span class="n">Root</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">&lt;</span><span class="n">INSERT</span><span class="w"> </span><span class="n">FILE</span><span class="w"> </span><span class="n">PATH</span><span class="w"> </span><span class="n">HERE</span><span class="o">&gt;</span><span class="w"> </span><span class="c1"># This should be the path to your working directory</span><span class="w">

</span><span class="n">Hosts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">Root</span><span class="p">,</span><span class="w"> </span><span class="s2">"/HostCaptures.csv"</span><span class="p">),</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Examine the data, look at the columns.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">head</span><span class="p">(</span><span class="n">Hosts</span><span class="p">)</span><span class="w">

</span><span class="n">substr</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">Hosts</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toupper</span><span class="p">(</span><span class="n">substr</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">Hosts</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="c1"># Giving the host names capital letters</span><span class="w">

</span><span class="n">phen</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Grid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"ID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Easting"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Northing"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Base columns with spatial information we'll need</span><span class="w">

</span><span class="n">resp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"Parasite.count"</span><span class="w"> </span><span class="c1"># Response variable</span><span class="w">

</span><span class="n">covar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Month"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Julian month of sampling</span><span class="w">
           </span><span class="s2">"Sex"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Sex</span><span class="w">
           </span><span class="s2">"Smi"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Body condition</span><span class="w">
           </span><span class="s2">"Supp.corrected"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Nutrition supplementation</span><span class="w">
           </span><span class="s2">"Treated"</span><span class="p">)</span><span class="w"> </span><span class="c1"># Treatment</span><span class="w">

</span><span class="n">TestHosts</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">Hosts</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">phen</span><span class="p">,</span><span class="w"> </span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">covar</span><span class="p">)])</span><span class="w"> </span><span class="c1"># Getting rid of NA's, picking adults</span><span class="w">
</span><span class="c1"># We are using the [] to subset and only extract specific columns</span><span class="w">

</span><span class="c1"># Turning variables into factors</span><span class="w">
</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Month</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Month</span><span class="p">)</span><span class="w">
</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="p">)</span><span class="w">

</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Parasite.count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Parasite.count</span><span class="p">)</span><span class="w"> </span><span class="c1"># Parasite counts should be integers</span><span class="w">

</span><span class="n">table</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">))</span><span class="w"> </span><span class="c1"># Enough repeat samples for a mixed model?</span><span class="w">
</span></code></pre></div></div>

<p>We need to make sure that there are enough repeat samples of specific individuals. Table will count up how many of them there are, and using table(table()) is a quick way to show the distribution of repeat sampling. Looks like we have enough repeat samples for a mixed effect model!</p>

<p><code class="language-plaintext highlighter-rouge">INLA</code> works like many other statistical analysis packages, such as <code class="language-plaintext highlighter-rouge">lme4</code> or <code class="language-plaintext highlighter-rouge">MCMCglmm</code>. If you run the same simple models in these packages, it should get similar results.</p>

<p>Plot the sampling locations in space. As they are trapped in a grid formation, make sure they are jittered.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Setting up a custom theme</span><span class="w">
</span><span class="n">THEME</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">),</span><span class="w">
               </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">),</span><span class="w">
               </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-0.35</span><span class="p">),</span><span class="w">
               </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w">

</span><span class="p">(</span><span class="n">samp_locations</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">Easting</span><span class="p">,</span><span class="w"> </span><span class="n">Northing</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
	</span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">Grid</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
	</span><span class="n">THEME</span><span class="w"> </span><span class="o">+</span><span class="w"> 
	</span><span class="n">labs</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Grid"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Recall that putting your entire ggplot code in brackets () creates the graph and then shows it in the plot viewer. If you don’t have the brackets, you’ve only created the object, but haven’t visualized it. You would then have to call the object such that it will be displayed by just typing <code class="language-plaintext highlighter-rouge">samp_locations</code> after you’ve created the “samp_locations” object.</p>

<center> <img src="/img/TrapLocations.png" alt="Img" style="width: 500px;"> </center>

<p>How often are different individuals trapped on different grids?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">))</span><span class="w">

</span><span class="n">table</span><span class="p">(</span><span class="n">with</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">Grid</span><span class="p">,</span><span class="w"> </span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)))))</span><span class="w">
</span></code></pre></div></div>

<p>Not much moving around! Looks like individuals tend to stay on the same grid.</p>

<p><a name="selection"></a></p>
<h2 id="2-perform-model-selection-in-inla">2. Perform model selection in <code class="language-plaintext highlighter-rouge">INLA</code>
</h2>

<p>Model selection is a method that reduces the amount of covariates that are included in the data to stop overfitting. This will increase the generality of your models, and is good practise!</p>

<p>First, we will set up a full analysis using all the covariates that we reckon will influence the data. As I’ve said above, you can use INLA like any other modelling package, but here I’m going to use formula specification before the models.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># First without random effects ####</span><span class="w">

</span><span class="c1"># Specify the formula</span><span class="w">
</span><span class="n">f0.1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="s2">" ~ "</span><span class="p">,</span><span class="w"> </span><span class="c1"># Response first</span><span class="w">
                          </span><span class="n">paste</span><span class="p">(</span><span class="n">covar</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">)</span><span class="w"> </span><span class="c1"># Collapse the vector of covariates</span><span class="w">
</span><span class="p">))</span><span class="w">

</span><span class="c1"># Run the model</span><span class="w">
</span><span class="n">IM0.1</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">Parasite.count</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Month</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Smi</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Supp.corrected</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Treated</span><span class="p">,</span><span class="w"> 
               </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Specify the family. Can be a wide range (see r-inla.org).</span><span class="w">
               </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">)</span><span class="w"> </span><span class="c1"># Specify the data</span><span class="w">

</span><span class="c1"># Run the model # (This is the same thing)</span><span class="w">
</span><span class="n">IM0.1</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f0.1</span><span class="p">,</span><span class="w"> 
               </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w"> </span><span class="c1"># Specify the family. Can be a wide range (see r-inla.org).</span><span class="w">
               </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">)</span><span class="w"> </span><span class="c1"># Specify the data</span><span class="w">

</span><span class="c1"># Then with an ID random effect ####</span><span class="w">

</span><span class="n">f0.2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="s2">" ~ "</span><span class="p">,</span><span class="w"> 
                          </span><span class="n">paste</span><span class="p">(</span><span class="n">covar</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> 
                          </span><span class="s2">" +  f(ID, model = 'iid')"</span><span class="p">))</span><span class="w"> </span><span class="c1"># This is how you include  a typical random effect.</span><span class="w">

</span><span class="n">IM0.2</span><span class="w">  </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f0.2</span><span class="p">,</span><span class="w"> 
               </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
               </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">)</span><span class="w"> 

</span><span class="n">summary</span><span class="p">(</span><span class="n">IM0.1</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">IM0.2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Next, we will visualise the results of our models. We will plot the effect sizes and the credible intervals around them. This uses some functions which I’ve packaged in my <code class="language-plaintext highlighter-rouge">ggregplot</code> package!</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Efxplot</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">IM0.1</span><span class="p">,</span><span class="w"> </span><span class="n">IM0.2</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p>This shows a load of significant effects: months, sex, treatment. Looks promising!</p>

<p><strong>NB: There are no P values in <code class="language-plaintext highlighter-rouge">INLA</code>. Importance or significance of variables can be deduced by examining the overlap of their 2.5% and 97.5% posterior estimates with zero.</strong></p>

<center> <img src="/img/INLA1.png" alt="Img" style="width: 500px;"> </center>

<p>It’s likely that this model is overloaded with explanatory variables. Let’s carry out model selection to remove the covariates that are unimportant.</p>

<p>This involves removing covariates one by one and seeing how this changes model fit according to the model’s <a href="https://en.wikipedia.org/wiki/Deviance_information_criterion" target="_blank" rel="noopener noreferrer">Deviance Information Criterion</a> (DIC, a Bayesian measure analogous to <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion" target="_blank" rel="noopener noreferrer">AIC</a>). If removing any number of covariates does not increase a model’s DIC by a threshold number (I use 2 DIC) then the covariate with the lowest impact is removed. This process is repeated, using fewer and fewer covariates each time, until eventually you end up with a minimal model where removing any covariates increases the DIC by greater than the threshold value.</p>

<p>Instead of doing this manually, which takes time and a lot of code and is boring, I threw together a function (<code class="language-plaintext highlighter-rouge">INLAModelSel</code> in the <code class="language-plaintext highlighter-rouge">ggregplot</code> package) which will do it for us.</p>

<p>NB: This is a demonstration not a setup for a perfect analysis. Remember to:</p>

<p><strong>- Explore your data.</strong>
<strong>- Be careful of outliers.</strong>
<strong>- Do not include highly-correlated covariates.</strong></p>

<p><em>If you don’t explore your data thoroughly things can easily go wrong. Do not rely on this function for analysis without thinking about it and checking your data thoroughly!</em></p>

<p><strong>We can apply the function to our data and see which variables we should include in our models.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's try it on our data ####</span><span class="w">

</span><span class="n">HostModelSel</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">INLAModelSel</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">covar</span><span class="p">,</span><span class="w"> </span><span class="s2">"ID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"iid"</span><span class="p">,</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">)</span><span class="w">

</span><span class="n">Finalcovar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HostModelSel</span><span class="o">$</span><span class="n">Removed</span><span class="p">[[</span><span class="nf">length</span><span class="p">(</span><span class="n">HostModelSel</span><span class="o">$</span><span class="n">Removed</span><span class="p">)]]</span><span class="w">
</span></code></pre></div></div>

<p>We ended up removing body condition, and food supplementation, while treatment, sex, and month remained in the final model.</p>

<p>A reminder that there are no P values in <code class="language-plaintext highlighter-rouge">INLA</code>. Importance or significance of variables can be deduced by examining the overlap of their 2.5% and 97.5% posterior estimates with zero. This is made easier by plotting them. I prefer using DIC to compare variables’ contributions to model fit rather than looking exclusively at the model estimates.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="s2">" ~ "</span><span class="p">,</span><span class="w"> 
                        </span><span class="n">paste</span><span class="p">(</span><span class="n">Finalcovar</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> 
                        </span><span class="s2">"+ f(ID, model = 'iid'"</span><span class="p">))</span><span class="w"> 

</span><span class="n">IM1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="w">
            </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">,</span><span class="w">
            </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> 

</span><span class="n">summary</span><span class="p">(</span><span class="n">IM1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="elaborating-on-our-model-selection">Elaborating on our model selection</h3>

<p>To examine the importance of spatial autocorrelation, we then look at the DIC of a series of competing models with different random effect structures. I have decided that, given the layout of my sampling locations, there are a few potential ways to code spatial autocorrelation in this dataset.</p>

<p><strong>1. Spatial autocorrelation constant across the study period, and across the study area (spatial, 1 mesh).</strong></p>

<p><strong>2. Spatial autocorrelation constant across the study area, varying across the study period (spatiotemporal, X meshes).</strong></p>

<p><strong>3. Spatial autocorrelation varying within each grid to ignore spatial patterns between grids (spatial, 4 meshes).</strong></p>

<p>We will make these models, compete them with each other, and investigate whether the inclusion of spatial random effects changes our fixed effect estimates (does including spatial variation change whether we think males have higher Parasite counts, for example?)</p>

<p><a name="inla"></a></p>
<h2 id="3-learn-the-components-of-an-inla-model">3. Learn the components of an <code class="language-plaintext highlighter-rouge">INLA</code> model</h2>

<p>The setup so far has involved using quite simple model formulae. The next step is where people often become frustrated, as it involves model setups which are more unique to INLA and hard to pick apart.</p>

<h3 id="a-bit-about-inla">A bit about <code class="language-plaintext highlighter-rouge">INLA</code>
</h3>
<p><code class="language-plaintext highlighter-rouge">INLA</code> is computationally efficient because it uses a SPDE (Stochastic Partial Differentiation Equation) to estimate the spatial autocorrelation of the data. This involves using a “mesh” of discrete sampling locations which are interpolated to estimate a continuous process in space (see very helpful figure).</p>

<center> <img src="/img/INLADiagram.png" alt="Img" style="width: 500px;"> </center>

<p>So, you create a mesh using sampling locations and/or the borders of your study system.</p>

<p>There are lots of variations on a mesh, which can be examined by plotting it.</p>

<p><a name="spatial"></a></p>

<h2 id="4-set-up-a-spatial-analysis">4. Set up a spatial analysis</h2>

<h3 id="setting-up-a-mesh">Setting up a mesh</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Locations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Easting</span><span class="p">,</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Northing</span><span class="p">)</span><span class="w"> </span><span class="c1"># using the sampling locations </span><span class="w">

</span><span class="n">MeshA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.mesh.2d</span><span class="p">(</span><span class="n">jitter</span><span class="p">(</span><span class="n">Locations</span><span class="p">),</span><span class="w"> </span><span class="n">max.edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">))</span><span class="w">
</span><span class="n">MeshB</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.mesh.2d</span><span class="p">(</span><span class="n">Locations</span><span class="p">,</span><span class="w"> </span><span class="n">max.edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">))</span><span class="w">
</span><span class="n">MeshC</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.mesh.2d</span><span class="p">(</span><span class="n">Locations</span><span class="p">,</span><span class="w"> </span><span class="n">max.edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">))</span><span class="w">

</span><span class="n">Mesh</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">MeshB</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">MeshA</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">MeshB</span><span class="p">)</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">MeshC</span><span class="p">)</span><span class="w">

</span><span class="n">points</span><span class="p">(</span><span class="n">Locations</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<center> <img src="/img/MeshA.jpg" alt="Img" style="width: 500px;"> </center>

<center> <img src="/img/MeshB.jpg" alt="Img" style="width: 500px;"> </center>

<center> <img src="/img/MeshC.jpg" alt="Img" style="width: 500px;"> </center>

<p>There are several important aspects of a mesh. The triangle size (determined using a combination of max.edge and cutoff) determines how precisely the equations will be tailored by the data. Using smaller triangles increases precision but also exponentially increases computing power. Generally, the mesh function automatically creates a mesh like mesh A, where closer-together sampling locations produce smaller triangles. The sampling locations in this dataset are so evenly spaced that I had to jitter them to show this in mesh A. When exploring/setting up preliminary analyses, use a mesh like mesh B. for analyses to be reported in a paper, use a mesh like mesh C. Be careful of edges, and try to allow some space around your sampling area for INLA to estimate. The edge triangles can be bigger to reduce computing power.</p>

<p>After the mesh has been set up, we need to feed INLA a way to convert this into a model format. This uses an A matrix, which essentially translates spatial locations on the mesh into vectors in the model.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Making the A matrix</span><span class="w">

</span><span class="n">HostsA</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.spde.make.A</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locations</span><span class="p">)</span><span class="w"> </span><span class="c1"># Making A matrix</span><span class="w">
</span><span class="n">Hosts.spde</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.spde2.pcmatern</span><span class="p">(</span><span class="n">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="n">prior.range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">prior.sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">))</span><span class="w"> </span><span class="c1"># Making SPDE</span><span class="w">
</span><span class="n">w.Host</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.spde.make.index</span><span class="p">(</span><span class="s1">'w'</span><span class="p">,</span><span class="w"> </span><span class="n">n.spde</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Hosts.spde</span><span class="o">$</span><span class="n">n.spde</span><span class="p">)</span><span class="w"> </span><span class="c1"># making the w</span><span class="w">

</span></code></pre></div></div>

<p>The A matrix is combined with the model matrix and random effects in a format called a stack.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1"># Making the model matrix #### </span><span class="w">

</span><span class="n">X0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">model.matrix</span><span class="p">(</span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">" ~ -1 + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">Finalcovar</span><span class="p">,</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">))),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">)</span><span class="w"> </span><span class="c1"># make the model matrix using the final model selection formula without a response variable.</span><span class="w">

</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">X0</span><span class="p">[,</span><span class="o">-</span><span class="n">which</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X0</span><span class="p">)</span><span class="o">%in%</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Month7"</span><span class="p">))])</span><span class="w"> </span><span class="c1"># convert to a data frame. Eliminate the base level of the first categorical variable if applicable (you will manually specify an intercept below) </span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">X</span><span class="p">)</span><span class="w">

</span><span class="c1"># Making the stack ####</span><span class="w">

</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">)</span><span class="w">

</span><span class="n">StackHost</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.stack</span><span class="p">(</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">resp</span><span class="p">]),</span><span class="w"> </span><span class="c1"># specify the response variable</span><span class="w">
  
  </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">HostsA</span><span class="p">),</span><span class="w"> </span><span class="c1"># Vector of Multiplication factors for random and fixed effects              </span><span class="w">
  
  </span><span class="n">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
    
    </span><span class="n">Intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="c1"># specify the manual intercept!</span><span class="w">
    
    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1"># attach the model matrix</span><span class="w">
    
    </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="c1"># insert vectors of any random effects</span><span class="w">
    
    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w.Host</span><span class="p">))</span><span class="w"> </span><span class="c1"># attach the w </span><span class="w">
</span></code></pre></div></div>

<p>The stack includes (in this order in my code)….</p>

<ol>
  <li>
    <p>The response variable (coded as “y”)</p>
  </li>
  <li>
    <p>A vector of multiplication factors. This is generally a series of 1’s (for the intercept, random effects, and fixed effects), followed by the spatial A matrix which you specified earlier.</p>
  </li>
  <li>
    <p>The effects. You need to separately specify the intercept, the random effects, the model matrix, and the spde. The thing to remember is that the components of part 2 of the stack (multiplication factors) are related to the components of part 3 (the effects). <strong>Adding an effect necessitates adding another 1 to the multiplication factors (in the right place).</strong></p>
  </li>
</ol>

<p>Adding a random effect? Whack it in the effects, add a 1 to the A vector.</p>

<p>Say I was trying to add a random effect of grid:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">)</span><span class="w">

</span><span class="n">BADSTACK</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.stack</span><span class="p">(</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">resp</span><span class="p">]),</span><span class="w"> </span><span class="c1"># specify the response variable</span><span class="w">
  
  </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">HostsA</span><span class="p">),</span><span class="w"> </span><span class="c1"># Vector of Multiplication factors for random and fixed effects              </span><span class="w">
  
  </span><span class="n">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
    
    </span><span class="n">Intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="c1"># specify the manual intercept!</span><span class="w">
    
    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1"># attach the model matrix</span><span class="w">
    
    </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="c1"># insert vectors of any random effects</span><span class="w">
    </span><span class="n">Grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="p">,</span><span class="w">
    
    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w.Host</span><span class="p">))</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    
</span></code></pre></div></div>

<p>What have I done wrong here? Let’s rectify it.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="n">N</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">)</span><span class="w">

</span><span class="n">GOODSTACK</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.stack</span><span class="p">(</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">resp</span><span class="p">]),</span><span class="w"> </span><span class="c1"># specify the response variable</span><span class="w">
  
  </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">HostsA</span><span class="p">),</span><span class="w"> </span><span class="c1"># Vector of Multiplication factors for random and fixed effects              </span><span class="w">
  
  </span><span class="n">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
    
    </span><span class="n">Intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="c1"># specify the manual intercept!</span><span class="w">
    
    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1"># attach the model matrix</span><span class="w">
    
    </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="c1"># insert vectors of any random effects</span><span class="w">
    </span><span class="n">Grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="p">,</span><span class="w">
    
    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w.Host</span><span class="p">))</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
</span></code></pre></div></div>

<h3 id="running-the-model">Running the model</h3>

<p>So, we have everything set up to conduct a spatial analysis. All we need is to put it into the inla function and see what happens. Fortunately, once you specify the stack you can add it into the <code class="language-plaintext highlighter-rouge">data =</code> argument and then changing the formula will run whatever variation you need (as long as it only uses A, W, random and fixed effects that already exist in the stack).</p>

<p>So, for completeness let’s try out three competing models: 
only fixed effects, 
fixed + ID random effects, 
fixed + ID + SPDE random effects.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"y ~ -1 + Intercept + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">)))</span><span class="w">
</span><span class="n">f2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"y ~ -1 + Intercept + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> </span><span class="s2">" +  f(ID, model = 'iid')"</span><span class="p">))</span><span class="w">
</span><span class="n">f3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"y ~ -1 + Intercept + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> </span><span class="s2">" +  f(ID, model = 'iid') + f(w, model = Hosts.spde)"</span><span class="p">))</span><span class="w">


</span><span class="n">IM1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="w"> </span><span class="c1"># Base model (no random effects)</span><span class="w">
            </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.data</span><span class="p">(</span><span class="n">StackHost</span><span class="p">),</span><span class="w">
            </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">control.predictor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.A</span><span class="p">(</span><span class="n">StackHost</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">IM2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="w"> </span><span class="c1"># f1 + Year and ID random effects</span><span class="w">
            </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.data</span><span class="p">(</span><span class="n">StackHost</span><span class="p">),</span><span class="w">
            </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">control.predictor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.A</span><span class="p">(</span><span class="n">StackHost</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">IM3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f3</span><span class="p">,</span><span class="w"> </span><span class="c1"># f2 + SPDE random effect </span><span class="w">
            </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.data</span><span class="p">(</span><span class="n">StackHost</span><span class="p">),</span><span class="w">
            </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">control.predictor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.A</span><span class="p">(</span><span class="n">StackHost</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">SpatialHostList</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">IM1</span><span class="p">,</span><span class="w"> </span><span class="n">IM2</span><span class="p">,</span><span class="w"> </span><span class="n">IM3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="plotting-the-spatial-field">Plotting the spatial field</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggField</span><span class="p">(</span><span class="n">IM3</span><span class="p">,</span><span class="w"> </span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="n">Groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Blues"</span><span class="p">)</span><span class="w"> 

</span><span class="c1"># always use a single-dimension colour palette if you can! It's just easier on the eyes, </span><span class="w">
</span><span class="c1"># better for colourblind people, makes sense in black and white, etc.</span><span class="w">

</span><span class="c1"># ignore the Groups part of the function for now. That'll come later.</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/Field1.png" alt="Img" style="width: 500px;"> </center>

<p>At what range does autocorrelation fade in space? INLA models with a large kappa (inverse range) parameter change very quickly in space. Those with a large range and small kappa parameter have much longer, slower graidents.</p>

<h3 id="looking-at-the-range">Looking at the range</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># function takes (a list of) models and plots the decay of spatial autocorrelation across a user-defined range</span><span class="w">

</span><span class="c1"># let's try it on our model ###</span><span class="w">

</span><span class="c1"># Define the maximum range as something reasonable: the study area is 80 eastings wide, so lets go for:</span><span class="w">

</span><span class="n">Maxrange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="w">

</span><span class="n">INLARange</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">IM3</span><span class="p">),</span><span class="w"> </span><span class="n">maxrange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maxrange</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/Range1.png" alt="Img" style="width: 500px;"> </center>

<p>However, being able to visualise spatial patterns does not necessarily mean that spatial autocorrelation is affecting the model substantially, and range does not correspond to the importance of autocorrelation! In order to investigate that, we have to look at model fit. How does the DIC of these models compare?</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sapply</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="n">f</span><span class="o">$</span><span class="n">dic</span><span class="o">$</span><span class="n">dic</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>This is quite hard to visualise, so: another function in the package!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Let's try it on our data ####</span><span class="w">

</span><span class="n">INLADICFig</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">,</span><span class="w"> </span><span class="n">ModelNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Base"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/DIC1.png" alt="Img" style="width: 500px;"> </center>

<p>Seems like spatial autocorrelation doesn’t affect these data the way we’ve coded it! Whoever carried out this study could keep going as they were and not worry any more about spatial autocorrelation. <strong>Except we had some expectations that there might be other varieties of spatial autocorrelation at work here.</strong></p>

<p>If I had had no more ###a priori### expectations for this study, I would stop here. Don’t keep analysing different variables or combinations of variables until eventually you find a variety of spatial autocorrelation that affects your data.</p>

<p><a name="spatial2"></a></p>
<h2 id="5-modify-and-specify-spatial-inla-models">5. Modify and specify spatial <code class="language-plaintext highlighter-rouge">INLA</code> models</h2>

<h3 id="seasonal-model">Seasonal model</h3>

<p>Now: what if the spatial field varied seasonally? We specify the A matrix, SPDE and model differently to produce several different groups.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Specifying a new set of SPDE components ####</span><span class="w">

</span><span class="n">Groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Month"</span><span class="w">

</span><span class="n">NGroups</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">Groups</span><span class="p">]))</span><span class="w"> 

</span><span class="n">HostA2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.spde.make.A</span><span class="p">(</span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
                           </span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locations</span><span class="p">,</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
                           </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">Groups</span><span class="p">])),</span><span class="c1"># this must be a numeric value counting from 1. If the groups variable is a factor, this will happen by default.</span><span class="w">
                           </span><span class="n">n.group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroups</span><span class="p">)</span><span class="w"> 

</span><span class="n">w.Host2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.spde.make.index</span><span class="p">(</span><span class="w">
  </span><span class="n">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">'w'</span><span class="p">,</span><span class="w"> 
  </span><span class="n">n.spde</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Hosts.spde</span><span class="o">$</span><span class="n">n.spde</span><span class="p">,</span><span class="w">
  </span><span class="n">n.group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroups</span><span class="p">)</span><span class="w">  

</span><span class="n">StackHost2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.stack</span><span class="p">(</span><span class="w"> 
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">resp</span><span class="p">]),</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
  
  </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">HostA2</span><span class="p">),</span><span class="w"> </span><span class="c1"># Change the A matrix to the new one</span><span class="w">
  
  </span><span class="n">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
    </span><span class="n">Intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    
    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w.Host2</span><span class="p">))</span><span class="w"> </span><span class="c1"># CHANGE</span><span class="w">
</span></code></pre></div></div>

<p>Now that this is specified, let’s run the model.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"y ~ -1 + Intercept + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> 
                       </span><span class="s2">" +  f(ID, model = 'iid') +  f(w, model = Hosts.spde, 
group = w.group,                           # This bit is new! 
control.group = list(model = 'iid'))"</span><span class="p">))</span><span class="w">

</span><span class="n">inla.setOption</span><span class="p">(</span><span class="n">num.threads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">8</span><span class="p">)</span><span class="w"> 

</span><span class="n">IM4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f4</span><span class="p">,</span><span class="w">
            </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.data</span><span class="p">(</span><span class="n">StackHost2</span><span class="p">),</span><span class="w"> </span><span class="c1"># Don't forget to change the stack!</span><span class="w">
            </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">control.predictor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.A</span><span class="p">(</span><span class="n">StackHost2</span><span class="p">))</span><span class="w"> </span><span class="c1"># Twice!</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">SpatialHostList</span><span class="p">[[</span><span class="m">4</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IM4</span><span class="w">
</span></code></pre></div></div>

<p>Now that that’s run, let’s plot it!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"July"</span><span class="p">,</span><span class="w"> </span><span class="s2">"August"</span><span class="p">,</span><span class="w"> </span><span class="s2">"September"</span><span class="p">,</span><span class="w"> </span><span class="s2">"October"</span><span class="p">,</span><span class="w"> </span><span class="s2">"November"</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">Labels</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">NGroups</span><span class="p">)</span><span class="w">

</span><span class="n">ggField</span><span class="p">(</span><span class="n">IM4</span><span class="p">,</span><span class="w"> </span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="n">Groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroups</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># Notice the groups argument, using the number of unique months.</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Reds"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Group</span><span class="p">,</span><span class="w"> </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">Group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Labels</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="c1"># Doing this manually changes the facet labels</span><span class="w">
  
</span></code></pre></div></div>
<center> <img src="/img/Field2.png" alt="Img" style="width: 500px;"> </center>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INLARange</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="m">4</span><span class="p">],</span><span class="w"> </span><span class="n">maxrange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maxrange</span><span class="p">,</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="n">ModelNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Full"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Monthly"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/Range2.png" alt="Img" style="width: 500px;"> </center>

<p><a name="spatialtemp"></a></p>

<h2 id="6-learn-about-spatiotemporal-analyses">6. Learn about spatiotemporal analyses</h2>

<p>There is a faster way to split spatial fields into groups, using <code class="language-plaintext highlighter-rouge">repl</code> instead of splitting it into groups and connecting them via iid models. However, I’m showing you this method as it’s a way into spatiotemporal models. In the above model, we have assumed that monthly spatial fields are totally unrelated to each other. However, we can use an <code class="language-plaintext highlighter-rouge">exchangeable</code> model to force a correlation between them, and to derive a rho correlation between the fields.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">f5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"y ~ -1 + Intercept + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> 
                       </span><span class="s2">"+ f(ID, model = 'iid') +  f(w, model = Hosts.spde, 
                       group = w.group, # This bit is new! 
                       control.group = list(model='exchangeable'))"</span><span class="p">))</span><span class="w">

</span><span class="c1">#inla.setOption(num.threads = 8) </span><span class="w">

</span><span class="n">IM5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f5</span><span class="p">,</span><span class="w">
         </span><span class="n">family</span><span class="o">=</span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
         </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.data</span><span class="p">(</span><span class="n">StackHost2</span><span class="p">),</span><span class="w">
         </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
         </span><span class="n">control.predictor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.A</span><span class="p">(</span><span class="n">StackHost2</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">SpatialHostList</span><span class="p">[[</span><span class="m">5</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IM5</span><span class="w">
</span></code></pre></div></div>

<p>NB: with Exchangeable, all fields are correlated to the same extent. If we used AR1 (a typical temporal autocorrelation model used to link spatial fields), fields closer to each other in time would be more highly correlated than those further apart. It takes more time than we have to run, and requires more data than I have to converge. So try that out on your own data if you’re keen and you think it’ll work. I’m happy to help!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Same functions as above! </span><span class="w">

</span><span class="n">INLADICFig</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">,</span><span class="w"> </span><span class="n">ModelNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Base"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE3"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/DIC3.png" alt="Img" style="width: 500px;"> </center>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggField</span><span class="p">(</span><span class="n">IM5</span><span class="p">,</span><span class="w"> </span><span class="n">Mesh</span><span class="p">,</span><span class="w"> </span><span class="n">Groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroups</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="c1"># Notice the groups argument, using the number of unique months.</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Greens"</span><span class="p">)</span><span class="w"> 
</span></code></pre></div></div>
<center> <img src="/img/Field3.png" alt="Img" style="width: 500px;"> </center>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INLARange</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="m">5</span><span class="p">],</span><span class="w"> </span><span class="n">maxrange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Maxrange</span><span class="p">,</span><span class="w"> </span><span class="n">ModelNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Full"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Monthly"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Monthly2"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/Range3.png" alt="Img" style="width: 500px;"> </center>

<h3 id="within-grid-model">Within-grid model</h3>

<p>Let’s try using repl instead of group, just for completeness’s sake. Just to recap: this is slightly quicker, but can only be used when you’re not specifying a link between the fields.</p>

<p>We’re going to see if restricting the study area to four identically-shaped grid meshes will improve fit, rather than having a lot of empty space in the countryside where no Hosts were ever caught.</p>

<p>In order to do this, we have to recode the data slightly.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Group2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Grid"</span><span class="w">

</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Easting2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Easting</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">with</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">Easting</span><span class="p">,</span><span class="w"> </span><span class="n">Grid</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">))[</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="p">]</span><span class="w">
</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Northing2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Northing</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">with</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">,</span><span class="w"> </span><span class="n">tapply</span><span class="p">(</span><span class="n">Northing</span><span class="p">,</span><span class="w"> </span><span class="n">Grid</span><span class="p">,</span><span class="w"> </span><span class="n">min</span><span class="p">))[</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="p">]</span><span class="w">

</span><span class="n">Locations2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Easting2</span><span class="p">,</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Northing2</span><span class="p">)</span><span class="w">

</span><span class="n">Mesh2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.mesh.2d</span><span class="p">(</span><span class="n">Locations2</span><span class="p">,</span><span class="w"> </span><span class="n">max.edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">))</span><span class="c1">#, cutoff = 0.8)</span><span class="w">

</span><span class="n">NGroup2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">Group2</span><span class="p">]))</span><span class="w">

</span><span class="n">Hosts.spde2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.spde2.pcmatern</span><span class="p">(</span><span class="n">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mesh2</span><span class="p">,</span><span class="w"> </span><span class="n">prior.range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">prior.sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">))</span><span class="w"> </span><span class="c1"># Making SPDE</span><span class="w">

</span><span class="n">HostA3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.spde.make.A</span><span class="p">(</span><span class="n">Mesh2</span><span class="p">,</span><span class="w"> </span><span class="n">loc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Locations2</span><span class="p">,</span><span class="w">
                           </span><span class="n">repl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">Group2</span><span class="p">]),</span><span class="w">
                           </span><span class="n">n.repl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroup2</span><span class="p">)</span><span class="w">

</span><span class="n">w.Host3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.spde.make.index</span><span class="p">(</span><span class="w">
  </span><span class="n">name</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="s1">'w'</span><span class="p">,</span><span class="w"> 
  </span><span class="n">n.spde</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">Hosts.spde2</span><span class="o">$</span><span class="n">n.spde</span><span class="p">,</span><span class="w">
  </span><span class="n">n.repl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroup2</span><span class="p">)</span><span class="w">  

</span><span class="n">StackHost3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla.stack</span><span class="p">(</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="p">[,</span><span class="n">resp</span><span class="p">]),</span><span class="w">  
  </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">HostA3</span><span class="p">),</span><span class="w"> </span><span class="c1"># Change A matrix</span><span class="w">
  </span><span class="n">effects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
    
    </span><span class="n">Intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">),</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    
    </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    
    </span><span class="n">ID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">ID</span><span class="p">,</span><span class="w"> </span><span class="c1"># Leave</span><span class="w">
    
    </span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">w.Host3</span><span class="p">))</span><span class="w"> </span><span class="c1"># Change </span><span class="w">

</span><span class="n">f6</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste0</span><span class="p">(</span><span class="s2">"y ~ -1 + Intercept + "</span><span class="p">,</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="n">colnames</span><span class="p">(</span><span class="n">X</span><span class="p">),</span><span class="w"> </span><span class="n">collapse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">" + "</span><span class="p">),</span><span class="w"> 
                       </span><span class="s2">" +  f(ID, model = 'iid') +   
                       f(w, model = Hosts.spde2, replicate = w.repl)"</span><span class="p">))</span><span class="w"> </span><span class="c1"># Not necessary to specify a linking model</span><span class="w">

</span><span class="n">IM6</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inla</span><span class="p">(</span><span class="n">f6</span><span class="p">,</span><span class="w">
           </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"nbinomial"</span><span class="p">,</span><span class="w">
           </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.data</span><span class="p">(</span><span class="n">StackHost3</span><span class="p">),</span><span class="w">
           </span><span class="n">control.compute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">dic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
           </span><span class="n">control.predictor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inla.stack.A</span><span class="p">(</span><span class="n">StackHost3</span><span class="p">))</span><span class="w">
</span><span class="p">)</span><span class="w">

</span><span class="n">SpatialHostList</span><span class="p">[[</span><span class="m">6</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">IM6</span><span class="w">
</span></code></pre></div></div>

<p><strong>Has this fit the data better?</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">INLADICFig</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">,</span><span class="w"> </span><span class="n">ModelNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Base"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"GridSPDE"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/DIC4.png" alt="Img" style="width: 500px;"> </center>

<p>Nope!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TestHosts</span><span class="o">$</span><span class="n">Group</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">TestHosts</span><span class="o">$</span><span class="n">Grid</span><span class="w">
  
</span><span class="n">Labels2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste0</span><span class="p">(</span><span class="s2">"Grid "</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">Labels2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">4</span><span class="w">

</span><span class="n">ggField</span><span class="p">(</span><span class="n">I6</span><span class="p">,</span><span class="w"> </span><span class="n">Mesh2</span><span class="p">,</span><span class="w"> </span><span class="n">Groups</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NGroup2</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> 
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">Group</span><span class="p">,</span><span class="w"> </span><span class="n">labeller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">labeller</span><span class="p">(</span><span class="n">Group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Labels2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Oranges"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"Fields6.png"</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mm"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">120</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">dpi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">300</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/Fields6.png" alt="Img" style="width: 500px;"> </center>

<p>But the fields look cool!</p>

<h3 id="final-summary">Final summary</h3>

<p>The best-fitting model is SPDE 3 (model 5). This features different spatial fields for each month, with correlation between the fields. However, this formulation only slightly improves model fit over the non-spatial models, so we shouldn’t worry too much about the spatial effects we’re seeing! Good news. Also, if you run the code below, you will see that the effect estimates barely differ between these models. So, even though space has an effect, the effect is small and doesn’t modify our previous conclusions! Congratulations, your system is robust to spatial dependence effects!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Efxplot</span><span class="p">(</span><span class="n">SpatialHostList</span><span class="p">,</span><span class="w"> </span><span class="n">ModelNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Base"</span><span class="p">,</span><span class="w"> </span><span class="s2">"IID"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"SPDE3"</span><span class="p">,</span><span class="w"> </span><span class="s2">"GridSPDE"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<center> <img src="/img/FinalEffects.png" alt="Img" style="width: 500px;"> </center>

<h1 id="added-extras">Added extras</h1>

<ol>
  <li>
    <p>Adding interactions: You can’t have colons in the column names of the X matrix. Replace them with “_” using gsub or similar.</p>
  </li>
  <li>
    <p>You can add a boundary to your mesh using INLA to better represent your study system. Here’s an example with the Isle of Rum system I work on, portraying the coastline:</p>
  </li>
</ol>

<center> <img src="/img/Rum.png" alt="Img" style="width: 500px;"> </center>

<ol>
  <li>You can also remove areas of the mesh where e.g. your organism can’t live, using the barrier functions.</li>
</ol>

<hr>

<hr>

<p><strong>Check out <a href="https://ourcodingclub.github.io/workshop/" target="_blank" rel="noopener noreferrer">this page</a> to learn how you can get involved! We are very happy to have people use our tutorials and adapt them to their needs. We are also very keen to expand the content on the website, so feel free to get in touch if you’d like to write a tutorial!</strong></p>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a>. <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="Img" style="width: 100px;"></a></p>

<h3><a href="https://www.surveymonkey.co.uk/r/VVGXKZG" target="_blank" rel="noopener noreferrer">  We would love to hear your feedback, please fill out our survey!</a></h3>
<p><br></p>
<h3>  You can contact us with any questions on <a href="mailto:ourcodingclub@gmail.com?Subject=Tutorial%20question" target="_top">ourcodingclub@gmail.com</a>
</h3>
<p><br></p>
<h3>  Related tutorials:</h3>

<ul>
  
  
</ul>
<p><br></p>
<h3>  Subscribe to our mailing list:</h3>
<div class="container">
	<div class="block">
        <!-- subscribe form start -->
		<div class="form-group">
			<form action="https://getsimpleform.com/messages?form_api_token=de1ba2f2f947822946fb6e835437ec78" method="post">
			<div class="form-group">
				<input type="text" class="form-control" name="Email" placeholder="Email" required="">
			</div>
			<div>
                        	<button class="btn btn-default" type="submit">Subscribe</button>
                    	</div>
                	</form>
		</div>
	</div>
</div>

<ul class="social-icons">
	<li>
		<h3>
			<a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer"> Follow our coding adventures on Twitter! <i class="fa fa-twitter"></i></a>
		</h3>
	</li>
</ul>


    	<footer class="footer">
	<hr>
	<div class="footer-container">
    	<ul class="footer-link-list">
        	<li><a href="/tutorials">Tutorials</a></li>
        	<li><a href="/team">About Us</a></li>
        	<li><a href="/contact">Contact us</a></li>
	    	<li><a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer">Follow us on Twitter</a></li>
    	</ul>
    	<div class="footer-text">
			<p>We are happy for people to use and further develop our tutorials - please give credit to Coding Club by linking to <a href="https://ourcodingclub.github.io/" target="_blank" rel="noopener noreferrer">our website</a>. We are also happy to discuss possible collaborations, so get in touch at <b>ourcodingclub@gmail.com</b></p>
    		<p>See our <a href="/terms">Terms of Use</a> and our <a href="/privacy">Data Privacy policy</a>.</p>
			<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a></p>
			<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img class="license" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="CC-by-sa-4.0"></a>
    	</div>
    </div>
</footer>

<!-- JS -->
<script src="/scripts/owl.carousel.js"></script>
<script src="/scripts/owl.carousel-init.js"></script>
<script src="/scripts/reveal.js"></script>


	
	</body>
</html>
