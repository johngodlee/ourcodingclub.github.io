<!DOCTYPE html>
<html lang="en-GB">
	<head>
    	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Intro to model design</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->
<link rel="stylesheet" href="/css/main.css"/>
<link rel="stylesheet" href="/css/owlcarousel/owl.carousel.css">
<link rel="stylesheet" href="/css/owlcarousel/owl.theme.default.css">

<!-- JS -->
<script src="https://use.fontawesome.com/4dd22df1f8.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/scripts/accordion.js"></script>
<script src="/scripts/jquery.counterup.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.5/waypoints.min.js"></script>
<script src="/scripts/ticker.js"></script>

	</head>
	<body>
    	<header class="header">
	<div class="navigation-bar">
		<div id="navigation-container">
			
				<a class="logo" href="/">
  <img src="/assets/img/logos/logo_stack.svg" alt="Coding Club logo">
</a>

			
			<nav>
				<label for="hamburger">☰</label>
				<input type="checkbox" id="hamburger">
				<ul>
					
						
					<li class="item item-nav">
						<a href="/">Home</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/tutorials.html">Tutorials</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/course.html">Course</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/team.html">Team</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/involve.html">Get involved</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/links.html">Links</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/contact.html">Contact</a>
					</li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>

			<div class="block">
	<center>
		<img src="/img/tutheaderdesign.png" alt="Img">
	</center>
</div>

<h3 id="tutorial-aims">Tutorial Aims:</h3>

<h4 id="-1-learn-what-a-statistical-model-is-"><a href="#model"> 1. Learn what a statistical model is </a></h4>
<h4 id="-2-come-up-with-a-research-question-"><a href="#question"> 2. Come up with a research question </a></h4>
<h4 id="-3-think-about-our-data-"><a href="#thinking"> 3. Think about our data </a></h4>
<h4 id="-4-think-about-our-experimental-design-"><a href="#design"> 4. Think about our experimental design </a></h4>
<h4 id="-5-turn-a-question-into-a-model-"><a href="#types"> 5. Turn a question into a model </a></h4>
<h4 id="-6-learn-about-the-different-types-of-models-"><a href="#models"> 6. Learn about the different types of models </a></h4>
<h4 id="-7-general-linear-models-"><a href="#linear"> 7. General linear models </a></h4>
<h4 id="-8-hierarchical-models-using-lme4-"><a href="#lme4"> 8. Hierarchical models using <code class="language-plaintext highlighter-rouge">lme4</code> </a></h4>
<h4 id="-9-random-slopes-versus-random-intercepts-lme4-"><a href="#lme4b"> 9. Random slopes versus random intercepts <code class="language-plaintext highlighter-rouge">lme4</code> </a></h4>
<h4 id="-10-hierarchical-models-using-mcmcglmm-"><a href="#MCMCglmm"> 10. Hierarchical models using <code class="language-plaintext highlighter-rouge">MCMCglmm</code> </a></h4>

<h3 id="all-the-files-you-need-to-complete-this-tutorial-can-be-downloaded-from-this-repository-click-on-clonedownloaddownload-zip-and-unzip-the-folder-or-clone-the-repository-to-your-own-github-account">All the files you need to complete this tutorial can be downloaded from <a href="https://github.com/ourcodingclub/CC-model-design" target="_blank" rel="noopener noreferrer">this repository</a>. Click on <code class="language-plaintext highlighter-rouge">Clone/Download/Download ZIP</code> and unzip the folder, or clone the repository to your own GitHub account.</h3>

<h2 id="introduction">Introduction</h2>

<p><strong>Ecological data can throw up complex challenges for statistical models and designing the appropriate model to answer your research question can be one of the trickiest parts of ecological research (and research in other fields). Learning how to design statistical models can take time, but developing rigorous statistical approaches as early as possible will help you in your future research career. If you put the time in, soon you will realise that statistics aren’t a total pain and continuous frustration, but something pretty fun that really engages your brain in diverse ways. So to start off, I like to put the computer coding aside, make myself a hot drink or get a fancy latte at a coffee shop, get out my pen or pencil and paper and put on my thinking cap.</strong></p>

<p><a name="model"></a></p>

<h2 id="1-learn-what-a-statistical-model-is">1. Learn what a statistical model is</h2>

<p>In order to answer research questions, we require statistical tests of the relationships in our data. In modern ecology and other fields, models are designed to fit the structure of data and to appropriately test the questions that we have as researchers. Thus, the first step to any data analysis is figuring out what your research question is. <strong>Without a research question, there is no point in trying to conduct a statistical test. So let’s pause here and figure out the research question for our tutorial today.</strong></p>

<p><a name="question"></a></p>

<h2 id="2-the-research-question">2. The research question</h2>

<p>In this tutorial, we will work with part of the long-term plant cover dataset from the <a href="http://arc-lter.ecosystems.mbl.edu/terrestrial-data" target="_blank" rel="noopener noreferrer">Toolik Lake Field Station</a>.  These data (remember the word data is plural, thus data are … not data is …!) are plant composition data collected over four years across five sites over time in Arctic tundra in Northern Alaska.  A simple question we might ask with these data is: how has the species richness changed in these plots over time?</p>

<h3 id="question-1-how-has-plant-species-richness-changed-over-time-at-toolik-lake">Question 1: How has plant species richness changed over time at Toolik Lake?</h3>

<p>Once we have figured out our research question, we next need to figure out our hypothesis. To come up with a hypothesis, we need to learn something about this system. To start us off today, we will suggest a hypothesis for you: plant species richness is increasing over time. We might expect this as these tundra plots might be undergoing warming and warming might lead to increased plant species richness in tundra plant communities (see <a href="https://www.nature.com/articles/s41586-018-0005-6" target="_blank" rel="noopener noreferrer">this paper</a> for more on this topic).</p>

<p><strong>Hypothesis 1: Plant species richness has increased over time at Toolik Lake.</strong> (Remember to phrase your hypothesis in the past tense, as these data represent changes that have already occurred and remember that results are always written in the past tense.)</p>

<p>Now that we have a hypothesis, it is good practice to also write a null hypothesis. What are the hypotheses that we are testing between here? For example, a null hypothesis for these data and this question might be:</p>

<p><strong>Null Hypothesis: Plant species richness has not changed over time at Toolik Lake.</strong></p>

<p>We might also have an alternative hypothesis:</p>

<p><strong>Hypothesis 2: Plant species richness has decreased over time at Toolik Lake.</strong></p>

<p>Toolik Lake Station is in Alaska, a place that has been warming at rates higher than the rest of the world, so we might also wonder how temperature influences the plant communities there, in particular, their richness. So, we pose a second question:</p>

<h3 id="question-2-how-does-mean-annual-temperature-influence-plant-species-richness">Question 2: How does mean annual temperature influence plant species richness?</h3>

<p><strong>Hypothesis 1: Higher temperatures correspond with higher species richness.</strong></p>

<h4 id="how-are-questions-1-and-2-different">How are questions 1 and 2 different?</h4>

<p><strong>Detection models</strong>
When we ask how plant species richness has changed over time, we are interested in <strong>detecting</strong> change. We want to know what happened to plant communities in Toolik Lake, but we are not testing anything regarding <strong>why</strong> such changes in species richness occurred (and maybe there were no changes over time).</p>

<p><strong>Attribution models</strong>
When we ask how temperature influences plant species richness, we are looking to attribute the changes we’ve seen to a specific driver, in this case, temperature. Attribution models often are the next step from a detection model. First, you want to know what happened, then you try to figure out why it happened. For example, if we find a strong positive relationship between temperature and species richness (e.g., as temperature goes up, so does species richness), then temperature is likely to be one of the drivers of local-scale changes in species richness.</p>

<p>For now, this should be enough set-up for us to progress ahead with our models, but remember to <strong>always start with the question first when conducting any research project and statistical analysis.</strong></p>

<p><a name="thinking"></a></p>

<h2 id="3-thinking-about-our-data">3. Thinking about our data</h2>

<p>There are different statistical tests that we could use to conduct our analyses and what sort of statistical test we use depends on the question and the type of data that we have to test our research question.  Since we have already thought about our question for a bit, let’s now think about our data.  What kind of data are we dealing with here?</p>

<p>Our data consists of plant species cover measured across four years in plots that were within blocks, which were then within sites.  We have the variables: <code class="language-plaintext highlighter-rouge">Year</code>, <code class="language-plaintext highlighter-rouge">Site</code>, <code class="language-plaintext highlighter-rouge">Treatment</code>, <code class="language-plaintext highlighter-rouge">Block</code>, <code class="language-plaintext highlighter-rouge">Plot</code>, <code class="language-plaintext highlighter-rouge">Species</code>, <code class="language-plaintext highlighter-rouge">Relative.Cover</code>, <code class="language-plaintext highlighter-rouge">Mean.Temp</code> and <code class="language-plaintext highlighter-rouge">SD.Temp</code> in our dataframe.  Let’s look at the dataframe now.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load libraries ----</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">  </span><span class="c1"># for data manipulation</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">  </span><span class="c1"># for data visualisation</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">lme4</span><span class="p">)</span><span class="w">  </span><span class="c1"># for models</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sjPlot</span><span class="p">)</span><span class="w">  </span><span class="c1"># to visualise model outputs</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggeffects</span><span class="p">)</span><span class="w">  </span><span class="c1"># to visualise model predictions</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">MCMCglmm</span><span class="p">)</span><span class="w">  </span><span class="c1"># for models</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">MCMCvis</span><span class="p">)</span><span class="w">  </span><span class="c1"># to visualise model outputs</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">brms</span><span class="p">)</span><span class="w">  </span><span class="c1"># for models</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">stargazer</span><span class="p">)</span><span class="w">  </span><span class="c1"># for tables of model outputs</span><span class="w">

</span><span class="c1"># Load data ----</span><span class="w">
</span><span class="c1"># Remember to set your working directory to the folder</span><span class="w">
</span><span class="c1"># where you saved the workshop files</span><span class="w">
</span><span class="n">toolik_plants</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"toolik_plants.csv"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Inspect data</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>To check out what class of data we are dealing with we can use the str() function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Site</code> and <code class="language-plaintext highlighter-rouge">Species</code> are strings (letters) and categorical data (factors) - they are names.  <code class="language-plaintext highlighter-rouge">Year</code>, <code class="language-plaintext highlighter-rouge">Cover</code>, <code class="language-plaintext highlighter-rouge">Mean.Temp</code> and <code class="language-plaintext highlighter-rouge">SD.Temp</code> are numeric and continuous data - they are numbers. <code class="language-plaintext highlighter-rouge">Cover</code> shows the relative cover (out of 1) for different plant species, <code class="language-plaintext highlighter-rouge">Mean.Temp</code> is the mean annual temperature at Toolik Lake Station and <code class="language-plaintext highlighter-rouge">SD.Temp</code> is the standard deviation of the mean annual temperature. Then, we have <code class="language-plaintext highlighter-rouge">Treatment</code>, another categorical variable that refers to different chemical treatments, e.g. some plots received extra nitrogen, others extra phosphorus. Finally, we have <code class="language-plaintext highlighter-rouge">Block</code> and <code class="language-plaintext highlighter-rouge">Plot</code>, which give more detailed information about where the measurements were taken.</p>

<p>The plot numbers are currently coded as numbers - 1, 2,…8, making it a numerical variable. We should make them a categorical variable, since just like <code class="language-plaintext highlighter-rouge">Site</code> and <code class="language-plaintext highlighter-rouge">Block</code>, the numbers represent the different categories, not actual count data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Plot</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Now, let’s think about the distributions of the data. <strong>Our data structure is a bit like a Russian doll, so let’s start looking into that layer by layer.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get the unique site names</span><span class="w">
</span><span class="n">unique</span><span class="p">(</span><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Site</span><span class="p">)</span><span class="w">
</span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Site</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>First, we have five sites (<code class="language-plaintext highlighter-rouge">06MAT</code>, <code class="language-plaintext highlighter-rouge">DH</code>, <code class="language-plaintext highlighter-rouge">MAT</code>, <code class="language-plaintext highlighter-rouge">MNT</code> and <code class="language-plaintext highlighter-rouge">SAG</code>).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Group the dataframe by Site to see the number of blocks per site</span><span class="w">
</span><span class="n">toolik_plants</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">Site</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">block.n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">Block</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Within each site, there are different numbers of blocks: some sites have three sample blocks, others have four or five.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">toolik_plants</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">Block</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">plot.n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">Plot</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>Within each block, there are eight smaller plots.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unique(toolik_plants$Year)
</code></pre></div></div>

<p>There are four years of data from 2008 to 2012.</p>

<p><strong>How many species are represented in this data set?  Let’s use some code to figure this out. Using the <code class="language-plaintext highlighter-rouge">unique</code> and <code class="language-plaintext highlighter-rouge">length</code> functions, we can count how many species are in the dataset as a whole.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Species</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>There are 129 different species, but are they all actually species? It’s always a good idea to see what hides behind the numbers, so we can print the species to see what kind of species they are.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">unique</span><span class="p">(</span><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Species</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Some plant categories are in as just <code class="language-plaintext highlighter-rouge">moss</code> and <code class="language-plaintext highlighter-rouge">lichen</code> and they might be different species or more than one species, but for the purposes of the tutorial, we can count them as one species. There are other records that are definitely not species though: <code class="language-plaintext highlighter-rouge">litter</code>, <code class="language-plaintext highlighter-rouge">bare</code> (referring to bare ground), <code class="language-plaintext highlighter-rouge">Woody cover</code>, <code class="language-plaintext highlighter-rouge">Tube</code>, <code class="language-plaintext highlighter-rouge">Hole</code>, <code class="language-plaintext highlighter-rouge">Vole trail</code>, <code class="language-plaintext highlighter-rouge">removed</code>, <code class="language-plaintext highlighter-rouge">vole turds</code>, <code class="language-plaintext highlighter-rouge">Mushrooms</code>, <code class="language-plaintext highlighter-rouge">Water</code>, <code class="language-plaintext highlighter-rouge">Caribou poop</code>, <code class="language-plaintext highlighter-rouge">Rocks</code>, <code class="language-plaintext highlighter-rouge">mushroom</code>, <code class="language-plaintext highlighter-rouge">caribou poop</code>, <code class="language-plaintext highlighter-rouge">animal litter</code>, <code class="language-plaintext highlighter-rouge">vole poop</code>, <code class="language-plaintext highlighter-rouge">Vole poop</code>, <code class="language-plaintext highlighter-rouge">Unk?</code>.</strong></p>

<p>You might wonder why people are recording vole poop. This relates to how the data were collected: each plot is 1m^2 and there are 100 points within it. When people survey the plots, they drop a pin from each point and then record everything that touches the pin, be it a plant, or vole poop!</p>

<p><strong>The non-species records in the species column are a good opportunity for us to practice data manipulation (<a href="https://ourcodingclub.github.io/2017/01/16/piping.html" target="_blank" rel="noopener noreferrer">you can check out our data manipulation tutorial here later</a>). We will filter out the records we don’t need using the <code class="language-plaintext highlighter-rouge">filter</code> function from the <code class="language-plaintext highlighter-rouge">dplyr</code> package.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># We use ! to say that we want to exclude</span><span class="w">
</span><span class="c1"># all records that meet the criteria</span><span class="w">

</span><span class="c1"># We use %in% as a shortcut - we are filtering by many criteria</span><span class="w">
</span><span class="c1"># but they all refer to the same column: Species</span><span class="w">
</span><span class="n">toolik_plants</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toolik_plants</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">Species</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Woody cover"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Tube"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"Hole"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Vole trail"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"removed"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vole turds"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"Mushrooms"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Water"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"Caribou poop"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Rocks"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"mushroom"</span><span class="p">,</span><span class="w"> </span><span class="s2">"caribou poop"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"animal litter"</span><span class="p">,</span><span class="w"> </span><span class="s2">"vole poop"</span><span class="p">,</span><span class="w">
                         </span><span class="s2">"Vole poop"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Unk?"</span><span class="p">))</span><span class="w">

</span><span class="c1"># A much longer way to achieve the same purpose is:</span><span class="w">
</span><span class="c1"># toolik_plants &lt;- toolik_plants %&gt;%</span><span class="w">
</span><span class="c1">#  filter(Species != "Woody cover" &amp;</span><span class="w">
</span><span class="c1">#	       Species != "Tube" &amp;</span><span class="w">
</span><span class="c1">#         Species != "Hole"&amp;</span><span class="w">
</span><span class="c1">#				 Species != "Vole trail"....))</span><span class="w">
</span><span class="c1"># But you can see how that involves unnecessary repetition.</span><span class="w">
</span></code></pre></div></div>

<p>Let’s see how many species we have now:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">toolik_plants</span><span class="o">$</span><span class="n">Species</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><strong>115 species! Next, we can calculate how many species were recorded in each plot in each survey year.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Calculate species richness</span><span class="w">
</span><span class="n">toolik_plants</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">toolik_plants</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">Site</span><span class="p">,</span><span class="w"> </span><span class="n">Block</span><span class="p">,</span><span class="w"> </span><span class="n">Plot</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">unique</span><span class="p">(</span><span class="n">Species</span><span class="p">)))</span><span class="w">
</span></code></pre></div></div>

<p>To explore the data further, we can make a histogram of species richness.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">hist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">toolik_plants</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Richness</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_classic</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p>Note that putting your entire <code class="language-plaintext highlighter-rouge">ggplot</code> code in brackets () creates the graph and then shows it in the plot viewer. If you don’t have the brackets, you’ve only created the object, but haven’t visualised it. You would then have to call the object such that it will be displayed by just typing <code class="language-plaintext highlighter-rouge">hist</code> after you’ve created the <code class="language-plaintext highlighter-rouge">hist</code> object.</p>

<center> <img src="/img/richness_hist.png" alt="Img" style="width: 400px;"> </center>

<p><strong>There are some other things we should think about.  There are different types of numeric data here.  For example, the years are whole numbers: we can’t have the year 2000.5.</strong></p>

<p><strong>The plant cover can be any value that is positive, it is therefore bounded at 0 and must be between 0 and 1. We can see this when we make a histogram of the data:</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">hist2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">toolik_plants</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Relative.Cover</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">theme_classic</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/cover_hist.png" alt="Img" style="width: 400px;"> </center>

<p><strong>The plant cover data are skewed to the left, i.e., most of the records in the <code class="language-plaintext highlighter-rouge">Relative.Cover</code> column have small values. These distributions and characteristics of the data need to be taken into account when we design our model.</strong></p>

<p><a name="design"></a></p>

<h2 id="4-thinking-about-our-experimental-design">4. Thinking about our experimental design</h2>
<p>In the Toolik dataset of plant cover, we have both spatial and temporal replication.  The spatial replication is on three different levels: there are multiple sites, which have multiple blocks within them and each block has eight plots. The temporal replication refers to the different years in which plant cover was recorded: four years.</p>

<p><strong>What other types of issues might we need to consider?</strong></p>

<h3 id="spatial-autocorrelation">Spatial autocorrelation</h3>
<p>One of the assumptions of a model is that the data points are independent. In reality, that is very rarely the case. For example, plots that are closer to one another might be more similar, which may or may not be related to some of the drivers we’re testing, e.g. temperature.</p>

<h3 id="temporal-autocorrelation">Temporal autocorrelation</h3>
<p>Similarly, it’s possible that the data points in one year are not independent from those in the year before. For example, if a species was more abundant in the year 2000, that’s going to influence it’s abundance in 2001 as well.</p>

<p><a name="types"></a></p>

<h2 id="5-turn-a-question-into-a-model">5. Turn a question into a model</h2>

<p><strong>Let’s go back to our original question:</strong></p>

<h3 id="question-1-how-has-plant-species-richness-changed-over-time-at-toolik-lake-1">Question 1: How has plant species richness changed over time at Toolik Lake?</h3>

<p>What is our dependent and independent variable here?  We could write out our base model in words:</p>

<p><strong>Richness is a function of time.</strong></p>

<p><strong>In <code class="language-plaintext highlighter-rouge">R</code>, this turns into the code: <code class="language-plaintext highlighter-rouge">richness ~ time</code>.</strong></p>

<p><strong>Richness is our dependent (predictor) variable and time is our independent variable (<a href="https://en.wikipedia.org/wiki/Dependent_and_independent_variables" target="_blank" rel="noopener noreferrer"> see here for more details</a>). This is our base model, but what other things do we need to account for? What would happen if we just modelled richness as a function of time without dealing with the other structure in our data?  Let’s find out in the rest of the tutorial.</strong></p>

<p><a name="models"></a></p>

<h2 id="6-learn-about-the-different-types-of-models">6. Learn about the different types of models</h2>

<p>Before we get back to our dataset that we are designing a model for, let’s revisit some statistics basics.</p>

<p><strong>Here are some questions to consider.</strong></p>

<h3 id="what-is-the-difference-between-a-continuous-and-a-categorical-variable-in-a-linear-model">What is the difference between a continuous and a categorical variable in a linear model?</h3>

<h3 id="how-many-variables-can-you-have-in-a-model">How many variables can you have in a model?</h3>

<h3 id="is-it-better-to-have-one-model-with-five-variables-or-one-model-per-variable-when-do-we-choose-variables">Is it better to have one model with five variables or one model per variable? When do we choose variables?</h3>

<h3 id="what-is-a-fixed-effect-what-is-a-random-effect">What is a fixed effect? What is a random effect?</h3>

<h3 id="what-is-the-most-important-result-from-a-model-output">What is the most important result from a model output?</h3>

<h3 id="why-does-it-matter-which-type-of-models-we-use">Why does it matter which type of models we use?</h3>

<p><a name="linear"></a></p>

<h2 id="7-general-linear-models">7. General linear models</h2>

<p>Model without any random effects:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">Year</span><span class="m">-2007</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h4 id="assumptions-made">Assumptions made:</h4>

<ol>
  <li>The data are normally distributed.</li>
  <li>The data points are independent of one another.</li>
  <li>The relationship between the variables we are studying is actually linear.</li>
</ol>

<p>And there are many more - you can check out <a href="http://r-statistics.co/Assumptions-of-Linear-Regression.html" target="_blank" rel="noopener noreferrer">this useful website</a> for the full list with examples and how to check if those are assumptions are met later.</p>

<p><strong>Do you think the assumptions of a general linear model are met for our questions and data? Probably not!</strong></p>

<p><strong>From the histograms, we can see that the data are not normally distributed, and furthermore, if we think about what the data are, they are integer counts (number of species), probably a bit skewed to the left, as most plots might not have a crazy amount of species. For these reasons, a Poisson distribution might be suitable, not a normal one. You can check out the <a href="https://ourcodingclub.github.io/2017/02/28/modelling.html" target="_blank" rel="noopener noreferrer">Models and Distributions Coding Club tutorial</a> for more about different data distributions.</strong></p>

<p><strong>We know that because of how the experimental design was set up (remember the Russian doll of plots within blocks within sites), the data points are not independent from one another. If we don’t account for the plot, block and site-level effects, we are completely ignoring the hierarchical structure of our data, which might then lead to wrong inferences based on the wrong model outputs.</strong></p>

<h2 id="what-is-model-convergence">What is model convergence?</h2>

<p><strong>Model convergence is whether or not the model has worked, whether it has estimated your response variable (and random effects, see below) - basically whether the underlying mathematics have worked or have “broken” in some way. When we fit more complicated models, then we are pushing the limits of the underlying mathematics and things can go wrong, so it is important to check that your model did indeed work and that the estimates that you are making do make sense in the context of your raw data and the question you are asking/hypotheses that you are testing.</strong></p>

<p><strong>Checking model convergence can be done at different levels. With parametric models, good practice is to check the residual versus predicted plots. Using Bayesian approaches, there are a number of plots and statistics that can be assessed to determine model convergence. See below and in the Coding Club MCMCglmm tutorial (<a href="https://ourcodingclub.github.io/2018/01/22/mcmcglmm.html" target="_blank" rel="noopener noreferrer">tutorial here</a>). For an advanced discussion of model convergence, check out <a href="https://rdrr.io/cran/lme4/man/convergence.html" target="_blank" rel="noopener noreferrer">model convergence in lme4</a>.</strong></p>

<p><strong>For now, let’s check the residual versus predicted plot for our linear model. By using the ‘plot()’ function, we can plot the residuals versus fitted values, a Q-Q plot of standardised residuals, a scale-location plot (square roots of standardiaed residuals versus fitted values) and a plot of residuals versus leverage that adds bands corresponding to Cook’s distances of 0.5 and 1. Looking at these plots can help you identify any outliers that have huge leverage and confirm that your model has indeed run e.g. you want the data points on the Q-Q plot to follow the one-to-one line.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">plant_m</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><a name="lme4"></a></p>

<h2 id="8-hierarchical-models-using-lme4">8. Hierarchical models using <code class="language-plaintext highlighter-rouge">lme4</code>
</h2>

<p>Now that we have explored the idea of a hierarchical model, let’s see how our analysis changes if we do or do not incorporate elements of the experimental design to the hierarchy of our model.</p>

<p>First, let’s model with only site as a random effect.  This model does not incorporate the temporal replication in the data or the fact that there are plots within blocks within those sites.</p>

<p>Notice how we have transformed the <code class="language-plaintext highlighter-rouge">Year</code> column - <code class="language-plaintext highlighter-rouge">I(Year - 2007)</code> means that the year <code class="language-plaintext highlighter-rouge">2008</code> will become <code class="language-plaintext highlighter-rouge">Year 1</code> - then your model is estimating richness across the first, second, etc., year from your survey period. Otherwise, if we had kept the years just as <code class="language-plaintext highlighter-rouge">2008</code>, <code class="language-plaintext highlighter-rouge">2009</code>,…, the model would have estimated richness really far back into the past, starting from <code class="language-plaintext highlighter-rouge">Year 1</code>, <code class="language-plaintext highlighter-rouge">Year 2</code>… <code class="language-plaintext highlighter-rouge">Year 1550</code> up until <code class="language-plaintext highlighter-rouge">2012</code>. This would make the magnitude of the estimates we get wrong. You can experiment to see what happens if we just add in <code class="language-plaintext highlighter-rouge">Year</code> - suddenly the slope of species change goes in the hundreds!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_plot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">Year</span><span class="m">-2007</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Site</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_plot</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">plant_m_plot</span><span class="p">)</span><span class="w">  </span><span class="c1"># Checking assumptions</span><span class="w">
</span></code></pre></div></div>

<p>From the <code class="language-plaintext highlighter-rouge">summary()</code> outputs, you can see the effect sizes, a key element of the model outputs. Effect sizes tell us about the strengths of the relationships we are testing. We are still not accounting for the different plots and blocks though, so let’s gradually add those and see how the results change.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_plot2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">Year</span><span class="m">-2007</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Site</span><span class="o">/</span><span class="n">Block</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_plot2</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Have the estimates for the effect sizes changed?</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_plot3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">Year</span><span class="m">-2007</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Site</span><span class="o">/</span><span class="n">Block</span><span class="o">/</span><span class="n">Plot</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_plot3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>This final model answers our question about how plant species richness has changed over time, whilst also accounting for the hierarchical structure of the data. Let’s visualise the results using the <code class="language-plaintext highlighter-rouge">sjPlot</code> package!</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set a clean theme for the graphs</span><span class="w">
</span><span class="n">set_theme</span><span class="p">(</span><span class="n">base</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
            </span><span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                  </span><span class="n">panel.grid.minor.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                  </span><span class="n">panel.grid.minor.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                  </span><span class="n">panel.grid.major.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
                  </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">)))</span><span class="w">

</span><span class="c1"># Visualises random effects </span><span class="w">
</span><span class="p">(</span><span class="n">re.effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_model</span><span class="p">(</span><span class="n">plant_m_plot3</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"re"</span><span class="p">,</span><span class="w"> </span><span class="n">show.values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"model_re.png"</span><span class="p">,</span><span class="w">
          </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">  </span><span class="c1"># Save the graph if you wish</span><span class="w">

</span><span class="c1"># To see the estimate for our fixed effect (default): Year</span><span class="w">
</span><span class="p">(</span><span class="n">fe.effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_model</span><span class="p">(</span><span class="n">plant_m_plot3</span><span class="p">,</span><span class="w"> </span><span class="n">show.values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"model_fe.png"</span><span class="p">,</span><span class="w">
          </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">  </span><span class="c1"># Save the graph if you wish</span><span class="w">
</span></code></pre></div></div>

<p>Note how when we visualise our random effects, three different plots come up (use the arrow buttons in the “plots” window to scroll through the plots). The first two show the interaction effects. Here, we are only interested in the plot that shows us the random effects of site, i.e. the figure we see below:</p>

<center> <img src="/img/model_re.png" alt="Img" style="width: 500px;"> <img src="/img/model_fe.png" alt="Img" style="width: 500px;">
</center>

<h3 id="for-our-second-question-how-does-temperature-influence-species-richness-we-can-design-a-similar-model-with-one-important-difference-we-will-include-year-as-a-random-effect-to-account-for-temporal-autocorrelation">For our second question, how does temperature influence species richness, we can design a similar model with one important difference: we will include <code class="language-plaintext highlighter-rouge">Year</code> as a random effect to account for temporal autocorrelation.</h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_temp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Mean.Temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Site</span><span class="o">/</span><span class="n">Block</span><span class="o">/</span><span class="n">Plot</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Year</span><span class="p">),</span><span class="w">
                      </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_temp</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Let’s see the model outputs again:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Visualise the random effect terms
(temp.re.effects &lt;- plot_model(plant_m_temp, type = "re", show.values = TRUE))
save_plot(filename = "model_temp_re.png",
          height = 11, width = 9)

# Visualise the fixed effect
(temp.fe.effects &lt;- plot_model(plant_m_temp, show.values = TRUE))
save_plot(filename = "model_temp_fe.png",
          height = 11, width = 9)
</code></pre></div></div>

<p>Again, with the random effect terms, we can see the random effects of interactions, as well as for site, and year. Use your arrow buttons in the plots window to navigate between the plots. The figure you see below is the random effect of year.</p>

<center> <img src="/img/model_temp_re.png" alt="Img" style="width: 500px;"> <img src="/img/model_temp_fe.png" alt="Img" style="width: 500px;">
</center>

<h4 id="assumptions-made-1">Assumptions made:</h4>

<ol>
  <li>The data are normally distributed.</li>
  <li>The data points are independent of one another.</li>
  <li>The relationship between the variables we are studying is actually linear.</li>
  <li>Plots represent the spatial replication and years represent the temporal replication in our data.</li>
</ol>

<h4 id="assumptions-not-accounted-for">Assumptions not accounted for:</h4>

<ol>
  <li>We have not accounted for spatial autocorrelation in the data - whether more closely located plots are more likely to show similar responses than farther away plots.</li>
  <li>We have not accounted for temporal autocorrelation in the data - whether the influence of prior years of data are influencing the data in a given year.</li>
</ol>

<p><a name="lme4b"></a></p>

<h2 id="9-random-slopes-versus-random-intercepts-lme4">9. Random slopes versus random intercepts <code class="language-plaintext highlighter-rouge">lme4</code>
</h2>

<p><strong>We can now think about having random slopes and random intercepts. For our question, how does temperature influence species richness, we can allow each plot to have it’s own relationship with temperature.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_rs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Mean.Temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mean.Temp</span><span class="o">|</span><span class="n">Site</span><span class="o">/</span><span class="n">Block</span><span class="o">/</span><span class="n">Plot</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Year</span><span class="p">),</span><span class="w">
                 </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>Check out the summary outputs and the messages we get. This model is not converging and we shouldn’t trust its outputs: the model structure is too complicated for the underlying data, so now we can simplify it.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_rs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Mean.Temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mean.Temp</span><span class="o">|</span><span class="n">Plot</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="m">1</span><span class="o">|</span><span class="n">Year</span><span class="p">),</span><span class="w">
                 </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>This one is not converging either! Let’s try with just a <code class="language-plaintext highlighter-rouge">Plot</code> random intercept and with random slopes to illustrate what a random slope model looks like.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_m_rs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lmer</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Mean.Temp</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">Mean.Temp</span><span class="o">|</span><span class="n">Plot</span><span class="p">),</span><span class="w">
                 </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can visualise the results:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">plant.re.effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_model</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"re"</span><span class="p">,</span><span class="w"> </span><span class="n">show.values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"model_plant_re.png"</span><span class="p">,</span><span class="w">
          </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">plant.fe.effects</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_model</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">,</span><span class="w"> </span><span class="n">show.values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"model_plant_fe.png"</span><span class="p">,</span><span class="w">
          </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/model_plant_re.png" alt="Img" style="width: 500px;"> <img src="/img/model_plant_fe.png" alt="Img" style="width: 500px;">
</center>

<p>To get a better idea of what the random slopes and intercepts are doing, we can visualise your model predictions. We will use the <code class="language-plaintext highlighter-rouge">ggeffects</code> package to calculate model predictions and plot them. First, we calculate the overall predictions for the relationship between species richness and temperature. Then, we calculate the predictions for each plot, thus visualising the among-plot variation. Note that the second graph has both freely varying slopes and intercepts (i.e., they’re different for each plot).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ggpredict</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">,</span><span class="w"> </span><span class="n">terms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Mean.Temp"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">plot</span><span class="p">()</span><span class="w">
</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"model_temp_richness.png"</span><span class="p">,</span><span class="w">
          </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">

</span><span class="n">ggpredict</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">,</span><span class="w"> </span><span class="n">terms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Mean.Temp"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Plot"</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"re"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">plot</span><span class="p">()</span><span class="w">
</span><span class="n">save_plot</span><span class="p">(</span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"model_temp_richness_rs_ri.png"</span><span class="p">,</span><span class="w">
          </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">9</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/model_temp_richness.png" alt="Img" style="width: 500px;"> <img src="/img/model_temp_richness_rs_ri.png" alt="Img" style="width: 500px;">
</center>

<h4 id="an-important-note-about-honest-graphs">An important note about honest graphs!</h4>

<p>Interestingly, the default options from the <code class="language-plaintext highlighter-rouge">ggpredict()</code> function set the scale differently for the y axes on the two plots. If you just see the first plot, at a first glance you’d think that species richness is increasing a lot as temperature increases! But take note of the y axis: it doesn’t actually start at zero, thus the relationship is shown to be way stronger than it actually is.</p>

<p><strong>We can manually plot the predictions to overcome this problem.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Overall predictions - note that we have specified just mean temperature as a term</span><span class="w">
</span><span class="n">predictions</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggpredict</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">,</span><span class="w"> </span><span class="n">terms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Mean.Temp"</span><span class="p">))</span><span class="w">

</span><span class="p">(</span><span class="n">pred_plot1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">predicted</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_ribbon</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.low</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">conf.high</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">22</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\nMean annual temperature"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted species richness\n"</span><span class="p">))</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="n">pred_plot1</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"overall_predictions.png"</span><span class="p">,</span><span class="w">
       </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>The relationship between temperature and species richness doesn’t look that strong anymore! In fact, we see pretty small increases in species richness as temperature increases. What does that tell you about our hypothesis?</strong></p>

<p>Now we can do the same, but this time taking into account the random effect.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Predictions for each grouping level (here plot which is a random effect)</span><span class="w">
</span><span class="c1"># re stands for random effect</span><span class="w">
</span><span class="n">predictions_rs_ri</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggpredict</span><span class="p">(</span><span class="n">plant_m_rs</span><span class="p">,</span><span class="w"> </span><span class="n">terms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Mean.Temp"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Plot"</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"re"</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">pred_plot2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">predictions_rs_ri</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">22</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\nMean annual temperature"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted species richness\n"</span><span class="p">))</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="n">pred_plot2</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ri_rs_predictions.png"</span><span class="p">,</span><span class="w">
       </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<center> <img src="/img/overall_predictions.png" alt="Img" style="width: 500px;"> <img src="/img/ri_rs_predictions.png" alt="Img" style="width: 500px;">
</center>

<p><strong>Just for the sake of really seeing the random intercepts and random slopes, here is a zoomed in version), but note that when preparing graphs for reports or publications, your axes should start at zero to properly visualise the magnitude of the shown relationship.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">pred_plot3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">predictions_rs_ri</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predicted</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"lm"</span><span class="p">,</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\nMean annual temperature"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Predicted species richness\n"</span><span class="p">))</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="n">pred_plot3</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ri_rs_predictions_zoom.png"</span><span class="p">,</span><span class="w">
       </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/ri_rs_predictions_zoom.png" alt="Img" style="width: 500px;">
</center>

<p><a name="MCMCglmm"></a></p>

<h2 id="10-hierarchical-models-using-mcmcglmm">10. Hierarchical models using <code class="language-plaintext highlighter-rouge">MCMCglmm</code>
</h2>

<p><strong>Let’s take our <code class="language-plaintext highlighter-rouge">lme4</code> model and explore what that model structure looks like in <code class="language-plaintext highlighter-rouge">MCMCglmm</code>. <code class="language-plaintext highlighter-rouge">MCMCglmm</code> fits Generalised Linear Mixed-effects Models using a Markov chain Monte Carlo approach under a Bayesian statistical framework.</strong></p>

<p><strong>To learn more about hierarchical models using <code class="language-plaintext highlighter-rouge">MCMCglmm</code>, you can check out our <a href="https://ourcodingclub.github.io/2018/01/22/mcmcglmm.html" target="_blank" rel="noopener noreferrer">tutorial here</a>, which has more details on the different model structures you can have and also provides an explanation of what priors are and how to set them in <code class="language-plaintext highlighter-rouge">MCMCglmm</code>.</strong></p>

<p>For now, we can proceed knowing that just like in <code class="language-plaintext highlighter-rouge">lme4</code>, in <code class="language-plaintext highlighter-rouge">MCMCglmm</code>, we can add random and fixed effects to account for the structure of the data we are modelling. In <code class="language-plaintext highlighter-rouge">MCMCglmm</code>, there is greater flexibility in terms of specifying <strong>priors</strong> - that is, you can give your model additional information that is then taken into account when the model runs. For example, there might be some lower and upper bound limit for our response variable - e.g. we probably won’t find more than 1000 species in one small plant plot and zero is the lowest species richness can ever be.</p>

<p><strong><code class="language-plaintext highlighter-rouge">MCMCglmm</code> models are also suitable when you are working with zero-inflated data e.g., when you are modelling population abundance through time, often the data either have a lot of zeros (meaning that you didn’t see your target species) or they are skewed towards the left (there are more low numbers, like one skylark, two skylarks, then there are high numbers, 40 skylarks). If a model won’t converge (i.e. you get error messages about convergence or the model outputs are very questionable), first of course revisit your question, your explanatory and response variables, fixed and random effects and once you’re sure all of those are sound, you can explore fitting the model using <code class="language-plaintext highlighter-rouge">MCMCglmm</code>. Because of the behind the scenes action (the thousands MCMC iterations that the model runs) and the statistics behind <code class="language-plaintext highlighter-rouge">MCMCglmm</code>, these types of models might be able to handle data that models using <code class="language-plaintext highlighter-rouge">lme4</code> can’t.</strong></p>

<p><strong>Let’s explore how to answer our questions using models in <code class="language-plaintext highlighter-rouge">MCMCglmm</code>! We can gradually build a more complex model, starting with a <code class="language-plaintext highlighter-rouge">Site</code> random effect.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_mcmc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">MCMCglmm</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">Year</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">2007</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">Site</span><span class="p">,</span><span class="w">
                       </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"poisson"</span><span class="p">,</span><span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>But we have a different problem: the model doesn’t converge.</p>

<center> <img src="/img/mcmc_error.png" alt="Img" style="width: 700px;"> </center>

<p>The <code class="language-plaintext highlighter-rouge">MCMC_dummy</code> warning message is just referring to the fact that the data, <code class="language-plaintext highlighter-rouge">toolik_plants</code>, has the characteristics of a <code class="language-plaintext highlighter-rouge">tibble</code>, a data format for objects that come out of a <code class="language-plaintext highlighter-rouge">dplyr</code> pipe. So that’s not something to worry about now, the real problem is that the model can’t converge when <code class="language-plaintext highlighter-rouge">Site</code> is a random effect. We might not have enough sites or enough variation in the data.</p>

<p><strong>Let’s explore how the model looks if we include <code class="language-plaintext highlighter-rouge">Block</code> and <code class="language-plaintext highlighter-rouge">Plot</code> as random effects (here they are random intercepts).</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plant_mcmc</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">MCMCglmm</span><span class="p">(</span><span class="n">Richness</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">I</span><span class="p">(</span><span class="n">Year</span><span class="m">-2007</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">Block</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Plot</span><span class="p">,</span><span class="w">
                       </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"poisson"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toolik_plants</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The model has ran, we have seen the many iterations roll down the screen, but what are the results and has the model really worked? Just like with other models, we can use <code class="language-plaintext highlighter-rouge">summary()</code> to see a summary of the model outputs.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">plant_mcmc</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/mcmc_results.png" alt="Img" style="width: 500px;"> </center>

<p>The posterior mean (i.e., the slope) for the <code class="language-plaintext highlighter-rouge">Year</code> term is <code class="language-plaintext highlighter-rouge">-0.07</code> (remember that this is on the logarithmic scale, because we have used a Poisson distribution). So in general, based on this model, species richness has declined over time.</p>

<p><strong>Now we should check if the model has converged. In <code class="language-plaintext highlighter-rouge">MCMCglmm</code>, we assess that using trace plots. You want them to look like a fuzzy caterpillar. <code class="language-plaintext highlighter-rouge">Sol</code> refers to the fixed effects and <code class="language-plaintext highlighter-rouge">VCV</code> to the random effects. Ours really don’t give off that fuzzy caterpillar vibe! So in this case, even though the model ran and we got our estimates, we wouldn’t really trust this model. This model is therefore not really the best model to answer our research question, because we are not accounting for the site effects, or for the fact that the plots are within blocks within sites.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">plant_mcmc</span><span class="o">$</span><span class="n">VCV</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">plant_mcmc</span><span class="o">$</span><span class="n">Sol</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center> <img src="/img/bad_traces.png" alt="Img" style="width: 500px;"> </center>

<p><strong>Let’s see what the <code class="language-plaintext highlighter-rouge">MCMCglmm</code> models are like when we estimate changes in the cover of one species - <em>Betula nana</em>, dwarf birch. We can also use a <code class="language-plaintext highlighter-rouge">Poisson</code> distribution here, as we can think about plant cover as proportion data, e.g., <em>Betula nana</em> cover say 42% of our sample plot. There might be other suitable distributions like a beta binomial distribution, which we will explore in the sequel to this tutorial, coming to you soon!</strong></p>

<p><strong>We have added code for parameter-expanded priors. You don’t need to worry about the details of those, as in this tutorial we are thinking about the design of the model. These priors will improve model convergence and if you want to find out more about them, you can check out the <a href="https://ourcodingclub.github.io/2018/01/22/mcmcglmm.html" target="_blank" rel="noopener noreferrer"><code class="language-plaintext highlighter-rouge">MCMCglmm</code> tutorial here</a>.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Set weakly informative priors</span><span class="w">
</span><span class="n">prior2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.002</span><span class="p">),</span><span class="w">
               </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">G1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">alpha.mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha.v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">),</span><span class="w">
                        </span><span class="n">G2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">alpha.mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha.v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">),</span><span class="w">
                        </span><span class="n">G3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">alpha.mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">alpha.v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">)))</span><span class="w">

</span><span class="c1"># Extract just the Betula nana data</span><span class="w">
</span><span class="n">betula</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">toolik_plants</span><span class="p">,</span><span class="w"> </span><span class="n">Species</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Bet nan"</span><span class="p">)</span><span class="w">

</span><span class="n">betula_m</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">MCMCglmm</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">Relative.Cover</span><span class="o">*</span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Year</span><span class="p">,</span><span class="w"> </span><span class="n">random</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">~</span><span class="n">Site</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Block</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Plot</span><span class="p">,</span><span class="w">
                     </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"poisson"</span><span class="p">,</span><span class="w"> </span><span class="n">prior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prior2</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">betula</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">betula_m</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">betula_m</span><span class="o">$</span><span class="n">VCV</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">betula_m</span><span class="o">$</span><span class="n">Sol</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>From the summary, we can see that the effect size for year is very small: it doesn’t look like the cover of <em>Betula nana</em> has changed much over the 2008-2012 survey period.</p>

<p>The trace plots for this model are a bit better than the previous one and we have included all three levels of our experimental hierarchy as random intercepts. We have ran these models with the default number of iteratations (<code class="language-plaintext highlighter-rouge">13000</code>). Increasing the number of iterations can improve convergence, so that’s something you can explore later if you want (you can increase the iterations by adding <code class="language-plaintext highlighter-rouge">nitt = 100000</code> or a different number of your choice inside the <code class="language-plaintext highlighter-rouge">MCMClgmm()</code> code).</p>

<h4 id="visualise-model-outputs">Visualise model outputs</h4>

<p>We can use the package <code class="language-plaintext highlighter-rouge">MCMCvis</code> by <a href="https://github.com/caseyyoungflesh/MCMCvis" target="_blank" rel="noopener noreferrer">Casey Youngflesh</a> to plot the results of our <em>Betula nana</em> model.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MCMCplot</span><span class="p">(</span><span class="n">betula_m</span><span class="o">$</span><span class="n">Sol</span><span class="p">)</span><span class="w">
</span><span class="n">MCMCplot</span><span class="p">(</span><span class="n">betula_m</span><span class="o">$</span><span class="n">VCV</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Sol</code> refers to the fixed effects and <code class="language-plaintext highlighter-rouge">VCV</code> to the random effects, so we can see the effect sizes of the different variables we have added to our models. If the credible intervals overlap zero, then those effects are not significant, so we can see here that <em>Betula nana</em> cover hasn’t changed. <code class="language-plaintext highlighter-rouge">units</code> refers to the residual variance.</p>

<center> <img src="/img/mcmc_vis1.png" alt="Img" style="width: 400px;">  <img src="/img/mcmc_vis2.png" alt="Img" style="width: 500px;">
</center>

<h4 id="conclusions">Conclusions</h4>

<p>Today we have learned that in order to design a statistical model, we first need to think about our questions, the structure in the data we are working with and the types of assumptions that we want to make. No model will ever be perfect, but we can use hierarchical models to minimize the assumptions that we are making about our data and to better represent the complex data structures that we often have in ecology and other disciplines. Designing a statistical model can at first seem very overwhelming, but it gets easier over time and in the end, can be one of the most fun bits of ecology, believe it or not! And the more tools you build in your statistical toolkit to help you developing appropriate statistical models, the better you will be able to tackle the challenges that ecological data throw your way! Happy modelling!</p>

<h4 id="extras">Extras</h4>

<p>If you are keen, you can now try out the <code class="language-plaintext highlighter-rouge">brms</code> package and generate the Stan code for this model.  This will help us to start to thing about how we can implement hierarchical models using the statistical programming language Stan.</p>

<p><strong>You can check out <a href="https://ourcodingclub.github.io/2018/04/30/stan-2.html" target="_blank" rel="noopener noreferrer">the Stan hierarchical modelling tutorial here!</a></strong></p>

<p></p>

<hr>

<hr>

<p><strong>Check out <a href="https://ourcodingclub.github.io/workshop/" target="_blank" rel="noopener noreferrer">this page</a> to learn how you can get involved! We are very happy to have people use our tutorials and adapt them to their needs. We are also very keen to expand the content on the website, so feel free to get in touch if you’d like to write a tutorial!</strong></p>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a>. <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="Img" style="width: 100px;"></a></p>

<h3><a href="https://www.surveymonkey.co.uk/r/PFJ7S2D" target="_blank" rel="noopener noreferrer">  We would love to hear your feedback, please fill out our survey!</a></h3>

<p><br></p>
<h3>  You can contact us with any questions on <a href="mailto:ourcodingclub@gmail.com?Subject=Tutorial%20question" target="_top">ourcodingclub@gmail.com</a>
</h3>
<p><br></p>
<h3>  Related tutorials:</h3>

<ul>
  
  
</ul>

<p><br></p>
<h3>  Subscribe to our mailing list:</h3>
<div class="container">
	<div class="block">
        <!-- subscribe form start -->
		<div class="form-group">
			<form action="https://getsimpleform.com/messages?form_api_token=de1ba2f2f947822946fb6e835437ec78" method="post">
			<div class="form-group">
				<input type="text" class="form-control" name="Email" placeholder="Email" required="">
			</div>
			<div>
                        	<button class="btn btn-default" type="submit">Subscribe</button>
                    	</div>
                	</form>
		</div>
	</div>
</div>

<ul class="social-icons">
	<li>
		<h3>
			<a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer"> Follow our coding adventures on Twitter! <i class="fa fa-twitter"></i></a>
		</h3>
	</li>
</ul>

    	<footer class="footer">
	<hr>
	<div class="footer-container">
    	<ul class="footer-link-list">
        	<li><a href="/tutorials">Tutorials</a></li>
        	<li><a href="/team">About Us</a></li>
        	<li><a href="/contact">Contact us</a></li>
	    	<li><a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer">Follow us on Twitter</a></li>
    	</ul>
    	<div class="footer-text">
			<p>We are happy for people to use and further develop our tutorials - please give credit to Coding Club by linking to <a href="https://ourcodingclub.github.io/" target="_blank" rel="noopener noreferrer">our website</a>. We are also happy to discuss possible collaborations, so get in touch at <b>ourcodingclub@gmail.com</b></p>
    		<p>See our <a href="/terms">Terms of Use</a> and our <a href="/privacy">Data Privacy policy</a>.</p>
			<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a></p>
			<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img class="license" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="CC-by-sa-4.0"></a>
    	</div>
    </div>
</footer>

<!-- JS -->
<script src="/scripts/owl.carousel.js"></script>
<script src="/scripts/owl.carousel-init.js"></script>
<script src="/scripts/reveal.js"></script>


	
	</body>
</html>
