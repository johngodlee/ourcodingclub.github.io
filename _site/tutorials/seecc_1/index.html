<!DOCTYPE html>
<html lang="en-GB">
	<head>
    	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Working efficiently with large datasets</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- CSS -->
<link rel="stylesheet" href="/css/main.css"/>
<link rel="stylesheet" href="/css/owlcarousel/owl.carousel.css">
<link rel="stylesheet" href="/css/owlcarousel/owl.theme.default.css">

<!-- JS -->
<script src="https://use.fontawesome.com/4dd22df1f8.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/scripts/accordion.js"></script>
<script src="/scripts/jquery.counterup.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.5/waypoints.min.js"></script>
<script src="/scripts/ticker.js"></script>

	</head>
	<body>
    	<header class="header">
	<div class="navigation-bar">
		<div id="navigation-container">
			
				<a class="logo" href="/">
  <img src="/assets/img/logos/logo_stack.svg" alt="Coding Club logo">
</a>

			
			<nav>
				<label for="hamburger">☰</label>
				<input type="checkbox" id="hamburger">
				<ul>
					
						
					<li class="item item-nav">
						<a href="/">Home</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/tutorials.html">Tutorials</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/course.html">Course</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/team.html">Team</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/involve.html">Get involved</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/links.html">Links</a>
					</li>
					
						
					<li class="item item-nav">
						<a href="/contact.html">Contact</a>
					</li>
					
				</ul>
			</nav>
		</div>
	</div>
</header>

			<div class="block">
	<center>
		<img src="/img/tutheaderbigdata.png" alt="Img">
	</center>
</div>

<h3 id="tutorial-aims">Tutorial Aims:</h3>

<h4 id="-1-formatting-and-tidying-data-using-tidyr-"><a href="#tidyr"> 1. Formatting and tidying data using <code class="language-plaintext highlighter-rouge">tidyr</code> </a></h4>

<h4 id="-2-efficiently-manipulating-data-using-dplyr-"><a href="#dplyr"> 2. Efficiently manipulating data using <code class="language-plaintext highlighter-rouge">dplyr</code> </a></h4>

<h4 id="-3-automating-data-manipulation-using-lapply-loops-and-pipes-"><a href="#loops_lapply"> 3. Automating data manipulation using <code class="language-plaintext highlighter-rouge">lapply()</code>, loops and pipes </a></h4>

<h4 id="-4-automating-data-visualisation-using-ggplot2-and-dplyr-"><a href="#datavis"> 4. Automating data visualisation using <code class="language-plaintext highlighter-rouge">ggplot2</code> and <code class="language-plaintext highlighter-rouge">dplyr</code> </a></h4>

<h4 id="-5-species-occurrence-maps-based-on-gbif-and-flickr-data-"><a href="#Flickr"> 5. Species occurrence maps based on GBIF and Flickr data </a></h4>

<h1 id="quantifying-population-change">Quantifying population change</h1>

<p>This workshop will provide an overview of methods used to investigate an ecological research question using a big(ish) dataset that charts the population trends of ~15,000 animal populations from ~3500 species across the world, provided by the <a href="http://www.livingplanetindex.org/home/index" target="_blank" rel="noopener noreferrer">Living Planet Index Database</a>. We will use the LPI dataset to first examine how biodiversity has changed since 1970, both globally and at the biome scale, and then we will zoom in further to create a map of the distribution of the Atlantic puffin based on occurrence data from <a href="http://www.gbif.org/" target="_blank" rel="noopener noreferrer">the Global Biodiversity Information Facility</a> and <a href="http://www.flickr.com/" target="_blank" rel="noopener noreferrer">Flickr</a>. We will be following a generic workflow that is applicable to most scientific endeavours, at least in the life sciences. This workflow can be summed up in this diagram we <a href="http://r4ds.had.co.nz" target="_blank" rel="noopener noreferrer">recreated</a> from Hadley Wickham’s book R for Data Science:</p>

<center><img src="/img/tidyverse.png" alt="Img" style="width: 1100px;"></center>

<p>All the resources for this tutorial, including some helpful cheatsheets can be downloaded from <a href="https://github.com/ourcodingclub/SEECC-workshop" target="_blank" rel="noopener noreferrer">this repository</a> Clone and download the repo as a zipfile, then unzip and set the folder as your working directory by running the code below (subbing in the actual folder path), or clicking <code class="language-plaintext highlighter-rouge">Session/ Set Working Directory/ Choose Directory</code> from the RStudio menu.</p>

<p>Alternatively, you can fork <a href="https://github.com/ourcodingclub/SEECC-workshop" target="_blank" rel="noopener noreferrer">the repository</a> to your own Github account and then add it as a new RStudio project by copying the HTTPS/SSH link. For more details on how to register on Github, download Git, sync RStudio and Github and use version control, please check out our previous <a href="https://ourcodingclub.github.io/2017/02/27/git.html" target="_blank" rel="noopener noreferrer">tutorial.</a></p>

<p>Make a new script file using <code class="language-plaintext highlighter-rouge">File/ New File/ R Script</code> and we are all set to begin exploring how vertebrate populations are changing.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setwd</span><span class="p">(</span><span class="s2">"PATH_TO_FOLDER"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Next, install (<code class="language-plaintext highlighter-rouge">install.packages("")</code>) and load (<code class="language-plaintext highlighter-rouge">library()</code>) the packages needed for this tutorial.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"readr"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"tidyr"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"broom"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"ggExtra"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"maps"</span><span class="p">)</span><span class="w">
</span><span class="n">install.packages</span><span class="p">(</span><span class="s2">"RColorBrewer"</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">readr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggExtra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">RColorBrewer</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Finally, load the <code class="language-plaintext highlighter-rouge">.RData</code> files we will be using for the tutorial. The data we originally downloaded from the LPI website were in a <code class="language-plaintext highlighter-rouge">.csv</code> format, but when handling large datasets, <code class="language-plaintext highlighter-rouge">.RData</code> files are quicker to use, since they are more compressed. Of course, a drawback would be that <code class="language-plaintext highlighter-rouge">.RData</code> files can only be used within R, whereas <code class="language-plaintext highlighter-rouge">.csv</code> files are more transferable.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">load</span><span class="p">(</span><span class="s2">"LPIdata_Feb2016.RData"</span><span class="p">)</span><span class="w">
</span><span class="n">load</span><span class="p">(</span><span class="s2">"puffin_GBIF.RData"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><a name="tidyr"></a></p>

<h2 id="1-formatting-and-tidying-data-using-tidyr">1. Formatting and tidying data using <code class="language-plaintext highlighter-rouge">tidyr</code>
</h2>

<h3 id="reshaping-data-frames-using-gather">Reshaping data frames using <code class="language-plaintext highlighter-rouge">gather()</code>
</h3>

<p>The way you record information in the field or in the lab is probably very different to the way you want your data entered into R. In the field, you want tables that you can ideally draw up ahead and fill in as you go, and you will be adding notes and all sorts of information in addition to the data you want to analyse. For instance, if you monitor the height of seedlings during a factorial experiment using warming and fertilisation treatments, you might record your data like this:</p>

<center> <img src="/img/SAB_fig1.png" alt="Img" style="width: 500px;"> </center>

<p>Let’s say you want to run a test to determine whether warming and/or fertilisation affected seedling growth. You may know how your experiment is set up, but R doesn’t! At the moment, with 8 measures per row (combination of all treatments and species for one replicate, or block), you cannot run an analysis. On the contrary,
<a href="https://www.jstatsoft.org/article/view/v059i10" target="_blank" rel="noopener noreferrer">tidy datasets</a> are arranged so that each <strong>row</strong> represents an <strong>observation</strong> and each <strong>column</strong> represents a <strong>variable</strong>. In our case, this would look something like this:</p>

<center> <img src="/img/SAB_fig2.png" alt="Img" style="width: 400px;"> </center>

<p>This makes a much longer dataframe row-wise, which is why this form is often called <em>long format</em>. Now if you wanted to compare between groups, treatments, species, etc, R would be able to split the dataframe correctly, as each grouping factor has its own column.</p>

<p>The <code class="language-plaintext highlighter-rouge">gather()</code> function from the <code class="language-plaintext highlighter-rouge">tidyr</code> package lets you convert a wide-format data frame to a tidy long-format data frame.</p>

<p>Have a look at the first few columns of the LPI data set (<code class="language-plaintext highlighter-rouge">LPIdata_Feb2016</code>) to see whether it is tidy:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">View</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">LPIdata_Feb2016</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>At the moment, each row contains a population that has been monitored over time and towards the right of the data frame there are lots of columns with population estimates for each year. To make this data “tidy” (one column per variable) we can use <code class="language-plaintext highlighter-rouge">gather()</code> to transform the data so there is a new column containing all the years for each population and an adjacent column containing all the population estimates for those years:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LPIdata_Feb2016</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pop"</span><span class="p">,</span><span class="w"> </span><span class="n">select</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">26</span><span class="o">:</span><span class="m">70</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>This takes our original dataset <code class="language-plaintext highlighter-rouge">LPIdata_Feb2016</code> and creates a new column called <code class="language-plaintext highlighter-rouge">year</code>, fills it with column names from columns <code class="language-plaintext highlighter-rouge">26:70</code> and then uses the data from these columns to make another column called <code class="language-plaintext highlighter-rouge">pop</code>.</p>

<p>Because column names are coded in as characters, when we turned the column names (<code class="language-plaintext highlighter-rouge">1970</code>, <code class="language-plaintext highlighter-rouge">1971</code>, <code class="language-plaintext highlighter-rouge">1972</code>, etc.) into rows, R automatically put an <code class="language-plaintext highlighter-rouge">X</code> in front of the numbers to force them to remain characters. We don’t want that, so to turn <code class="language-plaintext highlighter-rouge">year</code> into a numeric variable, use:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long</span><span class="o">$</span><span class="n">year</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">LPI_long</span><span class="o">$</span><span class="n">year</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<h3 id="using-sensible-variable-names">Using sensible variable names</h3>

<p>Have a look at the column names in <code class="language-plaintext highlighter-rouge">LPI_long</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The variable names are a mixture of upper and lower case letters and some use <code class="language-plaintext highlighter-rouge">.</code> to mark the end of a word. There are lots of conventions for <a href="https://journal.r-project.org/archive/2012-2/RJournal_2012-2_Baaaath.pdf" target="_blank" rel="noopener noreferrer">naming objects and variables in programming</a> but for the sake of consistency and making things easier to read, let’s replace any <code class="language-plaintext highlighter-rouge">.</code> with <code class="language-plaintext highlighter-rouge">_</code> using <code class="language-plaintext highlighter-rouge">gsub()</code>and make everything lower case using <code class="language-plaintext highlighter-rouge">tolower()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span><span class="w"> </span><span class="s2">"_"</span><span class="p">,</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">),</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tolower</span><span class="p">(</span><span class="nf">names</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Each population in the dataset can be identified using the <code class="language-plaintext highlighter-rouge">id</code> column, but to group our dataset by species, we would have to group first by <code class="language-plaintext highlighter-rouge">genus</code>, then by <code class="language-plaintext highlighter-rouge">species</code>, to prevent problems with species having similar names. To circumvent this, we can make a new column which holds the genus and species together using <code class="language-plaintext highlighter-rouge">paste()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long</span><span class="o">$</span><span class="n">genus_species_id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">LPI_long</span><span class="o">$</span><span class="n">genus</span><span class="p">,</span><span class="w"> </span><span class="n">LPI_long</span><span class="o">$</span><span class="n">species</span><span class="p">,</span><span class="w"> </span><span class="n">LPI_long</span><span class="o">$</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"_"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Finally, lets look at a sample of the contents of the data frame to make sure all the variables are displayed properly:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">View</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span><span class="m">500</span><span class="o">:</span><span class="m">505</span><span class="p">,</span><span class="m">1000</span><span class="o">:</span><span class="m">1005</span><span class="p">),])</span><span class="w">
</span><span class="c1"># You can use [] to subset data frames [rows, columns]</span><span class="w">
</span><span class="c1"># If you want all rows/columns, add a comma in the row/column location</span><span class="w">
</span></code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">country_list</code> and <code class="language-plaintext highlighter-rouge">biome</code> seem to have <code class="language-plaintext highlighter-rouge">,</code> and <code class="language-plaintext highlighter-rouge">/</code> to separate entries. This could mess up our analyses, so we can remove them using <code class="language-plaintext highlighter-rouge">gsub()</code> as before:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long</span><span class="o">$</span><span class="n">country_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">LPI_long</span><span class="o">$</span><span class="n">country_list</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">LPI_long</span><span class="o">$</span><span class="n">biome</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">LPI_long</span><span class="o">$</span><span class="n">biome</span><span class="p">,</span><span class="w"> </span><span class="n">fixed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><a name="dplyr"></a></p>

<h2 id="2-efficiently-manipulating-data-using-dplyr">2. Efficiently manipulating data using <code class="language-plaintext highlighter-rouge">dplyr</code>
</h2>

<p>Now that our dataset is <em>tidy</em> we can get it ready for our analysis. This data frame contains data from lots of different sources so to help answer our question of how populations have changed since 1970, we should create some new variables and filter out the unnecessary data.</p>

<p>To make sure there are no duplicate rows, we can use <code class="language-plaintext highlighter-rouge">distinct()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then we can remove any rows that have missing or infinite data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long_fl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">,</span><span class="w"> </span><span class="nf">is.finite</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Next, we want to only use populations that have more than 5 years of data to make sure our analysis has enough data to capture population change. We should also scale the population data, because since the data come from many species, the units and magnitude of the data are very different - imagine tiny fish whose abundance is in the millions, and large carnivores whose abundance is much smaller. Scaling also normalises the data, as later on we will be using linear models assuming a normal distribution. To only keep populations with more than 5 years of data and scale the population data, we can use pipes.</p>

<p><strong>Pipes (<code class="language-plaintext highlighter-rouge">%&gt;%</code>) are a way of streamlining data manipulation - imagine all of your data coming in one end of the pipe, while they are in there, they are manipulated, summarised, etc., then the output (e.g. your new data frame or summary statistics) comes out the other end of the pipe. At each step of the pipe processing, you can tell the pipe what information to use - e.g. here we are using <code class="language-plaintext highlighter-rouge">.</code>, which just means “take the ouput of the previous step”. For more information on data manipulation using pipes, you can check out our <a href="https://ourcodingclub.github.io/2017/01/16/piping.html" target="_blank" rel="noopener noreferrer">data formatting and manipulation tutorial</a>.</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPI_long_fl</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">genus_species_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># group rows so that each group is one population</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">maxyear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="w"> </span><span class="n">minyear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="w">  </span><span class="c1"># Create columns for the first and most recent years that data was collected</span><span class="w">
         </span><span class="n">lengthyear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">maxyear</span><span class="o">-</span><span class="n">minyear</span><span class="p">,</span><span class="w">  </span><span class="c1"># Create a column for the length of time data available</span><span class="w">
         </span><span class="n">scalepop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pop</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">pop</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">-</span><span class="nf">min</span><span class="p">(</span><span class="n">pop</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Scale population trend data so that all values are between 0 and 1</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="nf">is.finite</span><span class="p">(</span><span class="n">scalepop</span><span class="p">),</span><span class="w">  </span><span class="c1"># remove NAs</span><span class="w">
         </span><span class="n">lengthyear</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Only keep rows with more than 5 years of data</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w">  </span><span class="c1"># Remove any groupings you've greated in the pipe</span><span class="w">
</span></code></pre></div></div>

<p>Now we can explore our data a bit. Let’s create a few basic summary statistics for each biome and store them in a new data frame:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_biome_summ</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPI_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">biome</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Group by biome</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">populations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w">   </span><span class="c1"># Create columns, number of populations</span><span class="w">
            </span><span class="n">mean_study_length_years</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">lengthyear</span><span class="p">),</span><span class="w">  </span><span class="c1"># mean study length</span><span class="w">
            </span><span class="n">max_lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">decimal_latitude</span><span class="p">),</span><span class="w">  </span><span class="c1"># max latitude</span><span class="w">
            </span><span class="n">min_lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">decimal_latitude</span><span class="p">),</span><span class="w">  </span><span class="c1"># max longitude</span><span class="w">
            </span><span class="n">dominant_sampling_method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">which.max</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">sampling_method</span><span class="p">))),</span><span class="w">  </span><span class="c1"># modal sampling method</span><span class="w">
            </span><span class="n">dominant_units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">which.max</span><span class="p">(</span><span class="n">table</span><span class="p">(</span><span class="n">units</span><span class="p">))))</span><span class="w">  </span><span class="c1"># modal unit type</span><span class="w">
</span></code></pre></div></div>

<p>Check out the new data frame using <code class="language-plaintext highlighter-rouge">View(LPI_biome_summ)</code> to find out how many populations each biome has, as well as other summary information.</p>

<p><a name="lapply_loops"></a></p>

<h2 id="3-automating-data-manipulation-using-lapply-loops-and-pipes">3. Automating data manipulation using <code class="language-plaintext highlighter-rouge">lapply()</code>, loops and pipes</h2>

<p>Often we want to perform the same type of analysis on multiple species, plots, or any other groups within our data - copying and pasting is inefficient and can easily lead to mistakes, so it’s much better to automate the process within R and avoid all the repetition. There are several ways to do this, including using <code class="language-plaintext highlighter-rouge">apply()</code> and it’s variants, loops, and pipes. For more information, you can check out our tutorials on <a href="https://ourcodingclub.github.io/2017/02/08/funandloops.html" target="_blank" rel="noopener noreferrer">loops</a> and <a href="https://ourcodingclub.github.io/2017/01/16/piping.html" target="_blank" rel="noopener noreferrer">piping</a>, but for now, here is a brief summary.</p>

<p>The <code class="language-plaintext highlighter-rouge">apply()</code> function and it’s variants (<code class="language-plaintext highlighter-rouge">lapply()</code>,<code class="language-plaintext highlighter-rouge">sapply()</code>, <code class="language-plaintext highlighter-rouge">tapply()</code>, <code class="language-plaintext highlighter-rouge">mapply()</code>) act as wrappers around other functions that you want to apply equally to items in an array (<code class="language-plaintext highlighter-rouge">apply()</code>), list (<code class="language-plaintext highlighter-rouge">lapply()</code>, <code class="language-plaintext highlighter-rouge">sapply()</code>), grouped vector (<code class="language-plaintext highlighter-rouge">tapply()</code>), or some other multivariate function (<code class="language-plaintext highlighter-rouge">mapply()</code>).</p>

<p>Loops are used for iterative purposes - through loops you are telling R to do something (calculate a mean, make a graph, anything) for each element of a certain list (could be a list of years, species, countries, any category within your data). Loops are the slowest of these three methods to do data manipulation, because loops call the same function multiple times, once for each iteration, and function calls in R are a bottleneck.</p>

<p>Pipes (<code class="language-plaintext highlighter-rouge">%&gt;%</code>), as you found out above, are a way of streamlining the data manipulation process. Within the pipe you can group by categories of your choice, so for example we can calculate the LPI for different biomes or countries, and then save the plots.</p>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-f8uf{font-size:100%;font-family:Arial, Helvetica, sans-serif !important;;vertical-align:top}
.tg .tg-yw4l{vertical-align:top}
</style>

<table class="tg">
  <tr>
    <th class="tg-yw4l">Method</th>
    <th class="tg-yw4l">Pros</th>
    <th class="tg-yw4l">Cons</th>
  </tr>
  <tr>
    <td class="tg-yw4l">lapply()</td>
    <td class="tg-yw4l">Quicker than loops, slightly quicker than pipes</td>
    <td class="tg-f8uf">More lines of code than pipes</td>
  </tr>
  <tr>
    <td class="tg-yw4l">loop</td>
    <td class="tg-yw4l">Easy to understand and follow, used in other programming languages as well</td>
    <td class="tg-yw4l">Slow, memory-intense and code-heavy</td>
  </tr>
  <tr>
    <td class="tg-yw4l">pipe</td>
    <td class="tg-yw4l">Quicker than loops, efficient coding with fewer lines</td>
    <td class="tg-yw4l">The code can take a bit of fiddling around till it's right</td>
  </tr>
</table>

<p>Using our data set, we want to create linear models which demonstrate the abundance trend over time, for each of our populations, then extract model coefficients and other useful stuff to a data frame.</p>

<p>You can do this using <code class="language-plaintext highlighter-rouge">lapply()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a list of data frames by splitting `LPI_long` by population (`genus_species_id`)</span><span class="w">
</span><span class="n">LPI_long_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">split</span><span class="p">(</span><span class="n">LPI_long</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LPI_long</span><span class="o">$</span><span class="n">genus_species_id</span><span class="p">)</span><span class="w">  </span><span class="c1"># This takes a couple minutes to run</span><span class="w">

</span><span class="c1"># `lapply()` a linear model (`lm`) to each data frame in the list and store as a list of linear models</span><span class="w">
</span><span class="n">LPI_list_lm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_long_list</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">scalepop</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">))</span><span class="w">

</span><span class="c1"># Extract model coefficients and store them in a data frame</span><span class="w">
</span><span class="n">LPI_models_lapply</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="w">
  </span><span class="s2">"genus_species_id"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">),</span><span class="w">
  </span><span class="s2">"n"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">df.residual</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span><span class="w">
  </span><span class="s2">"intercept"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">1</span><span class="p">])),</span><span class="w">
  </span><span class="s2">"slope"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">2</span><span class="p">])),</span><span class="w">
  </span><span class="s2">"intercept_se"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">3</span><span class="p">])),</span><span class="w">
  </span><span class="s2">"slope_se"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">4</span><span class="p">])),</span><span class="w">
  </span><span class="s2">"intercept_p"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">7</span><span class="p">])),</span><span class="w">
  </span><span class="s2">"slope_p"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_list_lm</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">8</span><span class="p">])),</span><span class="w">
  </span><span class="s2">"lengthyear"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unlist</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">LPI_long_list</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">max</span><span class="p">((</span><span class="n">x</span><span class="p">)</span><span class="o">$</span><span class="n">lengthyear</span><span class="p">)))</span><span class="w">
</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>For the sake of completeness, here’s how to do the same using a loop - <strong>the code can take hours to run depending on your laptop!</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create a data frame to store results</span><span class="w">
</span><span class="n">LPI_models_loop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">()</span><span class="w">

</span><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">LPI_long</span><span class="o">$</span><span class="n">genus_species_id</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">frm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.formula</span><span class="p">(</span><span class="n">paste</span><span class="p">(</span><span class="s2">"scalepop ~ year"</span><span class="p">))</span><span class="w">
  </span><span class="n">mylm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frm</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LPI_long</span><span class="p">[</span><span class="n">LPI_long</span><span class="o">$</span><span class="n">genus_species_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">,])</span><span class="w">
  </span><span class="n">sum</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># Extract model coefficients</span><span class="w">
  </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">df.residual</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="w">
  </span><span class="n">intercept</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w">
  </span><span class="n">slope</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="w">
  </span><span class="n">intercept_se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="w">
  </span><span class="n">slope_se</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">4</span><span class="p">]</span><span class="w">
  </span><span class="n">intercept_p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">7</span><span class="p">]</span><span class="w">
  </span><span class="n">slope_p</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mylm</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">8</span><span class="p">]</span><span class="w">
  
  </span><span class="c1"># Create temporary data frame</span><span class="w">
  </span><span class="n">df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">genus_species_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intercept</span><span class="p">,</span><span class="w"> 
                   </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slope</span><span class="p">,</span><span class="w"> </span><span class="n">intercept_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intercept_se</span><span class="p">,</span><span class="w"> </span><span class="n">slope_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slope_se</span><span class="p">,</span><span class="w">
                   </span><span class="n">intercept_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intercept_p</span><span class="p">,</span><span class="w"> </span><span class="n">slope_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slope_p</span><span class="p">,</span><span class="w"> 
                   </span><span class="n">lengthyear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LPI_long</span><span class="p">[</span><span class="n">LPI_long</span><span class="o">$</span><span class="n">genus_species_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">,]</span><span class="o">$</span><span class="n">lengthyear</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># Bind rows of temporary data frame to the LPI_mylmels_loop data frame</span><span class="w">
  </span><span class="n">LPI_models_loop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rbind</span><span class="p">(</span><span class="n">LPI_models_loop</span><span class="p">,</span><span class="w"> </span><span class="n">df</span><span class="p">)</span><span class="w">
  
</span><span class="p">}</span><span class="w">

</span><span class="c1"># Remove duplicate rows and rows where degrees of freedom &lt;5</span><span class="w">
</span><span class="n">LPI_models_loop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">distinct</span><span class="p">(</span><span class="n">LPI_models_loop</span><span class="p">)</span><span class="w">
</span><span class="n">LPI_models_loop</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">LPI_models_loop</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Using pipes (this takes a few minutes to run):</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">LPI_models_pipes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPI_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">genus_species_id</span><span class="p">,</span><span class="w"> </span><span class="n">lengthyear</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">do</span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">scalepop</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Create a linear model for each group</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df.residual</span><span class="p">(</span><span class="n">mod</span><span class="p">),</span><span class="w">  </span><span class="c1"># Create columns: degrees of freedom</span><span class="w">
         </span><span class="n">intercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w">  </span><span class="c1"># intercept coefficient</span><span class="w">
         </span><span class="n">slope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w">  </span><span class="c1"># slope coefficient</span><span class="w">
         </span><span class="n">intercept_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">3</span><span class="p">],</span><span class="w">  </span><span class="c1"># standard error of intercept</span><span class="w">
         </span><span class="n">slope_se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="w">  </span><span class="c1"># standard error of slope</span><span class="w">
         </span><span class="n">intercept_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">7</span><span class="p">],</span><span class="w">  </span><span class="c1"># p value of intercept</span><span class="w">
         </span><span class="n">slope_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">8</span><span class="p">])</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># p value of slope</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">lengthyear</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lengthyear</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># adding back the duration column, otherwise it won't be saved in the object</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="c1"># Remove rows where degrees of freedom &lt;5</span><span class="w">
</span></code></pre></div></div>

<p>We used the <code class="language-plaintext highlighter-rouge">system.time()</code> function to time how long each of these methods took on a 16GB 2.8GHz-i5 Macbook Pro so you can easily compare:</p>

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;}
.tg .tg-yw4l{vertical-align:top}
</style>

<table class="tg">
  <tr>
    <th class="tg-yw4l">Method</th>
    <th class="tg-yw4l">Total Elapsed Time (s)</th>
    <th class="tg-yw4l">User Space Time (s)</th>
    <th class="tg-yw4l">System Space Time (s)</th>
  </tr>
  <tr>
    <td class="tg-yw4l">loop</td>
    <td class="tg-yw4l">180.453</td>
    <td class="tg-yw4l">170.88</td>
    <td class="tg-yw4l">7.514</td>
  </tr>
  <tr>
    <td class="tg-yw4l">pipe</td>
    <td class="tg-yw4l">30.941</td>
    <td class="tg-yw4l">30.456</td>
    <td class="tg-yw4l">0.333</td>
  </tr>
  <tr>
    <td class="tg-yw4l">lapply</td>
    <td class="tg-yw4l">26.665</td>
    <td class="tg-yw4l">26.172</td>
    <td class="tg-yw4l">0.261</td>
  </tr>
</table>

<p>You can do the same by wrapping any of the methods in <code class="language-plaintext highlighter-rouge">system.time()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">system.time</span><span class="p">(</span><span class="w">
	</span><span class="n">LPI_models_pipes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPI_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">genus_species_id</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">do</span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">scalepop</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df.residual</span><span class="p">(</span><span class="n">mod</span><span class="p">),</span><span class="w">
         </span><span class="n">intercept</span><span class="o">=</span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">1</span><span class="p">],</span><span class="w">
         </span><span class="n">slope</span><span class="o">=</span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">2</span><span class="p">],</span><span class="w">
         </span><span class="n">intercept_se</span><span class="o">=</span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">3</span><span class="p">],</span><span class="w">
         </span><span class="n">slope_se</span><span class="o">=</span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">4</span><span class="p">],</span><span class="w">
         </span><span class="n">intercept_p</span><span class="o">=</span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">7</span><span class="p">],</span><span class="w">
         </span><span class="n">slope_p</span><span class="o">=</span><span class="n">summary</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="o">$</span><span class="n">coeff</span><span class="p">[</span><span class="m">8</span><span class="p">])</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
	</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>Note that you might receive <code class="language-plaintext highlighter-rouge">essentially perfect fit: summary may be unreliable</code> warning messages. This tells us that there isn’t any variance in the sample used for certain models, and this is because there are not enough sample points. This is fixed with <code class="language-plaintext highlighter-rouge">filter(n &gt; 5)</code> which removes models that have fewer than 5 degrees of freedom.</p>

<p>These three approaches deliver the same results, and you can choose which one is best for you and your analyses based on your preferences and coding habits.</p>

<p>Now that we have added all this extra information to the data frame, let’s save it just in case R crashes or your laptop runs out of battery:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">save</span><span class="p">(</span><span class="n">LPI_models_pipes</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"LPI_models_pipes.RData"</span><span class="p">)</span><span class="w">

</span><span class="n">LPI_models_pipes_mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPI_models_pipes</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">mod</span><span class="p">)</span><span class="w">  </span><span class="c1"># Remove `mod`, which is a column of lists (... META!)</span><span class="w">
</span><span class="n">write.csv</span><span class="p">(</span><span class="n">LPI_models_pipes_mod</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="o">=</span><span class="s2">"LPI_models_pipes.csv"</span><span class="p">,</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="c1"># This takes a long time to save, don't run it unless you have time to wait.</span><span class="w">
</span></code></pre></div></div>

<p>Compare the <code class="language-plaintext highlighter-rouge">.RData</code> file with an equivalent <code class="language-plaintext highlighter-rouge">.csv</code> file. <code class="language-plaintext highlighter-rouge">.RData</code> files are much more compressed than <code class="language-plaintext highlighter-rouge">.csv</code> files, and load into R much more quickly. For the <code class="language-plaintext highlighter-rouge">.csv</code> here, we removed one column, so the final result might not be that different in terms of file size, but in general <code class="language-plaintext highlighter-rouge">.RData</code> files are smaller. They are also guaranteed to be in the right format, unlike a <code class="language-plaintext highlighter-rouge">.csv</code>, which can have problems with quotes (<code class="language-plaintext highlighter-rouge">""</code>), commas (<code class="language-plaintext highlighter-rouge">,</code>) and unfinished lines. One drawback however is that they can’t be used with software other than <code class="language-plaintext highlighter-rouge">R</code>.</p>

<p><a name="datavis"></a></p>

<h2 id="4-automating-data-visualisation-using-ggplot2-and-dplyr">4. Automating data visualisation using <code class="language-plaintext highlighter-rouge">ggplot2</code> and <code class="language-plaintext highlighter-rouge">dplyr</code>
</h2>
<p>Now that we have quantified how the different populations in the LPI dataset have changed through time, it’d be great to visualise the results. First, we can explore how populations are changing in different biomes through histograms of slope estimates. We could filter the data for each biome, make a new data frame, make the histogram, save it, and repeat all of this many times, or we could get it done all in one go using <code class="language-plaintext highlighter-rouge">ggplot2</code> and pipes <code class="language-plaintext highlighter-rouge">%&gt;%</code>. Here we’ll save the plots as <code class="language-plaintext highlighter-rouge">.pdf</code> files, but you could use <code class="language-plaintext highlighter-rouge">.png</code> as well. We will also set a custom theme for <code class="language-plaintext highlighter-rouge">ggplot2</code> to use when making the histograms and choose a colour for the bins using <code class="language-plaintext highlighter-rouge">Rcolourpicker</code>.</p>

<h3 id="making-your-own-ggplot2-theme">Making your own <code class="language-plaintext highlighter-rouge">ggplot2</code> theme</h3>
<p>If you’ve ever tried to perfect your <code class="language-plaintext highlighter-rouge">ggplot2</code> graphs, you might have noticed that the lines starting with <code class="language-plaintext highlighter-rouge">theme()</code> quickly pile up - you adjust the font size of the axes and the labels, the position of the title, the background colour of the plot, you remove the grid lines in the background, etc. And then you have to do the same for the next plot, which really increases the amount of code you use. Here is a simple solution - create a customised theme that combines all the <code class="language-plaintext highlighter-rouge">theme()</code> elements you want, and apply it to your graphs to make things easier and increase consistency. You can include as many elements in your theme as you want, as long as they don’t contradict one another, and then when you apply your theme to a graph, only the relevant elements will be considered - e.g. for our histograms we won’t need to use <code class="language-plaintext highlighter-rouge">legend.position</code>, but it’s fine to keep it in the theme, in case any future graphs we apply it to do have the need for legends.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">theme_LPI</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(){</span><span class="w">
  </span><span class="n">theme_bw</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">45</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">),</span><span class="w">
        </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"plain"</span><span class="p">),</span><span class="w">
        </span><span class="n">panel.grid.major.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.minor.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.minor.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">panel.grid.major.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">plot.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w"> </span><span class="n">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
        </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">hjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.5</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"italic"</span><span class="p">),</span><span class="w">
        </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">))</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="picking-colours-using-the-rcolourpicker-addin">Picking colours using the <code class="language-plaintext highlighter-rouge">Rcolourpicker</code> addin</h3>
<p>Setting custom colours for your graphs can set them apart from all the rest (we all know what the default <code class="language-plaintext highlighter-rouge">ggplot2</code> colours look like!), make them prettier, and most importantly, give your work a consistent and logical colour scheme. Finding the codes, e.g. <code class="language-plaintext highlighter-rouge">colour = "#8B5A00"</code>, for your chosen colours, however, can be a bit tedious. Though one can always use Paint / Photoshop / google colour codes, there is a way to do this within RStudio thanks to the addin <code class="language-plaintext highlighter-rouge">colourpicker</code>. RStudio addins are installed the same way as packages, and you can access them by clicking on <code class="language-plaintext highlighter-rouge">Addins</code> in your RStudio menu. To install <code class="language-plaintext highlighter-rouge">colourpicker</code>, run the following code:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"colourpicker"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>To find out what is the code for a colour you like, click on <code class="language-plaintext highlighter-rouge">Addins/Colour picker</code>.</p>

<center><img src="/img/colourpicker.png" alt="Img" style="width: 800px;"></center>

<p>When you click on <code class="language-plaintext highlighter-rouge">All R colours</code> you will see lots of different colours you can choose from - a good colour scheme makes your graph stand out, but of course, don’t go crazy with the colours. When you click on <code class="language-plaintext highlighter-rouge">1</code>, and then on a certain colour, you fill up <code class="language-plaintext highlighter-rouge">1</code> with that colour, same goes for <code class="language-plaintext highlighter-rouge">2</code>, <code class="language-plaintext highlighter-rouge">3</code> - you can add mode colours with the <code class="language-plaintext highlighter-rouge">+</code>, or delete them by clicking the bin. Once you’ve made your pick, click <code class="language-plaintext highlighter-rouge">Done</code>. You will see a line of code <code class="language-plaintext highlighter-rouge">c("#8B5A00", "#CD8500")</code> appear - in this case, we just need the colour code, so we can copy that, and delete the rest.</p>

<center><img src="/img/colourpicker2.png" alt="Img" style="width: 800px;"></center>

<h3 id="plotting-histograms-of-population-change-in-different-biomes-and-saving-them">Plotting histograms of population change in different biomes and saving them</h3>

<p>__We can take our pipe efficiency a step further using the <code class="language-plaintext highlighter-rouge">broom</code> package. In the three examples above, we extracted the slope, standard error, intercept, etc., line by line, but with <code class="language-plaintext highlighter-rouge">broom</code> we can extract model coefficients using one single line <code class="language-plaintext highlighter-rouge">tidy(model_name)</code>. We can practice using <code class="language-plaintext highlighter-rouge">broom</code> whilst making the histograms of population change in different biomes (measured by the slope for the <code class="language-plaintext highlighter-rouge">year</code> term).</p>

<h4 id="you-will-need-to-create-a-biome_lpi-folder-where-your-plots-will-be-saved-before-you-run-the-code__">You will need to create a <code class="language-plaintext highlighter-rouge">Biome_LPI</code> folder, where your plots will be saved, before you run the code.__</h4>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">biome.plots</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">LPI_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">genus_species_id</span><span class="p">,</span><span class="w"> </span><span class="n">biome</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">do</span><span class="p">(</span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">scalepop</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">tidy</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">genus_species_id</span><span class="p">,</span><span class="w"> </span><span class="n">biome</span><span class="p">,</span><span class="w"> </span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Selecting only the columns we need</span><span class="w">
  </span><span class="n">spread</span><span class="p">(</span><span class="n">term</span><span class="p">,</span><span class="w"> </span><span class="n">estimate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># Splitting the estimate values in two columns - one for intercept, one for year</span><span class="w">
  </span><span class="n">ungroup</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># We need to get out of our previous grouping to make a new one</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">biome</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">do</span><span class="p">(</span><span class="n">ggsave</span><span class="p">(</span><span class="n">ggplot</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">year</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_histogram</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="s2">"#8B5A00"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"#CD8500"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_LPI</span><span class="p">()</span><span class="w"> 
            </span><span class="o">+</span><span class="w"> </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Rate of population change (slopes)"</span><span class="p">),</span><span class="w"> 
            </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"Biome_LPI/"</span><span class="p">,</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">.</span><span class="o">$</span><span class="n">biome</span><span class="p">)),</span><span class="w"> </span><span class="s2">".pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)),</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"pdf"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>The histograms will be saved in your working directory. You can use <code class="language-plaintext highlighter-rouge">getwd()</code> to find out where that is, if you’ve forgotten. Check out the histograms - how does population change vary between the different biomes?</p>

<center>
<img src="/img/hist_tundra.png" alt="Img" style="width: 400px;"> <img src="/img/hist_polar_seas.png" alt="Img" style="width: 400px;">
</center>

<h3 id="ploting-slope-estimates-for-population-change-versus-duration-of-monitoring-and-adding-histograms-along-the-margins">Ploting slope estimates for population change versus duration of monitoring and adding histograms along the margins</h3>
<p>Within RStudio, you can use addins, including <code class="language-plaintext highlighter-rouge">Rcolourpicker</code> that we discussed above, and <code class="language-plaintext highlighter-rouge">ggExtra</code> that we will use for our marginal histograms.</p>

<p>Making our initial graph:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">all_slopes</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">LPI_models_pipes</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lengthyear</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slope</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_pointrange</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">slope_se</span><span class="p">,</span><span class="w"> </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">slope</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">slope_se</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_LPI</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Population change\n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># \n adds a blank line</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"\nDuration (years)"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Note that putting your entire ggplot code in brackets () creates the graph and then shows it in the plot viewer. If you don’t have the brackets, you’ve only created the object, but haven’t visualized it. You would then have to call the object such that it will be displayed by just typing <code class="language-plaintext highlighter-rouge">all_slopes</code> after you’ve created the “all_slopes” object.</p>

<p>Once you’ve installed the package by running <code class="language-plaintext highlighter-rouge">install.packages("ggExtra")</code>, you can select the <code class="language-plaintext highlighter-rouge">ggplot2</code> code, click on <code class="language-plaintext highlighter-rouge">ggplot2 Marginal Histograms</code> from the Addin menu and build your plot. Once you click <code class="language-plaintext highlighter-rouge">Done</code>, the code will be automatically added to your script.</p>

<center><img src="/img/ggextra1.png" alt="Img" style="width: 800px;"></center>

<center><img src="/img/ggextra2.png" alt="Img" style="width: 800px;"></center>

<p>Here is the final graph - what do you think, how has biodiversity changed in the last ~40 years?</p>
<center><img src="/img/popchangehist.png" alt="Img" style="width: 800px;"></center>

<h2 id="visualising-species-occurrence">Visualising species occurrence</h2>

<p>As an intro to the next section of the workshop, we’re going to have a look at the distribution of the Atlantic Puffin, using public data from the <a href="http://www.gbif.org" target="_blank" rel="noopener noreferrer">Global Biodiversity Information Facility</a>, found in <code class="language-plaintext highlighter-rouge">puffin_GBIF.RData</code>.</p>

<p>Firstly, use <code class="language-plaintext highlighter-rouge">borders()</code> to pull some world map data from the <code class="language-plaintext highlighter-rouge">maps</code> package:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">map_world</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">borders</span><span class="p">(</span><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"world"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray50"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#383838"</span><span class="p">)</span><span class="w">  </span><span class="c1"># We used the `Colour Picker` Addin to pick the colours</span><span class="w">
</span></code></pre></div></div>

<p>Then create the plot using <code class="language-plaintext highlighter-rouge">ggplot()</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">map_world_puffin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">map_world</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Plot the map</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">puffin_GBIF</span><span class="p">,</span><span class="w">  </span><span class="c1"># Specify the data for geom_point()</span><span class="w">
             </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallongitude</span><span class="p">,</span><span class="w">  </span><span class="c1"># Specify the x axis as longitude</span><span class="w">
                 </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimallatitude</span><span class="p">,</span><span class="w">  </span><span class="c1"># Specify the y axis as latitude</span><span class="w">
                 </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scientificname</span><span class="p">),</span><span class="w">  </span><span class="c1"># Colour the points based on species name</span><span class="w">
             </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w">  </span><span class="c1"># Set point opacity to 40%</span><span class="w">
             </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Set point size to 1</span><span class="w">
  </span><span class="n">scale_color_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Set1"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">   </span><span class="c1"># Specify the colour palette to colour the points</span><span class="w">
  </span><span class="n">theme_classic</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Remove gridlines and shading inside the plot</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s2">"Latitude ("</span><span class="o">*</span><span class="n">degree</span><span class="o">*</span><span class="s2">")"</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Add a smarter x axis label</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s2">"Longitude ("</span><span class="o">*</span><span class="n">degree</span><span class="o">*</span><span class="s2">")"</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># Add a smarter y axis label</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottom"</span><span class="p">,</span><span class="w">  </span><span class="c1"># Move the legend to below the plot</span><span class="w">
        </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()))</span><span class="w">  </span><span class="c1"># Remove the legend title</span><span class="w">
</span></code></pre></div></div>

<p>We used a colour palette from <code class="language-plaintext highlighter-rouge">RColorBrewer</code> to colour the points (<code class="language-plaintext highlighter-rouge">Set1</code>). You can see all the colour palettes by running <code class="language-plaintext highlighter-rouge">display.brewer.all()</code> in R.</p>

<center><img src="/img/puffinmap.png" alt="Img" style="width: 800px;"></center>

<p><a name="Flickr"></a></p>

<h2 id="5-species-occurrence-maps-based-on-gbif-and-flickr-data">5. Species occurrence maps based on GBIF and Flickr data</h2>

<p>In this part of the tutorial, we will use two datasets, one from the Global Biodiversity Information Facility <a href="https://www.gbif.org" target="_blank" rel="noopener noreferrer">(GBIF)</a> and one from  <a href="https://www.flickr.com" target="_blank" rel="noopener noreferrer">Flickr</a>, to create species occurrence maps.</p>

<p><strong>So called “big data” are being increasingly used in the life sciences because they provide a lot of information on large scales and very fine resolution. However, these datasets can be quite tricky to work with.
Most of the time the data is in the form of presence-only records. Volunteers, or social media users, take a picture or record the presence of a particular species and they report the time of the sighting and its location. Therefore, what we have is thousands of points with temporal and spatial information attached to them.</strong></p>

<p>We will go through different steps to download, clean and visualise this type of data. We will start with downloading all the occurrences of atlantic puffin in the UK that are in the GBIF database. Then we will do some spatial manipulation of data attached to pictures of atlantic puffins taken in the UK and uploaded on Flickr. Finally, we will produce density maps of both of these datasets to look for hotspots of puffins and/or puffin watchers.</p>

<h3 id="download-puffin-occurrences-from-gbif">Download puffin occurrences from GBIF</h3>

<p>First install and load all the package needed.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"rgbif"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"rgbif"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><strong>The package <code class="language-plaintext highlighter-rouge">rgbif</code> offers an interface to the Web Service methods provided by GBIF. It includes functions for searching for taxonomic names, retrieving information on data providers, getting species occurrence records and getting counts of occurrence records.</strong></p>

<p>In the GBIF dataset, every country has a unique code. We can find out the code for the UK with this line of code.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK_code</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">isocodes</span><span class="p">[</span><span class="n">grep</span><span class="p">(</span><span class="s2">"United Kingdom"</span><span class="p">,</span><span class="w"> </span><span class="n">isocodes</span><span class="o">$</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="s2">"code"</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>Now, we can download all the occurrence records for the atlantic puffin in the UK using the function <code class="language-plaintext highlighter-rouge">occ_search</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">occur</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">occ_search</span><span class="p">(</span><span class="n">scientificName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Fratercula arctica"</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UK_code</span><span class="p">,</span><span class="w"> </span><span class="n">hasCoordinate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3000</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'2006,2016'</span><span class="p">,</span><span class="w"> </span><span class="n">return</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>This will return a dataset of all the occurrences of atlantic puffin recorded in the UK between 2006 and 2016 that have geographic coordinates.</p>

<p>Have a look at the dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">str</span><span class="p">(</span><span class="n">occur</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now we can plot the occurrences on a map of the UK. We can use ggplot to do so:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maps</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span><span class="w">

</span><span class="p">(</span><span class="n">map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">occur</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLongitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">decimalLatitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="c1"># Specify to only present the UK region of the world in the map </span><span class="w">
    </span><span class="c1"># Also change the colour, size of map country borders</span><span class="w">
    </span><span class="n">borders</span><span class="p">(</span><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"world"</span><span class="p">,</span><span class="w"> </span><span class="n">regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UK"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray40"</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  
    </span><span class="n">theme_map</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="c1"># Change the colour and transparency of the plotted occurrence points </span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">))</span><span class="w"> 

</span></code></pre></div></div>
<center><img src="/img/GBIFoccurr.png" alt="Img" style="width: 800px;"></center>

<h3 id="clean-data-from-flickr">Clean data from Flickr</h3>

<p>We will now use the dataset flickr_puffins.txt. This dataset has been collected from Flickr Application Programming Interface (API), which is an interface through which softwares can interact with each other. APIs make it easy for developers to create applications which access the features or data of an operating system, application or other service. Because of time constraints, we are not going to go through the code to download data from Flick API, but you can find the script <a href="https://github.com/ourcodingclub/SEECC-workshop/blob/master/FlickrAPI.R" target="_blank" rel="noopener noreferrer">here</a> and I am happy to help if you find something unclear.</p>

<p>First, load the dataset and have a look at it.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flickr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.table</span><span class="p">(</span><span class="s2">"./flickr_puffins.txt"</span><span class="p">,</span><span class="w"> </span><span class="n">header</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"\t"</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">flickr</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The variables <code class="language-plaintext highlighter-rouge">id</code> and <code class="language-plaintext highlighter-rouge">owner</code> are the unique identifier for the photograph and for the photographer, respectively. The dataset also contains the date on which the photo was taken in the original format (<code class="language-plaintext highlighter-rouge">datetaken</code>) and broken down into <code class="language-plaintext highlighter-rouge">month</code> and <code class="language-plaintext highlighter-rouge">year</code>. The variable <code class="language-plaintext highlighter-rouge">dateonly</code> is the character string containing only the date and ignoring the time when the picture was taken. The data frame also has the geographic coordinates of the place where the picture was taken.</p>

<p>Let’s have a first look at the data.
We can quickly plot the data using the package <code class="language-plaintext highlighter-rouge">sp</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">                                           </span><span class="c1"># load the package</span><span class="w">
</span><span class="n">geopics</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flickr</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">)]</span><span class="w">                           </span><span class="c1"># subset the dataset to keep coordinates only</span><span class="w">
</span><span class="n">coordinates</span><span class="p">(</span><span class="n">geopics</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"latitude"</span><span class="p">)</span><span class="w">    </span><span class="c1"># make it spatial</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">geopics</span><span class="p">)</span><span class="w">                                         </span><span class="c1"># plot it</span><span class="w">
</span></code></pre></div></div>

<center><img src="/img/FlickrAll.png" alt="Img" style="width: 700px;"></center>

<p>The function <code class="language-plaintext highlighter-rouge">coordinates</code> sets spatial coordinates to create a Spatial object or retrieves spatial coordinates from a Spatial object.</p>

<p>The first thing we notice is that one point is clearly not in the UK and there are a few points in the Channel Islands, which we will delete. To do this, we just need to find which points have a latitude value that is smaller than the most southern point of the UK and delete them from the dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">which</span><span class="p">(</span><span class="n">flickr</span><span class="o">$</span><span class="n">latitude</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">49.9</span><span class="p">)</span><span class="w">
</span><span class="n">flickr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flickr</span><span class="p">[</span><span class="o">-</span><span class="n">which</span><span class="p">(</span><span class="n">flickr</span><span class="o">$</span><span class="n">latitude</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">49.9</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<p>Let’s check that all the points are in the UK now, using a nicer plot. We first assign a particular coordinate refernce system (CRS) to the data. A CRS defines, with the help of coordinates, how a two-dimensional map is related to real places on the earth. Since the coordinates in our dataset are recorded as decimal degrees, we can assign our spatial object a Geographic Coordinate System (GCS). WGS 1984 is the most commonly used GCS so that’s what we will use. 
If you want to know more about CRS in R here is a useful <a href="http://rspatial.org/spatial/rst/6-crs.html" target="_blank" rel="noopener noreferrer">link</a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coordinates</span><span class="p">(</span><span class="n">flickr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"longitude"</span><span class="p">,</span><span class="w"> </span><span class="s2">"latitude"</span><span class="p">)</span><span class="w">             </span><span class="c1"># go back to original dataframe and make it spatial</span><span class="w">
</span><span class="n">crs.geo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">CRS</span><span class="p">(</span><span class="s2">"+proj=longlat +ellps=WGS84 +datum=WGS84"</span><span class="p">)</span><span class="w">     </span><span class="c1"># geographical, datum WGS84</span><span class="w">
</span><span class="n">proj4string</span><span class="p">(</span><span class="n">flickr</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">crs.geo</span><span class="w">                                </span><span class="c1"># assign the coordinate system</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">flickr</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w">                     </span><span class="c1"># plot the data</span><span class="w">
</span></code></pre></div></div>

<p>We can also add the UK coastline to the plot using the package <code class="language-plaintext highlighter-rouge">rworldmap</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rworldmap</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">countriesLow</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">countriesLow</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<center><img src="/img/FlickrUK.png" alt="Img" style="width: 700px;"></center>

<p>There is one more problem we need to solve: some of the data points are not on the coast, which means that these pictures are probably not puffins. In order to delete them, we are going to use the UK coastline to select only the datapoints that are within 1 km of the coast and the ones that are on the sea. 
The first step is to split the dataset into a marine and a terrestrial one. After that, we can select only the points that are on the coast from the terrestrial dataset. Finally, we will put the marine and coastal points together.
This is only one of the possible ways in which you can do this, another common one being the use of a buffer around the coastline.</p>

<p>First we load all the packages that we need.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgeos</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">maptools</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now we use a shapefile available in the Global Administrative Areas (GADM) database. A shapefile is a format file for storing location and attribute information of geographic features, which can be represented by points, lines or polygons.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">getData</span><span class="p">(</span><span class="s2">"GADM"</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GB"</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>At the moment, we are using a GCS, which means that the units of the geometry are in decimal degrees. If we want to select data points according to their distance in km from the coastline, we need to transform our spatial datasets into projected coordinate systems so the units of the distance will be in metres and not decimal degrees. Universal Transverse Mercator (UTM) is commonly used because it tends to be more locally accurate and has attributes that make the estimating distance easy and accurate. 
In R, it is pretty easy to transform a spatial object into a projected coordinate system. In fact, you only need one function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK_proj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spTransform</span><span class="p">(</span><span class="n">UK</span><span class="p">,</span><span class="w"> </span><span class="n">CRS</span><span class="p">(</span><span class="s2">"+proj=utm +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "</span><span class="p">))</span><span class="w">
</span><span class="n">flickr_proj</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spTransform</span><span class="p">(</span><span class="n">flickr</span><span class="p">,</span><span class="w"> </span><span class="n">CRS</span><span class="p">(</span><span class="s2">"+proj=utm +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 "</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>The UK shapefile is composed of many polygons. We can simplify it by dissolving the polygons. This will speed things up.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK_diss</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gUnaryUnion</span><span class="p">(</span><span class="n">UK_proj</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now, we perform an overlay operation using the function <code class="language-plaintext highlighter-rouge">over</code>. This will identify which of our data points fall within the UK shapefile and return <code class="language-plaintext highlighter-rouge">NAs</code> when they do not. According to this result then we can divide our dataset into a marine dataset <code class="language-plaintext highlighter-rouge">NA</code> and a terrestrial one.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flickr_terr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flickr_proj</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">over</span><span class="p">(</span><span class="n">flickr_proj</span><span class="p">,</span><span class="w"> </span><span class="n">UK_diss</span><span class="p">,</span><span class="w"> </span><span class="n">fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),]</span><span class="w">
</span><span class="n">flickr_mar</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flickr_proj</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">over</span><span class="p">(</span><span class="n">flickr_proj</span><span class="p">,</span><span class="w"> </span><span class="n">UK_diss</span><span class="p">,</span><span class="w"> </span><span class="n">fn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">))</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<p>Plot the two datasets to make sure it worked.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">flickr_terr</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">flickr_mar</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center><img src="/img/FlickrTerr&amp;Mar.png" alt="Img" style="width: 800px;"></center>

<p>Now we can select the coastal points from the terrestrial dataset. In order to calculate the distance of every point from the coastline, we need to transform our UK polygon shapefile into a line shapefile. Again, this operation is pretty straightforward in R.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK_coast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as</span><span class="p">(</span><span class="n">UK_diss</span><span class="p">,</span><span class="w"> </span><span class="s1">'SpatialLines'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The next chuck of code calculates the distance of every point to the coast and selects only those that are within 1 km using the function <code class="language-plaintext highlighter-rouge">gWithinDistance</code>. Then, it transforms the output into a data frame and uses it to select only the coastal points from the original Flickr dataset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gWithinDistance</span><span class="p">(</span><span class="n">flickr_terr</span><span class="p">,</span><span class="w"> </span><span class="n">UK_coast</span><span class="p">,</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">byid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="n">dist.df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span><span class="w">
</span><span class="n">flickr_coast</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">flickr_terr</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">dist.df</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"TRUE"</span><span class="p">),]</span><span class="w">
</span></code></pre></div></div>

<p>Plot to check it worked.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot</span><span class="p">(</span><span class="n">flickr_coast</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center><img src="/img/FlickrCoast.png" alt="Img" style="width: 800px;"></center>

<p>Now we can put the marine and coastal datasets together and plot to check that it worked.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flickr_correct</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">spRbind</span><span class="p">(</span><span class="n">flickr_mar</span><span class="p">,</span><span class="w"> </span><span class="n">flickr_coast</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">UK_coast</span><span class="p">)</span><span class="w">
</span><span class="n">points</span><span class="p">(</span><span class="n">flickr_correct</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"steelblue"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<center><img src="/img/FlickrCoast2.png" alt="Img" style="width: 800px;"></center>

<h3 id="density-maps">Density maps</h3>

<p><strong>Now that we have the datasets cleaned, it is time to make some pretty maps. When you have presence-only data, one of the things you might want to do is to check whether there are hotspots. Density maps made with <code class="language-plaintext highlighter-rouge">ggplot2</code> can help you visualise that.</strong></p>

<p>We start with the Flickr data. First, we need to transform our spatial datasets into a format that <code class="language-plaintext highlighter-rouge">ggplot2</code> is able to read.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK.Df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fortify</span><span class="p">(</span><span class="n">UK_diss</span><span class="p">,</span><span class="w"> </span><span class="n">region</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ID_0"</span><span class="p">)</span><span class="w">
</span><span class="n">flickr.points</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fortify</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">flickr_correct</span><span class="o">@</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">flickr_correct</span><span class="o">@</span><span class="n">coords</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Now, we can build our map with <code class="language-plaintext highlighter-rouge">ggplot2</code>. If you want to know more about the way you build plots in <code class="language-plaintext highlighter-rouge">ggplot2</code> here is a useful <a href="http://vita.had.co.nz/papers/layered-grammar.pdf" target="_blank" rel="noopener noreferrer">link</a>. One feature that you might want to take notice of is the use of <code class="language-plaintext highlighter-rouge">fill = ..level.., alpha = ..level..</code>. This syntax sets the colour and transparency of your density layer as dependent on the density itself. The <code class="language-plaintext highlighter-rouge">stat_</code> functions compute new values (in this case the <code class="language-plaintext highlighter-rouge">level</code> variable using the <code class="language-plaintext highlighter-rouge">kde2d</code> function from the package <code class="language-plaintext highlighter-rouge">MASS</code>) and create new data frames. The <code class="language-plaintext highlighter-rouge">..level..</code> tells ggplot to reference that column in the newly built data frame. The two dots indicate that the variable <code class="language-plaintext highlighter-rouge">level</code> is not present in the original data, but has been computed by the <code class="language-plaintext highlighter-rouge">stat_</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="n">plot.years</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">flickr.points</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">latitude</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">  </span><span class="c1"># plot the flickr data</span><span class="w">
  </span><span class="n">geom_polygon</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UK.Df</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">long</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lat</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">group</span><span class="p">),</span><span class="w">            </span><span class="c1"># plot the UK</span><span class="w">
               </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"gray82"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">    </span><span class="c1"># coord_fixed() ensures that one unit on the x-axis is the same length as one unit on the y-axis</span><span class="w">
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodgerblue4"</span><span class="p">,</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"."</span><span class="p">)</span><span class="o">+</span><span class="w">                   </span><span class="c1"># graphical parameters for points</span><span class="w">
  </span><span class="n">stat_density2d</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">longitude</span><span class="p">,</span><span class="w">                           </span><span class="c1"># create the density layer based on where the points are</span><span class="w">
                     </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">latitude</span><span class="p">,</span><span class="w">  </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">..level..</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">..level..</span><span class="p">),</span><span class="w">   </span><span class="c1"># colour and transparency depend on density</span><span class="w">
                 </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"polygon"</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"grey95"</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">0.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">            </span><span class="c1"># graphical parameters for the density layer</span><span class="w">
  </span><span class="n">scale_fill_gradient</span><span class="p">(</span><span class="n">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"yellow"</span><span class="p">,</span><span class="w"> </span><span class="n">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                 </span><span class="c1"># set colour palette for density layer</span><span class="w">
  </span><span class="n">scale_alpha</span><span class="p">(</span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.25</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">),</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                    </span><span class="c1"># set transparency for the density layer </span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">year</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">                                                 </span><span class="c1"># multipanel plot according to the variable "year" in the flickr dataset</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">  </span><span class="c1"># don't display x and y axes labels, titles and tickmarks </span><span class="w">
        </span><span class="n">axis.ticks.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">   
        </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w"> </span><span class="n">axis.ticks.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
        </span><span class="n">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">18</span><span class="p">),</span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">.9</span><span class="p">,</span><span class="w"> </span><span class="m">.15</span><span class="p">),</span><span class="w">       </span><span class="c1"># size of text and position of the legend</span><span class="w">
        </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">                            </span><span class="c1"># eliminates grid lines from background</span><span class="w">
        </span><span class="n">panel.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()))</span><span class="w">                            </span><span class="c1"># set white background</span><span class="w">

</span><span class="c1"># This will take a while to plot!</span><span class="w">
</span></code></pre></div></div>
<center><img src="/img/FlickrDensity.png" alt="Img" style="width: 800px;"></center>

<p>You can see from this plot that there are a few hotspots for watching puffins in the UK, such as the Farne Islands, Shetland and Flamborough Head.</p>

<p>Now try to build your own plot for the GBIF data. Remeber to:</p>

<ul>
  <li>make the <code class="language-plaintext highlighter-rouge">occur</code> dataset spatial with <code class="language-plaintext highlighter-rouge">coordinates()</code>
</li>
  <li>assign the right coordinate system with <code class="language-plaintext highlighter-rouge">proj4string()</code>
</li>
  <li>transform the coordinates to UTM with <code class="language-plaintext highlighter-rouge">spTransform()</code>
</li>
  <li>use <code class="language-plaintext highlighter-rouge">fortify()</code> to make it readable by <code class="language-plaintext highlighter-rouge">ggplot2</code>
</li>
  <li>build your plot with <code class="language-plaintext highlighter-rouge">ggplot</code>
</li>
</ul>

<p>__If you get stuck you can find the code in the script SEECC_script_final.R <a href="https://github.com/ourcodingclub/SEECC-workshop/SEECC_script_final.R" target="_blank" rel="noopener noreferrer">here/a&gt;.__</a></p>

<p><strong>This tutorial was prepared for a workshop on quantifying biodiversity change at the Scottish Ecology, Environment and Conservation Conference on 3rd April in Aberdeen. If you want to learn more about our joint workshop with the Aberdeen Study Group, led by <a href="https://francescamancini.github.io/" target="_blank" rel="noopener noreferrer">Francesca Mancini</a>, you can check out our blog posts on the <a href="https://teamshrub.wordpress.com/2017/04/10/coding-club-goes-to-aberdeen-and-the-impact-awards/" target="_blank" rel="noopener noreferrer">Team Shrub blog</a> and <a href="https://francescamancini.github.io/FirstSteps/" target="_blank" rel="noopener noreferrer">Francesca’s blog</a>. The workshop organisation and preparation of teaching materials were supported by the Global Environment &amp; Society Academy Innovation Fund.</strong></p>

<center><img src="/img/GESA.jpg" alt="Img" style="width: 800px;"></center>

<hr>

<hr>

<p><strong>Check out <a href="https://ourcodingclub.github.io/workshop/" target="_blank" rel="noopener noreferrer">this page</a> to learn how you can get involved! We are very happy to have people use our tutorials and adapt them to their needs. We are also very keen to expand the content on the website, so feel free to get in touch if you’d like to write a tutorial!</strong></p>

<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a>. <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="Img" style="width: 100px;"></a></p>

<h3><a href="https://www.surveymonkey.co.uk/r/9L5ZFNK" target="_blank" rel="noopener noreferrer">  We would love to hear your feedback, please fill out our survey!</a></h3>
<p><br></p>
<h3>  You can contact us with any questions on <a href="mailto:ourcodingclub@gmail.com?Subject=Tutorial%20question" target="_top">ourcodingclub@gmail.com</a>
</h3>
<p><br></p>
<h3>  Related tutorials:</h3>

<ul>
  
  
</ul>
<p><br></p>
<h3>  Subscribe to our mailing list:</h3>
<div class="container">
	<div class="block">
        <!-- subscribe form start -->
		<div class="form-group">
			<form action="https://getsimpleform.com/messages?form_api_token=de1ba2f2f947822946fb6e835437ec78" method="post">
			<div class="form-group">
				<input type="text" class="form-control" name="Email" placeholder="Email" required="">
			</div>
			<div>
                        	<button class="btn btn-default" type="submit">Subscribe</button>
                    	</div>
                	</form>
		</div>
	</div>
</div>

<ul class="social-icons">
	<li>
		<h3>
			<a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer"> Follow our coding adventures on Twitter! <i class="fa fa-twitter"></i></a>
		</h3>
	</li>
</ul>


    	<footer class="footer">
	<hr>
	<div class="footer-container">
    	<ul class="footer-link-list">
        	<li><a href="/tutorials">Tutorials</a></li>
        	<li><a href="/team">About Us</a></li>
        	<li><a href="/contact">Contact us</a></li>
	    	<li><a href="https://twitter.com/our_codingclub" target="_blank" rel="noopener noreferrer">Follow us on Twitter</a></li>
    	</ul>
    	<div class="footer-text">
			<p>We are happy for people to use and further develop our tutorials - please give credit to Coding Club by linking to <a href="https://ourcodingclub.github.io/" target="_blank" rel="noopener noreferrer">our website</a>. We are also happy to discuss possible collaborations, so get in touch at <b>ourcodingclub@gmail.com</b></p>
    		<p>See our <a href="/terms">Terms of Use</a> and our <a href="/privacy">Data Privacy policy</a>.</p>
			<p>This work is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer">Creative Commons Attribution-ShareAlike 4.0 International License</a></p>
			<a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener noreferrer"><img class="license" src="https://licensebuttons.net/l/by-sa/4.0/80x15.png" alt="CC-by-sa-4.0"></a>
    	</div>
    </div>
</footer>

<!-- JS -->
<script src="/scripts/owl.carousel.js"></script>
<script src="/scripts/owl.carousel-init.js"></script>
<script src="/scripts/reveal.js"></script>


	
	</body>
</html>
